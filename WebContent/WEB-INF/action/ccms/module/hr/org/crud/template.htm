<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>CCMS</title>
<script language="JavaScript" type="text/javascript"
	src="${def:context}/action/pub/dtree"></script>
${inc:/action/ccms/pub}
<link rel="stylesheet" type="text/css"
	href="http://api.amap.com/Public/css/demo.Default.css" />
<script type="text/javascript"
	src="http://webapi.amap.com/maps?v=1.3&key=ee7789650da128fa636573755e032541&callback=web_init"></script>
</head>
<body>
	<div class="panel panel-default col_mainInner">
		<div class="panel-heading col_main_body_title text-center">
			<h2 class="panel-title">组织架构</h2>
		</div>
		<div class="panel-body col_main_body dtree">
			<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 column">
				<form name="treeForm" id="searchForm" class="form-horizontal"
					role="form" method="post">
					<input name="org_code" type="hidden" maxlength="100" value="" />
				</form>
			</div>
			<div class="col-xs-8 col-sm-8 col-md-9 col-lg-9 column">
				<div id="org_workspace" style="display: none">
					<ul class="nav nav-tabs">
						<li class="active"><a href="#storedetails" data-toggle="tab">架构详情</a></li>
						<li class=""><a href="#orgpost" data-toggle="tab">岗位信息</a></li>
						<li><a href="#headcount" data-toggle="tab">名额信息</a></li>
						<li><a href="#staff" data-toggle="tab">人员信息</a></li>
						<li><a href="#mark" data-toggle="tab">地理标注</a></li>
					</ul>
					<div class="tab-content" style="padding-top: 10px;">
						<div class="tab-pane " id="orgpost">
							<form class="form-horizontal" role="form" method="post"
								id="searchForm1" name="searchForm1">
								<input name="sort" type="hidden" value="created" preserve="true" />
								<input name="order" type="hidden" value="desc" preserve="true" />
								<input name="pageNo" type="hidden" value="" preserve="true" />
								<input name="totalPages" type="hidden" value="" preserve="true" />
								<input name="org_id" type="hidden" value="" preserve="true"
									id="org_id" />
								<div class="form-group">
									<div class="col-xs-3 col-sm-3 col-md-3 col-lg-3">
										<input type="text" class="form-control" name="post_name"
											id="post_name" placeholder="请输入岗位类型" />
									</div>
									<div class="col-xs-3 col-sm-3 col-md-3 col-lg-3">
										<button class="btn btn-primary btn-md" type="button"
											id="search_btn1">查询</button>
										<button class="btn btn-primary btn-md" type="button"
											id="search_reset_btn1">清空</button>
										<button class="btn btn-primary btn-md" type="button"
											data-toggle="modal" id="addnew_btn1">新增</button>
									</div>
									<div class="col-xs-4 col-sm-4 col-md-4 col-lg-4"
										id="errorMessages"></div>
								</div>
							</form>
							<table class="table table-condensed">
								<thead>
									<tr>
										<th>操作</th>
										<th class="sortable" code="org_post_id">岗位ID</th>
										<th class="sortable" code="org_post_name">岗位名称</th>
										<th class="sortable" code="pname">父级岗位</th>
										<th class="sortable" code="post_name">岗位类型</th>
									</tr>
								</thead>
								<tbody id="datagrid1Template" style="display: none">
									<tr>
										<td align="center"><a href="javascript:void(0)"
											title="编辑"><span
												class="glyphicon glyphicon-pencil edit_btn1"
												code="#org_post_id#"></span></a>&nbsp;&nbsp;&nbsp;&nbsp; <a
											href="javascript:void(0)" title="删除"><span
												class="glyphicon glyphicon-remove delete_btn1"
												code="#org_post_id#"></span></a> <!-- <button class="btn btn-primary btn-md edit_btn1" type="button" code="#org_post_id#">编辑</button>
									<button class="btn btn-primary btn-md delete_btn1" type="button" code="#org_post_id#">删除</button> -->
										</td>
										<td class="text-center">#org_post_id#</td>
										<td class="text-center">#org_post_name#</td>
										<td class="text-center">#pname#</td>
										<td class="text-center">#post_name#</td>
									</tr>
								</tbody>
								<tbody id="datagrid1">
								</tbody>
							</table>
							<div class="pageDiv">
								<ul class="pagination" data-target="datagrid1">
								</ul>
							</div>
						</div>
						<div class="tab-pane" id="headcount">
							<form class="form-horizontal" role="form" method="post"
								id="searchForm2" name="searchForm2">
								<input name="sort" type="hidden" value="created" preserve="true" />
								<input name="order" type="hidden" value="desc" preserve="true" />
								<input name="pageNo" type="hidden" value="" preserve="true" />
								<input name="totalPages" type="hidden" value="" preserve="true" />
								<input type="hidden" id="tuid" name="tuid" value=""
									preserve="true" /> <input disabled type="hidden"
									id="org_post_path" name="org_post_path" preserve="true" /> <input
									type="hidden" id="org_id" name="org_id" value="${fld:org_id}"
									preserve="true" />
								<div class="form-group">
									<div class="col-xs-3 col-sm-3 col-md-3 col-lg-3">
										<input type="text" class="form-control" name="hc_name"
											placeholder="请输入名额名称" />
									</div>
									<div class="col-xs-3 col-sm-3 col-md-3 col-lg-3">
										<button class="btn btn-primary btn-md" type="button"
											id="search_btn2">查询</button>
										<button class="btn btn-primary btn-md" type="button"
											id="search_reset_btn2">清空</button>
										<button class="btn btn-primary btn-md" type="button"
											data-toggle="modal" id="addnew_btn2">新增</button>
									</div>
								</div>
							</form>
							<table class="table table-condensed">
								<thead>
									<tr>
										<th>操作</th>
										<th class="sortable" code="post_name">岗位类型</th>
										<th class="sortable" code="org_post_name">岗位名称</th>
										<th class="sortable" code="hc_name">名额名称</th>
										<th class="sortable" code="name">人员名称</th>
									</tr>
								</thead>
								<tbody id="datagrid2Template" style="display: none">
									<tr>
										<td class="text-center">#button#</td>
										<td class="text-center">#post_type#</td>
										<td class="text-center">#org_post_name#</td>
										<td class="text-center">#hc_name#</td>
										<td class="text-center">#name#</td>
									</tr>
								</tbody>
								<tbody id="datagrid2">
								</tbody>
							</table>
							<div class="pageDiv">
								<ul class="pagination" data-target="datagrid2">
								</ul>
							</div>
						</div>
						<div class="tab-pane" id="staff">
							<form class="form-horizontal" role="form" method="post"
								id="searchForm3" name="searchForm3">
								<input name="sort" type="hidden" value="userlogin"
									preserve="true" /> <input type="hidden" name="org_id"
									value="${fld:org_id}" preserve="true" /> <input name="order"
									type="hidden" value="desc" preserve="true" /> <input
									name="pageNo" type="hidden" value="" preserve="true" /> <input
									name="totalPages" type="hidden" value="" preserve="true" />
								<div class="form-group">
									<div class="col-xs-3 col-sm-3 col-md-3 col-lg-3">
										<input name="name" type="text" class="form-control" size="20"
											value="" placeholder="请输入姓名或登录号" />
									</div>
									<div class="col-xs-3 col-sm-3 col-md-3 col-lg-3">
										<label
											class="col-xs-4 col-sm-4 col-md-4 col-lg-4 control-label">状态</label>
										<input name="enabled" type="radio" size="35" value="1" />正常 <input
											name="enabled" type="radio" size="35" value="0" />禁用
									</div>
									<div class="col-xs-3 col-sm-3 col-md-3 col-lg-3">
										<button class="btn btn-primary btn-md" type="button"
											id="search_btn3">查询</button>
										<button class="btn btn-primary btn-md" type="button"
											id="search_reset_btn3">清空</button>
										<button class="btn btn-primary btn-md" type="button"
											data-toggle="modal" id="addnew_btn3">新增</button>
									</div>
								</div>
							</form>
							<table class="table table-condensed">
								<thead>
									<tr>
										<th>操作</th>
										<th class="sortable" code="userlogin">登录名</th>
										<th class="sortable" code="alias">职务</th>
										<th class="sortable" code="name">姓名</th>
										<th class="sortable" code="sex">性别</th>
										<th class="sortable" code="mobile">手机号码</th>
										<th class="sortable" code="org_name">部门名称</th>
										<th class="sortable" code="state">状态</th>
									</tr>
								</thead>
								<tbody id="datagrid3Template" style="display: none">
									<tr>
										<td align="center"><a title="编辑"
											href="javascript:void(0)"><span
												class="glyphicon glyphicon-pencil edit_btn3"
												code="#userlogin#"></span></a>&nbsp;&nbsp;&nbsp; <a title="删除"
											href="javascript:void(0)"><span
												class="glyphicon glyphicon-remove delete_btn3"
												code="#user_id#"></span></a>&nbsp;&nbsp;&nbsp; <a title="重置密码"
											href="javascript:void(0)"><span
												class="glyphicon glyphicon-cog resetPW_btn" code="#user_id#"></span></a>&nbsp;&nbsp;&nbsp;
											#button#</td>
										<td class="text-center">#userlogin#</td>
										<td class="text-center">#alias#</td>
										<td class="text-center">#name#</td>
										<td class="text-center">#sex#</td>
										<td class="text-center">#mobile#</td>
										<td class="text-center">#org_name#</td>
										<td class="text-center">#state#</td>
									</tr>
								</tbody>
								<tbody id="datagrid3"></tbody>
							</table>
							<div class="pageDiv">
								<ul class="pagination" data-target="datagrid3">
								</ul>
							</div>
						</div>
						<div class="tab-pane active" id="storedetails">
							<form class="form-horizontal" role="form" method="post"
								id="searchForm5" name="searchForm5">
								<input type="hidden" id="tuid_m" name="tuid_m" value=""
									preserve="true" /> <input type="hidden" id="org_post_path"
									name="org_post_path" preserve="true" /> <input type="hidden"
									id="org_id" name="org_id" value="${fld:org_id}" preserve="true" />
								<table class="table table-condensed">
									<tbody id="datagrid5Template" style="display: none">
										<div class="form-group">
											<label
												class="col-xs-3 col-sm-3 col-md-3 col-lg-3 control-label ">公司名称</label>
											<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
												<input type="text" readonly="readonly" class="form-control"
													id="company" name="company" value="${fld:org_name}"
													maxlength="128" />
											</div>
										</div>
										<div class="form-group">
											<label
												class="col-xs-3 col-sm-3 col-md-3 col-lg-3 control-label ">公司地址</label>
											<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
												<input type="text" class="form-control" id="address"
													name="address" value="" maxlength="128" />
											</div>
										</div>
										<div class="form-group">
											<label
												class="col-xs-3 col-sm-3 col-md-3 col-lg-3 control-label ">联系人</label>
											<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
												<input type="text" class="form-control" id="contacts"
													name="contacts" value="" maxlength="128" />
											</div>
										</div>
										<div class="form-group">
											<label
												class="col-xs-3 col-sm-3 col-md-3 col-lg-3 control-label  ">联系电话</label>
											<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
												<input type="text" class="form-control" id="contact_phone"
													name="contact_phone" value="" maxlength="128" />
											</div>
										</div>
										<div class="form-group">
											<label
												class="col-xs-3 col-sm-3 col-md-3 col-lg-3 control-label  ">省份</label>
											<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
												<input type="text" class="form-control" id="province"
													name="province" value="" maxlength="128" />
											</div>
										</div>
										<div class="form-group">
											<label
												class="col-xs-3 col-sm-3 col-md-3 col-lg-3 control-label ">城市</label>
											<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
												<input type="text" class="form-control" id="city"
													name="city" value="" maxlength="128" />
											</div>
										</div>
										<!-- <div class="form-group">
								<label class="col-xs-3 col-sm-3 col-md-3 col-lg-3 control-label  ">公司分类</label>
								<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">						
									<input type="text" class="form-control" id="channel_name" name="channel_name" value="" maxlength="128"/>
								</div>
							</div> -->
										<div class="form-group">
											<label
												class="col-xs-3 col-sm-3 col-md-3 col-lg-3 control-label ">分类标签</label>
											<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
												<input type="text" class="form-control" id="category_label"
													name="category_label" value="" maxlength="128" />
											</div>
										</div>
										<div class="form-group">
											<label
												class="col-xs-3 col-sm-3 col-md-3 col-lg-3 control-label ">特色品</label>
											<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
												<input type="text" class="form-control"
													id="featured_products" name="featured_products" value=""
													maxlength="128" />
											</div>
										</div>
										<div class="form-group">
											<label
												class="col-xs-3 col-sm-3 col-md-3 col-lg-3 control-label ">店面特色</label>
											<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
												<input type="text" class="form-control" id="features"
													name="features" value="" maxlength="128" />
											</div>
										</div>
										<!-- <div class="form-group">
								<label class="col-xs-3 col-sm-3 col-md-3 col-lg-3 control-label ">店面氛围</label>
								<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">						
									<input type="text" class="form-control" id="atmosphere" name="atmosphere" value="" maxlength="128"/>
								</div>
							</div> -->
										<!--div class="form-group">
								<label class="col-xs-3 col-sm-3 col-md-3 col-lg-3 control-label ">营业时间</label>
								<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">						
									<input type="text" class="form-control" id="business_hours" name="business_hours" value="" maxlength="128"/>
								</div>
							</div-->

										<div class="form-group">
											<label
												class="col-xs-3 col-sm-3 col-md-3 col-lg-3 control-label ">营业时间</label>
											<div class="col-xs-2 col-sm-2 col-md-2 col-lg-2">
												<input type="text" class="form-control"
													id="business_hours_begin" name="business_hours_begin"
													value="" readonly />
											</div>
											<div class="col-xs-1 col-sm-1 col-md-1 col-lg-1">至</div>
											<div class="col-xs-2 col-sm-2 col-md-2 col-lg-2">
												<input type="text" class="form-control"
													id="business_hours_end" name="business_hours_end" value=""
													readonly /> <input type="hidden" id="business_hours_type"
													name="business_hours_type" value="" />
											</div>
											<div class="col-xs-1 col-sm-1 col-md-1 col-lg-1"></div>
										</div>
										<div class="form-group">
											<label
												class="col-xs-3 col-sm-3 col-md-3 col-lg-3 control-label ">备注</label>
											<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
												<textarea class="form-control" id="remark" name="remark"></textarea>
											</div>
										</div>
										<div class="form-group text-center">
											<button class="btn btn-primary btn-md" id="storedetails_btn"
												type="button" code="">保存</button>
											<button class="btn btn-primary btn-md" type="button"
												id="storedetails_del">删除</button>
											<button class="btn btn-primary btn-md" type="button" id="">取消</button>
										</div>
									</tbody>
									<tbody id="datagrid5"></tbody>
								</table>
							</form>
						</div>
						<div class="tab-pane" id="mark">
							<form class="form-horizontal" role="form" id="form_mark"
								name="form_mark">
								<input name="org_id" type="hidden" value="" preserve="true" /> <input
									id="coordinate" name="coordinate" type="hidden" value="" />
								<div class="form-group">
									<div class="col-xs-5 col-sm-5 col-md-5 col-lg-5">
										<label for="area_code">选择城市</label> <select id="area_code"
											name="area_code" class="form-control"
											style="width: 80%; display: inline-block;">
											<option value=""></option>
											<option value="010">北京市</option>
											<option value="021">上海市</option>
											<option value="020">广州市</option>
										</select>
									</div>
									<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
										<label class="control-label">在地图上找到相应位置后单击，再点击“保存”按钮完成标记</label>&nbsp;
										<button class="btn btn-primary btn-md" id="save_btn_mark">保存</button>
									</div>
								</div>
								<div id="iCenter"
									style="width: 97%; height: 350px; border: 1px solid #F6F6F6; display: block;">
								</div>
							</form>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="modal fade" id="modalAddnew" tabindex="-1" role="dialog">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-hidden="true">&times;</button>
					<h4 class="modal-title" id="formTitle">组织架构信息</h4>
				</div>
				<div class="modal-body">
					<form class="form-horizontal" role="form" method="post"
						id="formEditor" name="formEditor">
						<input type="hidden" name="tuid" id="tuid" value=""
							preserve="true" />
						<div class="row clearfix">
							<div class="form-group">
								<label
									class="col-xs-2 col-sm-3 col-md-3 col-lg-3 control-label  required">组织名称:</label>
								<div class="col-xs-8 col-sm-7 col-md-7 col-lg-7">
									<input type="hidden" id="pid" name="pid" value=""
										preserve="true" /> <input type="hidden" id="p_org_path"
										name="p_org_path" value="" preserve="true" /> <input
										type="text" class="form-control" id="org_name" name="org_name"
										value="" maxlength="20" />
								</div>
							</div>
							<div class="form-group">
								<label
									class="col-xs-2 col-sm-3 col-md-3 col-lg-3 control-label  required">上传图片:</label>
								<div class="col-xs-8 col-sm-7 col-md-7 col-lg-7">
									<img id="upload_image" style="width: 200px; height: 180px"
										src="" onclick="uploadImg()"> <input type="hidden"
										id="upload_id" name="upload_id">
								</div>
							</div>
							<div class="form-group">
								<label
									class="col-xs-2 col-sm-3 col-md-3 col-lg-3 control-label  ">组织短名:</label>
								<div class="col-xs-8 col-sm-7 col-md-7 col-lg-7">
									<input type="text" class="form-control" id="short_name"
										name="short_name" value="" maxlength="20" />
								</div>
							</div>
							<div class="form-group">
								<label
									class="col-xs-2 col-sm-3 col-md-3 col-lg-3 control-label  ">组织层级:</label>
								<div class="col-xs-8 col-sm-7 col-md-7 col-lg-7">
									<select name="org_grade" id="org_grade" class="form-control">
										<option value=""></option>
										<grade-rows>
										<option value="${fld:org_grade}">${fld:org_grade_alias}</option>
										</grade-rows>
									</select>
								</div>
							</div>
							<div class="form-group">
								<label
									class="col-xs-2 col-sm-3 col-md-3 col-lg-3 control-label  ">顺序:</label>
								<div class="col-xs-8 col-sm-7 col-md-7 col-lg-7">
									<input type="text" class="form-control" id="show_order"
										name="show_order" value="" maxlength="20" />
								</div>
							</div>
							<div class="form-group">
								<label
									class="col-xs-2 col-sm-3 col-md-3 col-lg-3 control-label  required">类型:</label>
								<div class="col-xs-8 col-sm-7 col-md-7 col-lg-7">
									<input name="org_type" type="radio" value="0" />一级/机关单位&nbsp; 
									<input name="org_type" type="radio" value="1" />二级/党组 &nbsp;
									<input name="org_type" type="radio" value="2" />三级/党委 &nbsp;
									<input name="org_type" type="radio" value="3" />四级/部门 &nbsp;
									<br/>
									<input name="org_type" type="radio" value="4" />五级/支部 &nbsp;
									<input name="org_type" type="radio" value="5" />六级/党小组 &nbsp;
									<input name="org_type" type="radio" value="6" />七级/党组书记 &nbsp;
									<input name="org_type" type="radio" value="7" />八级/负责人 &nbsp;
								</div>
							</div>
							<div class="form-group">
								<label
									class="col-xs-2 col-sm-3 col-md-3 col-lg-3 control-label  ">备注信息:</label>
								<div class="col-xs-8 col-sm-7 col-md-7 col-lg-7">
									<input type="text" class="form-control" id="remark"
										name="remark" value="" maxlength="20" />
								</div>
							</div>
						</div>
					</form>
				</div>
				<div class="modal-footer">
					<div
						class="col-xs-12 col-sm-8 col-md-6 col-lg-8 col-xs-offset-1 col-sm-offset-2 col-md-offset-3 col-lg-offset-2">
						<button type="button" id="save_btn" class="btn btn-primary btn-md">确&nbsp;定</button>
						<button type="button" id="reset_btn"
							class="btn btn-primary btn-md">重&nbsp;置</button>
						<button type="button" class="btn btn-primary btn-md"
							data-dismiss="modal">取&nbsp;消</button>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="modal fade" id="modalAddnew1" tabindex="-1" role="dialog">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-hidden="true">&times;</button>
					<h4 class="modal-title" id="formTitle1">岗位信息</h4>
				</div>
				<div class="modal-body">
					<form class="form-horizontal" role="form" method="post"
						id="formEditor1" name="formEditor1">
						<input type="hidden" name="tuid" id="tuid" value=""
							preserve="true" /> <input type="hidden" name="org_id"
							id="org_id" value="" preserve="true" />
						<div class="row clearfix">
							<div class="form-group">
								<label
									class="col-xs-2 col-sm-3 col-md-3 col-lg-3 control-label  required">岗位名称:</label>
								<div class="col-xs-8 col-sm-7 col-md-7 col-lg-7">
									<input type="text" class="form-control" id="org_post_name"
										name="org_post_name" value="" maxlength="64" />
								</div>
							</div>
							<div class="form-group">
								<label
									class="col-xs-2 col-sm-3 col-md-3 col-lg-3 control-label  ">父级岗位:</label>
								<div class="col-xs-8 col-sm-7 col-md-7 col-lg-7">
									<select id="pid" name="pid" class="form-control">
										<option></option>
									</select>
								</div>
							</div>
							<div class="form-group">
								<label
									class="col-xs-2 col-sm-3 col-md-3 col-lg-3 control-label  required">岗位类型:</label>
								<div class="col-xs-8 col-sm-7 col-md-7 col-lg-7">
									<select id="post_id" name="post_id" class="form-control">
										<option></option>
									</select>
								</div>
							</div>
							<div class="form-group">
								<label
									class="col-xs-2 col-sm-3 col-md-3 col-lg-3 control-label  ">顺序:</label>
								<div class="col-xs-8 col-sm-7 col-md-7 col-lg-7">
									<input type="text" class="form-control" id="show_order"
										name="show_order" value="" maxlength="20" />
								</div>
							</div>
						</div>
					</form>
				</div>
				<div class="modal-footer">
					<div
						class="col-xs-12 col-sm-8 col-md-6 col-lg-8 col-xs-offset-1 col-sm-offset-2 col-md-offset-3 col-lg-offset-2">
						<button type="button" id="save_btn1"
							class="btn btn-primary btn-md">确&nbsp;定</button>
						<button type="button" id="reset_btn1"
							class="btn btn-primary btn-md">重&nbsp;置</button>
						<button type="button" class="btn btn-primary btn-md"
							data-dismiss="modal">取&nbsp;消</button>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="modal fade" id="modalAddnew2" tabindex="-1" role="dialog">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-hidden="true">&times;</button>
					<h4 class="modal-title" id="formTitle1">名额信息</h4>
				</div>
				<div class="modal-body">
					<form class="form-horizontal" role="form" method="post"
						id="formEditor2" name="formEditor2">
						<input type="hidden" id="tuid" name="tuid" value=""
							preserve="true" />
						<div class="row clearfix">
							<div class="form-group">
								<label
									class="col-xs-2 col-sm-3 col-md-3 col-lg-3 control-label  required">名额名称:</label>
								<div class="col-xs-8 col-sm-7 col-md-7 col-lg-7">
									<input type="text" class="form-control" id="hc_name"
										name="hc_name" value="" maxlength="64" />
								</div>
							</div>
							<div class="form-group">
								<label
									class="col-xs-2 col-sm-3 col-md-3 col-lg-3 control-label  required">岗位名称:</label>
								<div class="col-xs-8 col-sm-7 col-md-7 col-lg-7">
									<select name="org_post_id" id="org_post_id"
										class="form-control">
										<option value=""></option>
									</select>
								</div>
							</div>
							<div class="form-group">
								<label
									class="col-xs-2 col-sm-3 col-md-3 col-lg-3 control-label  ">顺序:</label>
								<div class="col-xs-8 col-sm-7 col-md-7 col-lg-7">
									<input type="text" class="form-control" id="show_order"
										name="show_order" value="" maxlength="20" />
								</div>
							</div>
						</div>
					</form>
				</div>
				<div class="modal-footer">
					<div
						class="col-xs-12 col-sm-8 col-md-6 col-lg-8 col-xs-offset-1 col-sm-offset-2 col-md-offset-3 col-lg-offset-2">
						<button type="button" id="save_btn2"
							class="btn btn-primary btn-md">确&nbsp;定</button>
						<button type="button" id="reset_btn2"
							class="btn btn-primary btn-md">重&nbsp;置</button>
						<button type="button" class="btn btn-primary btn-md"
							data-dismiss="modal">取&nbsp;消</button>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="modal fade" id="searchStaffModal" tabindex="-1"
		role="dialog">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-hidden="true">&times;</button>
					<h4 class="modal-title" id="formTitle1">人员信息</h4>
				</div>
				<div class="modal-body">
					<form class="form-horizontal" role="form" method="post"
						id="searchStaffForm" name="searchStaffForm">
						<input name="sort" type="hidden" value="created" preserve="true" />
						<input name="order" type="hidden" value="desc" preserve="true" />
						<input name="pageNo" type="hidden" value="" preserve="true" /> <input
							name="totalPages" type="hidden" value="" preserve="true" />
						<div class="form-group">
							<div class="col-xs-6 col-sm-6 col-md-4 col-lg-4 ">
								<input type="text" class="form-control" name="name"
									placeholder="请输入员工名称" /> <input preserve="true" id="hc_id"
									name="hc_id" type="hidden" value="${fld:hc_id}" /> <input
									preserve="true" id="org_id" name="org_id" type="hidden"
									value="${fld:hc_id}" />
							</div>
							<div class="col-xs-6 col-sm-6 col-md-4 col-lg-4   text-center">
								<button class="btn btn-primary btn-md" type="button"
									id="searchStaff_btn">查询</button>
								<button class="btn btn-primary btn-md" type="button"
									id="searchStaff_reset_btn">清空</button>
							</div>
						</div>
					</form>
					<table class="table table-condensed">
						<thead>
							<tr>
								<th>操作</th>
								<th class="sortable" code="userlogin">登录代码</th>
								<th class="sortable" code="name">名称</th>
							</tr>
						</thead>
						<tbody id="datagridStaffTemplate" style="display: none">
							<tr>
								<td align="center"><a title="选择" href="javascript:void(0);"
									class="addStaffBtn" code="#userlogin#"><span
										class="glyphicon glyphicon-ok"></span></a></td>
								<td align="center">#userlogin#</td>
								<td align="center">#name#</td>
							</tr>
						</tbody>
						<tbody id="datagridStaff">
						</tbody>
					</table>
					<div class="pageDiv">
						<ul class="pagination" target="datagridStaff">
						</ul>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- reset pwd -->
	<div class="modal fade" id="modalAddnewPwd" tabindex="-1" role="dialog">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-hidden="true">&times;</button>
					<h4 class="modal-title" id="formTitle1">重置密码</h4>
				</div>
				<div class="modal-body">
					<form id="formEditorPwd" name="formEditorPwd"
						class="form-horizontal" role="form" method="post">
						<input type="hidden" name="tuid" value="" /> <input type="hidden"
							name="user_id" value="" /> <input type="hidden" name="userlogin"
							value="" />
						<div class="row clearfix">
							<div class="form-group">
								<label
									class="col-xs-2 col-sm-3 col-md-3 col-lg-3 control-label ">用户名</label>
								<div class="col-xs-8 col-sm-7 col-md-7 col-lg-7" id="uName">

								</div>
							</div>
							<div class="form-group">
								<label
									class="col-xs-2 col-sm-3 col-md-3 col-lg-3 control-label ">Email</label>
								<div class="col-xs-8 col-sm-7 col-md-7 col-lg-7" id="uEmail">

								</div>
							</div>
							<div class="form-group">
								<label
									class="col-xs-2 col-sm-3 col-md-3 col-lg-3 control-label  required">新密码</label>
								<div class="col-xs-8 col-sm-7 col-md-7 col-lg-7">
									<input id="passwd1" name="passwd1" class="form-control"
										type="password" size="20" maxlength="15" />
								</div>
							</div>
							<div class="form-group">
								<label
									class="col-xs-2 col-sm-3 col-md-3 col-lg-3 control-label  required">确认新密码</label>
								<div class="col-xs-8 col-sm-7 col-md-7 col-lg-7">
									<input id="confirm1" name="confirm1" class="form-control"
										type="password" size="20" maxlength="15" />
								</div>
							</div>
						</div>
					</form>
				</div>
				<div class="modal-footer">
					<div
						class="col-xs-12 col-sm-8 col-md-6 col-lg-8 col-xs-offset-1 col-sm-offset-2 col-md-offset-3 col-lg-offset-2">
						<button type="button" id="saveBtnPwd"
							class="btn btn-primary btn-md">保&nbsp;存</button>
						<button type="button" class="btn btn-primary btn-md"
							data-dismiss="modal">取&nbsp;消</button>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!--addnew/edit form-->
	<div class="modal fade" id="modalAddnew3" tabindex="-1" role="dialog">
		<div class="modal-dialog modal-lg">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-hidden="true">&times;</button>
					<h4 class="modal-title" id="formTitle3">新增员工</h4>
				</div>
				<div class="modal-body">
					<form id="formEditor3" name="formEditor3" class="form-horizontal"
						role="form" method="post">
						<input type="hidden" id="tuid" name="tuid" value="" /> <input
							type="hidden" name="org_id" id="org_id" value="" preserve="true" />

						<div class="row clearfix">
							<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
								<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
									<div class="form-group">
										<label
											class="col-xs-2 col-sm-3 col-md-3 col-lg-4 control-label  required">登录代码</label>
										<div class="col-xs-8 col-sm-7 col-md-7 col-lg-7">
											<input id="userlogin" class="form-control" name="userlogin"
												type="text" size="20" maxlength="64" value="" /> <input
												id="user_id" name="user_id" type="hidden"
												class="form-control" size="20" value="" />
										</div>
									</div>
								</div>
								<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
									<div class="form-group">
										<label
											class="col-xs-2 col-sm-3 col-md-3 col-lg-4 control-label ">员工号码</label>
										<div class="col-xs-8 col-sm-7 col-md-7 col-lg-7">
											<input type="text" class="form-control" name="card_no"
												maxlength="16" value="" />
										</div>
									</div>
								</div>
							</div>
							<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
								<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
									<div class="form-group" id="passwd_tr">
										<label
											class="col-xs-2 col-sm-3 col-md-3 col-lg-4 control-label  required">登录密码</label>
										<div class="col-xs-8 col-sm-7 col-md-7 col-lg-7">
											<input id="passwd" class="form-control" name="passwd"
												type="password" size="20" maxlength="15" />
										</div>
									</div>
								</div>
								<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
									<div class="form-group" id="confirm_tr">
										<label
											class="col-xs-2 col-sm-3 col-md-3 col-lg-4 control-label  required">确认密码</label>
										<div class="col-xs-8 col-sm-7 col-md-7 col-lg-7">
											<input id="confirm" class="form-control" name="confirm"
												type="password" size="20" maxlength="15" />
										</div>
									</div>
								</div>
							</div>
							<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
								<div class="form-group" id="pwd_policy_tr">
									<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
										<label
											class="col-xs-2 col-sm-3 col-md-3 col-lg-4 control-label ">密码安全策略</label>
										<div class="col-xs-8 col-sm-7 col-md-7 col-lg-7">
											<select name="pwd_policy" class="form-control">
												<option value="-2">系统默认安全策略</option>
												<option value="-1">密码永不过期</option>
												<option value="15">密码15天后过期</option>
												<option value="30">密码30天后过期</option>
												<option value="60">密码60天后过期</option>
												<option value="90">密码90天后过期</option>
											</select>
										</div>
									</div>
									<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
										<input name="force_newpass" type="checkbox"
											class="form-control" value="1" /> 下次登录强制变更密码
									</div>
								</div>
							</div>
							<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
								<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
									<div class="form-group">
										<label
											class="col-xs-2 col-sm-3 col-md-3 col-lg-4 control-label  required">员工技能</label>
										<div class="col-xs-8 col-sm-7 col-md-7 col-lg-7">
											<skill-list> 
												<input id="skill_id" class="form-control" name="skill_id" type="checkbox" value="${fld:skill_id}" /> ${fld:skill_name} 
											</skill-list>
										</div>
									</div>

									<div class="form-group">
										<label
											class="col-xs-2 col-sm-3 col-md-3 col-lg-4 control-label  required">员工岗位</label>
										<div id="ceshi" class="col-xs-8 col-sm-7 col-md-7 col-lg-7">
											<!-- <org_post-rows> 
												<input id="org_post_id" class="form-control" name="org_post_id" type="checkbox" value="${fld:tuid}" /> ${fld:org_post_name} 
											</org_post-rows> -->
										</div>
									</div>
									
									<div class="form-group">
										<label
											class="col-xs-2 col-sm-3 col-md-3 col-lg-4 control-label ">默认语言</label>
										<div class="col-xs-8 col-sm-7 col-md-7 col-lg-7">
											<select id="locale" name="locale" class="form-control">
												<option value="cn">中文</option>
												<option value="en">English</option>
											</select>
										</div>
									</div>
									<div class="form-group">
										<label
											class="col-xs-2 col-sm-3 col-md-3 col-lg-4 control-label  required">
											姓名</label>
										<div class="col-xs-8 col-sm-7 col-md-7 col-lg-7">
											<input type="text" class="form-control" id="name" name="name"
												maxlength="100" value="" />
										</div>
									</div>
									<div class="form-group">
										<label
											class="col-xs-2 col-sm-3 col-md-3 col-lg-4 control-label  required">性别</label>
										<div class="col-xs-8 col-sm-7 col-md-7 col-lg-7">
											<input type="radio" id="sex" class="form-control" name="sex"
												checked="checked" value="0" />男 <input type="radio"
												id="sex" class="form-control" name="sex" value="1" />女
										</div>
									</div>

									<div class="form-group">
										<label
											class="col-xs-2 col-sm-3 col-md-3 col-lg-4 control-label ">出生日期</label>
										<div class="col-xs-8 col-sm-7 col-md-7 col-lg-7">
											<input id="birthday" class="form-control" name="birthday"
												type="text" value="" />
										</div>
									</div>
									<div class="form-group">
										<label
											class="col-xs-2 col-sm-3 col-md-3 col-lg-4 control-label ">salary</label>
										<div class="col-xs-8 col-sm-7 col-md-7 col-lg-7">
											<input type="text" class="form-control" name="salary"
												id="salary" maxlength="16" value="" />
										</div>
									</div>
									<div class="form-group">
										<label
											class="col-xs-2 col-sm-3 col-md-3 col-lg-4 control-label ">备注</label>
										<div class="col-xs-8 col-sm-7 col-md-7 col-lg-7">
											<textarea name="remark" class="form-control" cols="30"
												rows="2" maxlength="256"></textarea>
										</div>
									</div>
								</div>
								<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
									<div class="form-group">
										<label
											class="col-xs-2 col-sm-3 col-md-3 col-lg-4 control-label ">手机号码</label>
										<div class="col-xs-8 col-sm-7 col-md-7 col-lg-7">
											<input type="text" class="form-control" name="mobile"
												maxlength="30" value="" size="40" />
										</div>
									</div>
									<div class="form-group">
										<label
											class="col-xs-2 col-sm-3 col-md-3 col-lg-4 control-label ">分机号码</label>
										<div class="col-xs-8 col-sm-7 col-md-7 col-lg-7">
											<input type="text" class="form-control" name="ext_num"
												maxlength="30" value="" size="40" />
										</div>
									</div>
									<div class="form-group">
										<label
											class="col-xs-2 col-sm-3 col-md-3 col-lg-4 control-label ">Email</label>
										<div class="col-xs-8 col-sm-7 col-md-7 col-lg-7">
											<input type="text" id="email" class="form-control"
												name="email" maxlength="100" value="" size="40" />
										</div>
									</div>
									<div class="form-group">
										<label
											class="col-xs-2 col-sm-3 col-md-3 col-lg-4 control-label ">入职日期</label>
										<div class="col-xs-8 col-sm-7 col-md-7 col-lg-7">
											<input id="entry_date" class="form-control" name="entry_date"
												type="text" value="" />
										</div>
									</div>

									<div class="form-group">
										<label
											class="col-xs-2 col-sm-3 col-md-3 col-lg-4 control-label ">合同起始日期</label>
										<div class="col-xs-8 col-sm-7 col-md-7 col-lg-7">
											<input id="contract_from" class="form-control"
												name="contract_from" type="text" value="" />
										</div>
									</div>
									<div class="form-group">
										<label
											class="col-xs-2 col-sm-3 col-md-3 col-lg-4 control-label ">合同终止日期</label>
										<div class="col-xs-8 col-sm-7 col-md-7 col-lg-7">
											<input id="contract_end" class="form-control"
												name="contract_end" type="text" value="" />
										</div>
									</div>
									<div class="form-group">
										<label
											class="col-xs-2 col-sm-3 col-md-3 col-lg-4 control-label ">通讯地址</label>
										<div class="col-xs-8 col-sm-7 col-md-7 col-lg-7">
											<textarea name="address" cols="30" class="form-control"
												rows="2" maxlength="256"></textarea>
										</div>
									</div>
								</div>

								<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
									<div class="form-group">
										<label
											class="col-xs-2 col-sm-3 col-md-3 col-lg-4 control-label required">提醒方式</label>
										<div class="col-xs-8 col-sm-7 col-md-7 col-lg-7">
											<input type="checkbox" class="form-control" name="_remind_type" value="0" />系统内通知&nbsp;&nbsp;&nbsp;
											<input type="checkbox" class="form-control" name="_remind_type" value="1" />短信&nbsp;&nbsp;&nbsp;
											<input type="checkbox" class="form-control" name="_remind_type" value="2" />邮件
											<input type="hidden" id="remind_type" name="remind_type" value="" />
											</select>
										</div>
									</div>

									<input id="vipuserlogin" name="vipuserlogin" type="hidden"
										value="" />

									<div class="form-group">
										<label
											class="col-xs-5 col-sm-3 col-md-3 col-lg-4 control-label">
											拼音缩写</label>
										<div class="col-xs-6 col-sm-7 col-md-7 col-lg-7">
											<input type="text" class="form-control" id="user_pinyin"
												name="user_pinyin" maxlength="100" value="" />
										</div>
									</div>
								</div>

							</div>
						</div>
					</form>
				</div>
				<div class="modal-footer">
					<div
						class="col-xs-12 col-sm-8 col-md-6 col-lg-8 col-xs-offset-1 col-sm-offset-2 col-md-offset-3 col-lg-offset-2">
						<button type="button" id="save_btn3"
							class="btn btn-primary btn-md">保&nbsp;存</button>
						<button type="button" class="btn btn-primary btn-md"
							data-dismiss="modal">取&nbsp;消</button>
					</div>
				</div>
			</div>
		</div>
	</div>

	<input type="hidden" name="actionroot" id="actionroot"
		value="${def:actionroot}" />

	<script language="javascript">
		function OrgClass() {
			this.obj1 = null;
			this.obj2 = null;
			this.obj3 = null;
			this.search1 = null;
			this.search2 = null;
			this.search3 = null;
			this.mapObj = null;
			this.addOrg = function(org_id, org_path) {
				clearForm("formEditor");
				document.formEditor.tuid.value = "";
				$("#pid").val(org_id);
				$("#p_org_path").val(org_path);
				setCheckboxValue("org_type", "1", "formEditor");
				$("#modalAddnew").modal();
			};
			/* 地理标注 */
			this.page6 = function() {
				var obthis = this;
				obthis.mapObj = new AMap.Map("iCenter");
				/*在地图中添加ToolBar插件*/
				obthis.mapObj.plugin(["AMap.ToolBar"],function(){
					toolBar = new AMap.ToolBar();
					obthis.mapObj.addControl(toolBar);
				});
				/*为地图注册click事件获取鼠标点击出的经纬度坐标*/
				var clickEventListener=AMap.event.addListener(obthis.mapObj,'click',function(e){
					var lngx = e.lnglat.getLng();
					var laty = e.lnglat.getLat();
					$("#coordinate").val("{" + lngx + "," + laty + "}");
					obthis.mapObj.clearMap();
					obthis.addMarker(lngx, laty);
				});
				ajaxCall($("#actionroot").val()+"/mark/getmark?org_id="+$("#org_id").val(),{
					method: "get",
					progress: false,
					dataType: "script",
					success: function() {
						var _position = $("#coordinate").val();
						if("" != _position){
							_position = _position.replace("{","").replace("}","");
							var tmp = _position.split(",");
							obthis.addMarker(tmp[0], tmp[1]);
						}else{
							obthis.mapObj.setCity("010");
						}
					}
				});
				$("#area_code").unbind().on("change",function(){
					if($("#area_code").val()!=""){
						obthis.mapObj.setCity($("#area_code").val());
					}
				});
				$("#save_btn_mark").unbind();
				$("#save_btn_mark").unbind().on("click",function(e){
					if($("#coordinate").val()==""){
						$Dialog().notice("请先进行标记后再保存.",1500);
					}else{
						ajaxCall($("#actionroot").val()+"/mark/update?"+$("form[name='form_mark']").serialize(),{
							method: "get",
							button: "save_btn_mark",
							progress: true,
							dataType: "script",
							success: function() {
							},
							error: function() {
								$Dialog().notice("保存失败.",1500);
							}
						});
					}
					e.preventDefault();
				});
			};
			/*实例化点标记*/
			this.addMarker = function (lngx, laty){
				var obthis = this;
				marker = new AMap.Marker({
					icon:"http://webapi.amap.com/images/marker_sprite.png",
					position:new AMap.LngLat(lngx,laty)
				});
				marker.setMap(obthis.mapObj);  /*在地图上添加点*/
				obthis.mapObj.setFitView();	/* 自适应窗口*/
			};
			this.page1 = function() {
				var obth = this;
				obth.search1 = $Search(
						{
							datagrid : "datagrid1",
							formId : "searchForm1",
							button : "search_btn1",
							resetButton : "search_reset_btn1",
							actionroot : "/action/ccms/module/hr/org/orgpost",
							success : function() {
								$(".edit_btn1").unbind("click");
								$(".edit_btn1")
										.on(
												"click",
												function() {
													if ($(this).attr("code") != undefined
															&& $(this).attr(
																	"code") != "") {
														obth.obj1.edit({
															id : $(this).attr(
																	"code")
														});
													}
												});
								$(".delete_btn1").unbind("click");
								$(".delete_btn1")
										.on(
												"click",
												function() {
													var obthis = $(this);
													$Dialog()
															.confirm(
																	"确定要删除该条数据吗?",
																	function() {
																		if (obthis
																				.attr("code") != undefined
																				&& obthis
																						.attr("code") != "") {
																			obth.obj1
																					.del({
																						id : obthis
																								.attr("code")
																					});
																		}
																	});
												});
							}
						}).initSearchBtn().searchData(1);
				var orgId = document.searchForm1.org_id.value;
				ajaxCall("/action/ccms/module/hr/org/orgpost/crud?org_id="
						+ orgId, {
					method : "GET",
					progress : true,
					dataType : "json",
					success : function(data) {
						var data1 = data.data1;
						document.formEditor1.pid.options.length = 1;
						data1.pop();
						for ( var key in data1) {
							var obj = data1[key];
							$(document.formEditor1.pid).append(
									"<option value='"+obj.tuid+"'>"
											+ obj.org_post_name + "</option>");
						}
						var data2 = data.data2;
						document.formEditor1.post_id.options.length = 1;
						data2.pop();
						for ( var key in data2) {
							var obj = data2[key];
							$(document.formEditor1.post_id).append(
									"<option value='"+obj.post_id+"'>"
											+ obj.post_name + "</option>");
						}
						var data3 = data.data3;
						document.formEditor2.org_post_id.options.length = 1;
						data3.pop();
						var cheshiHtml = "";
						for ( var key in data3) {
							var obj = data3[key];
							$(document.formEditor2.org_post_id).append(
									"<option value='"+obj.tuid+"'>"
											+ obj.org_post_name + "</option>");
							cheshiHtml +="<input id='org_post_id' class='form-control' name='org_post_id' type='checkbox' value='"+obj.tuid+"' /> "
									+ obj.org_post_name;
						}
						$("#ceshi").html(cheshiHtml);
						ccms.util.renderCheckbox("org_post_id");

					}
				});
			};
			this.page2 = function() {
				var obth = this;
				obth.search2 = $Search(
						{
							datagrid : "datagrid2",
							formId : "searchForm2",
							button : "search_btn2",
							resetButton : "search_reset_btn2",
							actionroot : "/action/ccms/module/hr/org/headcount",
							rowpackage : function(obj) {
								var button = "";
								button = '<a href="javascript:void(0)" title="编辑"><span class="glyphicon glyphicon-pencil edit_btn2" code="'+obj.hc_id+'"></span></a>&nbsp;&nbsp;&nbsp;&nbsp;';
								button += '<a href="javascript:void(0)" title="删除"><span class="glyphicon glyphicon-remove delete_btn2" code="'+obj.hc_id+'"></span></a>&nbsp;&nbsp;&nbsp;&nbsp;';
								button += '<a href="javascript:void(0)" title="人员信息"><span class="glyphicon glyphicon-user searchstaff_btn2" code="'+obj.hc_id+'"></span></a>&nbsp;&nbsp;&nbsp;&nbsp;';
								if (obj.userlogin != "") {
									button += '<a href="javascript:void(0)" title="清除"><span class="glyphicon glyphicon-share-alt delstaff_btn2" code="'+obj.userlogin+'" ></span></a>';
								}
								obj.button = button;
							},
							success : function() {
								$(".add_btn2")
										.on(
												"click",
												function() {
													if ($(this).attr("code") != undefined
															&& $(this).attr(
																	"code") != "") {
														obth.add_btn2($(this)
																.attr("code"));
													}
												});
								$(".edit_btn2")
										.on(
												"click",
												function() {
													if ($(this).attr("code") != undefined
															&& $(this).attr(
																	"code") != "") {
														obth.obj2.edit({
															id : $(this).attr(
																	"code")
														});
													}
												});
								$(".delete_btn2")
										.on(
												"click",
												function() {
													var obthis = $(this);
													$Dialog()
															.confirm(
																	"确定要删除该条数据吗?",
																	function() {
																		if (obthis
																				.attr("code") != undefined
																				&& obthis
																						.attr("code") != "") {
																			obth.obj2
																					.del({
																						id : obthis
																								.attr("code")
																					});
																		}
																	});
												});
								$(".searchstaff_btn2")
										.on(
												"click",
												function() {
													if ($(this).attr("code") != undefined
															&& $(this).attr(
																	"code") != "") {
														var org = document.searchForm2.org_id.value;
														obth
																.search_btn2(
																		$(this)
																				.attr(
																						"code"),
																		org);
													}
												});
								$(".delstaff_btn2")
										.on(
												"click",
												function() {
													if ($(this).attr("code") != undefined
															&& $(this).attr(
																	"code") != "") {
														obth.delstaff_btn2($(
																this).attr(
																"code"));
													}
												});
							}
						}).initSearchBtn().searchData(1);
			};
			this.page3 = function() {
				var obth = this;
				obth.search3 = $Search(
						{
							datagrid : "datagrid3",
							formId : "searchForm3",
							button : "search_btn3",
							resetButton : "search_reset_btn3",
							actionroot : "/action/ccms/module/hr/org/staff",
							rowpackage : function(obj) {
								if (obj.state == "正常") {
									obj.button = '<a title="禁用" href="javascript:void(0)"><span class="glyphicon glyphicon-lock disable_btn" code="'+obj.user_id+'"></span></a>';

								} else {
									obj.button = '<a title="启用" href="javascript:void(0)"><span class="glyphicon glyphicon-off enable_btn" code="'+obj.user_id+'"></span></a>';
								}
							},
							success : function() {
								$(".edit_btn3")
										.on(
												"click",
												function() {
													if ($(this).attr("code") != undefined
															&& $(this).attr(
																	"code") != "") {
														$("#formTitle3").html(
																"修改员工信息");
														obth.obj3.edit({
															id : $(this).attr(
																	"code")
														});
													}
												});


								$(".delete_btn3")
										.on(
												"click",
												function() {
													var obthis = $(this);
													$Dialog()
															.confirm(
																	"确定要删除吗?",
																	function() {
																		if (obthis
																				.attr("code") != undefined
																				&& obthis
																						.attr("code") != "") {
																			obth.obj3
																					.del({
																						id : obthis
																								.attr("code")
																					});
																		}
																	});
												});
								$(".disable_btn")
										.on(
												"click",
												function() {
													var obthis = $(this);
													$Dialog()
															.confirm(
																	"确定要禁用此用户吗?",
																	function() {
																		if (obthis
																				.attr("code") != undefined
																				&& obthis
																						.attr("code") != "") {
																			var url = "/action/ccms/module/hr/staff/disable?id="
																					+ obthis
																							.attr("code");
																			ajaxCall(
																					url,
																					{
																						method : "get",
																						progress : true,
																						dataType : "script",
																						success : function() {
																							obth.search3
																									.searchData();
																						}
																					});
																		}
																	});
												});
								$(".enable_btn")
										.on(
												"click",
												function() {
													var obthis = $(this);
													$Dialog()
															.confirm(
																	"确定要启用此用户吗?",
																	function() {
																		if (obthis
																				.attr("code") != undefined
																				&& obthis
																						.attr("code") != "") {
																			var url = "/action/ccms/module/hr/staff/enable?id="
																					+ obthis
																							.attr("code");
																			ajaxCall(
																					url,
																					{
																						method : "get",
																						progress : true,
																						dataType : "script",
																						success : function() {
																							obth.search3
																									.searchData();
																						}
																					});
																		}
																	});
												});
								$(".resetPW_btn")
										.on(
												"click",
												function() {
													if ($(this).attr("code") != undefined
															&& $(this).attr(
																	"code") != "") {
														var url = "/action/ccms/module/hr/org/staff/newpass/form?user_id="
																+ $(this).attr(
																		"code");
														ajaxCall(
																url,
																{
																	method : "get",
																	progress : true,
																	dataType : "script",
																	success : function() {
																		$(
																				"#modalAddnewPwd")
																				.modal(
																						"show");
																	}
																});
													}
												});
							}
						}).initSearchBtn().searchData(1);

				$("#saveBtnPwd")
						.on(
								"click",
								function() {
									var url = "/action/ccms/module/hr/org/staff/newpass/update";
									ajaxCall(url, {
										method : "post",
										progress : true,
										form : "formEditorPwd",
										button : "saveBtnPwd",
										dataType : "script",
										success : function() {
											$Dialog().alert("修改成功！");
											//$("#modalAddnewPwd").modal("hide");
											ccms.dialog.close();

										}
									});
								});

				$Dialog().date($('#birthday'));
				$Dialog().date($('#entry_date'));
				$Dialog().date($('#contract_end'));
				$Dialog().date($('#trial_end'));
				$Dialog().date($('#contract_from'));
				$Dialog().date($('#dispatch_date'));
				$Dialog().date($('#dispatch_date'));
				$Dialog().date($('#business_hours'));
			};
			this.page5 = function() {
				var obth = this;
				var org_id=document.searchForm5.org_id.value;
				var url = "/action/ccms/module/hr/org/storedetails/edit?org_id="+org_id;
				 ajaxCall(url,{
					method: "get",
					progress: true,
					dataType: "script",
					success: function() {
					}
				});
				 $("#storedetails_btn").unbind().on("click",function(){
					 var url = "/action/ccms/module/hr/org/storedetails/update";
					 ajaxCall(url,{
						method: "post",
						progress: true,
						form : "searchForm5",
						dataType: "script",
						success: function() {
						}
					});
				 });
				 
				 
					 $("#storedetails_del").unbind().on("click",function(){
						 var obthis = $(this);
						 var tuid=document.searchForm5.tuid_m.value;
						$Dialog().confirm("确定要删除吗？",function(){
								var url = "/action/ccms/module/hr/org/storedetails/delete?tuid="+tuid;
								ajaxCall(url,{
									method: "post",
									progress: true,
									dataType: "script",
									success: function() {
									}
								});
							});
						});
			};

			this.add_btn2 = function(code) {
				document.formEditor2.tuid.value = "";
				clearForm("formEditor2");
				document.formEditor2.org_post_id.value = code;
				$("#modalAddnew2").modal();
			};
			this.search_btn2 = function(code, org) {
				var obth = this;
				document.searchStaffForm.hc_id.value = code;
				document.searchStaffForm.org_id.value = org;
				$Search(
						{
							datagrid : "datagridStaff",
							formId : "searchStaffForm",
							button : "searchStaff_btn",
							resetButton : "searchStaff_reset_btn",
							actionroot : "/action/ccms/module/hr/org/headcount/staff",
							success : function() {
								$(".addStaffBtn").unbind();
								$(".addStaffBtn")
										.on(
												"click",
												function() {
													var obthis = $(this);
													if (obthis.attr("code") != undefined
															&& obthis
																	.attr("code") != "") {
														var userlogin = obthis
																.attr("code");
														var hc_id = document.searchStaffForm.hc_id.value;
														obth.updateStaffHc(
																userlogin,
																hc_id);
													}
												});
							}
						}).initSearchBtn().searchData(1);
				$("#searchStaffModal").modal();
			};
			this.updateStaffHc = function(userlogin, hc_id) {
				var obthis = this;
				var url = "/action/ccms/module/hr/org/headcount/staff/insert?userlogin="
						+ userlogin + "&hc_id=" + hc_id;
				ajaxCall(url, {
					method : "get",
					progress : true,
					dataType : "script",
					success : function() {
						obthis.search2.searchData();
						//$("#searchStaffModal").modal("hide");
						ccms.dialog.close();
					}
				});
			};
			this.delstaff_btn2 = function(code) {
				var obthis = this;
				$Dialog()
						.confirm(
								"确定要将岗位和员工分离吗?",
								function() {
									if (code != undefined && code != "") {
										var url = "/action/ccms/module/hr/org/headcount/staff/delete?userlogin="
												+ code;
										ajaxCall(url, {
											method : "get",
											progress : true,
											dataType : "script",
											success : function() {
												obthis.search2.searchData();
											}
										});
									}
								});
			};
			this.orgDetail = function(orgId) {
				document.formEditor1.org_id.value = orgId;
				document.searchForm1.org_id.value = orgId;
				document.searchForm2.org_id.value = orgId;
				document.searchForm3.org_id.value = orgId;
				document.formEditor3.org_id.value = orgId;
				document.searchForm5.org_id.value = orgId;
				document.form_mark.org_id.value = orgId;
				$('#org_workspace').show();
				this.page1();
				this.page2();
				this.page3();
				this.page5();
				this.page6();
			};
			this.init = function() {
				var obthis = this;
				$(".org_btn").unbind();
				$(".org_btn").unbind().on("click", function() {
					var code = $(this).attr("code");
					obthis.orgDetail(code);
				});
				var obj = $Crud({
					formId : "formEditor",
					button : "save_btn",
					insertBack : function() {
						window.location.reload();
					},
					updateBack : function() {
						window.location.reload();
					},
					deleteBack : function() {
						
					},
					validate : function() {
						var flag = $("#formEditor").validate({
							rules : {
								org_name : {
									required : true,
									rangelength : [ 2, 25 ]
								},
								short_name : {
									rangelength : [ 0, 25 ]
								},
								show_order : {
									required : false,
									isNumber : true
								}
							},
							messages : {
								org_name : {
									required : "请输入组织名称",
									rangelength : "组织名称的长度为2到25位"
								},
								short_name : {
									rangelength : "组织短名的长度为0到25位"
								},
								show_order : {
									required : "请输入手机号码",
									isNumber : "请输入数字"
								}
							}
						});
						return flag;
					},
					check : function() {
						return true;
					}
				}).init();
				$(".add_btn").unbind().on("click", function() {
					var org_id = $(this).attr("code");
					var org_path = $(this).attr("path");
					$("#upload_image").attr("src","");
					obthis.addOrg(org_id, org_path);
				});
				$(".edit_btn").on(
						"click",
						function() {
							if ($(this).attr("code") != undefined
									&& $(this).attr("code") != "") {
								obj.edit({
									id : $(this).attr("code")
								});
							}
						});
				$(".delete_btn").on(
						"click",
						function() {
							var obthis = $(this);
							$Dialog().confirm(
									"确定要删除该条数据吗?",
									function() {
										if (obthis.attr("code") != undefined
												&& obthis.attr("code") != "") {
											obj.del({
												id : obthis.attr("code")
											});
										}
									});
						});
				$("#addnew_btn1")
						.on(
								"click",
								function() {
									document.formEditor1.tuid.value = "";
									clearForm("formEditor1");
									document.formEditor1.org_id.value = document.searchForm1.org_id.value;
									$("#modalAddnew1").modal();
								});
				obthis.obj1 = $Crud({
					formId : "formEditor1",
					searchForm : "searchForm1",
					button : "save_btn1",
					resetButton : "reset_btn1",
					searchResetButton : "search_reset_btn1",
					searchButton : "search_btn1",
					actionroot : "/action/ccms/module/hr/org/orgpost",
					modalId : "modalAddnew1",
					insertBack : function() {
						obthis.search1.searchData();
					},
					updateBack : function() {
						obthis.search1.searchData();
					},
					deleteBack : function() {
						obthis.search1.searchData();
					},
					validate : function() {
						var flag = $("#formEditor1").validate({
							rules : {
								org_post_name : {
									required : true,
									rangelength : [ 2, 25 ]
								},
								post_id : {
									required : true
								},
								show_order : {
									isNumber : true
								}
							},
							messages : {
								org_post_name : {
									required : "请输入组织名称",
									rangelength : "组织名称的长度为2到25位"
								},
								post_id : {
									required : "请选择岗位类型"
								},
								show_order : {
									isNumber : "请输入数字"
								}
							}
						});
						return flag;
					},
					check : function() {
						return true;
					}
				}).init();
				obthis.obj2 = $Crud({
					formId : "formEditor2",
					button : "save_btn2",
					resetButton : "reset_btn2",
					actionroot : "/action/ccms/module/hr/org/headcount",
					modalId : "modalAddnew2",
					addNewButton : "addnew_btn2",
					insertBack : function() {
						obthis.search2.searchData();
					},
					updateBack : function() {
						obthis.search2.searchData();
					},
					deleteBack : function() {
						obthis.search2.searchData();
					},
					validate : function() {
						var flag = $("#formEditor2").validate({
							rules : {
								org_name : {
									required : true,
									rangelength : [ 2, 25 ]
								},
								short_name : {
									rangelength : [ 0, 25 ]
								},
								show_order : {
									required : false,
									isNumber : true
								}
							},
							messages : {
								org_name : {
									required : "请输入组织名称",
									rangelength : "组织名称的长度为2到25位"
								},
								short_name : {
									rangelength : "组织短名的长度为0到25位"
								},
								show_order : {
									required : "请输入手机号码",
									isNumber : "请输入数字"
								}
							}
						});
						return flag;
					},
					check : function() {
						return true;
					}
				}).init();
				obthis.obj3 = $Crud({
					formId : "formEditor3",
					button : "save_btn3",
					resetButton : "reset_btn3",
					actionroot : "/action/ccms/module/hr/org/staff",
					modalId : "modalAddnew3",
					addNewButton : "addnew_btn3",
					insertBack : function() {
						obthis.search3.searchData();
					},
					updateBack : function() {
						obthis.search3.searchData();
					},
					deleteBack : function() {
						obthis.search3.searchData();
					},
					addNewBack : function() {
						$("#passwd_tr").show();
						$("#confirm_tr").show();
						$("#pwd_policy_tr").show();
						setCheckboxValue("sex", "0", "formEditor3");
						document.formEditor3.userlogin.disabled = false;
						
					},
					validate : function() {
						var flag = $("#formEditor3").validate({
							rules : {
								userlogin : {
									required : true,
									rangelength : [ 1, 64 ]
								},
								skill_id : {
									required : true,
								},
								passwd : {
									required : true,
									rangelength : [ 1, 15 ]
								},
								confirm : {
									required : true,
									rangelength : [ 1, 15 ]
								},
								name : {
									required : true,
									rangelength : [ 1, 25 ]
								},
								sex : {
									required : true
								},
								mobile : {
									isMobile : true
								}
							},
							messages : {
								userlogin : {
									required : "请输入登录代码",
									rangelength : "登录代码长度为1到64位"
								},
								skill_id : {
									required : "请选择员工技能"
								},
								passwd : {
									required : "请输入登录密码",
									rangelength : "登录密码长度为1到15位"
								},
								confirm : {
									required : "请输入确认密码",
									rangelength : "确认密码长度为1到15位"
								},
								name : {
									required : "请输入名称",
									rangelength : "名称长度为1到25位"
								},
								sex : {
									required : "请选择性别"
								}

							}
						});
						return flag;
					},
					check : function() {
						document.formEditor3.userlogin.disabled = false;
						var hours_begin = $("#business_hours_begin").val();
						var hours_end = $("#business_hours_end").val();
						var hours_type = "1";
						if( undefined != hours_begin && "" != hours_begin 
								&& undefined != hours_end && "" != hours_end ){
							hours_begin = hours_begin.replace(":","");
							hours_end = hours_end.replace(":","");
							if( hours_begin > hours_end ){
								hours_type = "2";
							}
						}
						$("#business_hours_type").val(hours_type);
		    			$("#remind_type").val(ccms.util.getCheckboxValue("_remind_type","formEditor3"));
						return true;
					}
				}).init();
			};
			$("#weixin_publish").on(
					"click",function(){
						var url="/action/ccms/module/hr/org/publish?pid=0&&weixin_org_pid=1";
						var map={"method":"GET","dataType":"script"}
						ajaxCall(url,map);
					});
		}

		var orgClass = null;
		var d = null;
		function web_init () {

							//初始化树
							d = new dTree('d');
							var org_title="<button class='btn btn-primary btn-md' type='button' data-toggle='modal' id='weixin_publish'>微信发布</button>";
							org_title = org_title+"&nbsp;&nbsp;<a href='javascript: d.openAll();'>展开</a> | <a href='javascript: d.closeAll();'>合并</a>&nbsp;&nbsp;<a href='javascript:void(0)' title='添加' class='add_btn' code='0' path='12' ><span class='glyphicon glyphicon-plus'></span></a>";

							d.add(0, -1, org_title);

							var org_name = "";
							var buttonAddNode = "";
							var buttonEdit = "";
							var buttonDelete = "";

							var allBtn = "";

							<combo-orgs>
							org_name = "<a href='javascript:void(0)' class='org_btn' code='${fld:org_id}' >${fld:org_name@js}</a>";
							buttonAddNode = "&nbsp;&nbsp;&nbsp;&nbsp;<a href='javascript:void(0)' class='add_btn' title='添加' code='${fld:org_id}' path='${fld:org_path@js}' ><span class='glyphicon glyphicon-plus'></span></a>&nbsp;&nbsp;&nbsp;&nbsp;";
							buttonEdit = "<a href='javascript:void(0)' class='edit_btn' code='${fld:org_id}' title='修改'> <span class='glyphicon glyphicon-pencil'></span></a>&nbsp;&nbsp;&nbsp;&nbsp;";
							buttonDelete = "<a href='javascript:void(0)' title='删除' class='delete_btn' code='${fld:org_id}' ><span class='glyphicon glyphicon-remove'></span></a>";
							allBtn = buttonAddNode + buttonEdit + buttonDelete;
							d.add("${fld:org_id}", "${fld:pid}", org_name
									+ allBtn);
							</combo-orgs>

							$("#searchForm").append(d.toString());

							orgClass = new OrgClass();
							orgClass.init();
							
							ccms.dialog.time($("#business_hours_begin"));
							ccms.dialog.time($("#business_hours_end"));
						}
		function uploadImg(){
			var url = "${def:context}/action/ccms/module/attachment/crud";
			ccms.dialog.open({url:url,id:"upload__image",width:500,height:500});
		}
		function uploadOk(id){
			var url = "${def:context}${def:actionroot}/setimage";
			ajaxCall(url,{
				method: "get",
				progress: false,
				form: "formEditor",
				dataType: "script",
				success: function() {
					
				}
		    });
		}
	</script>
</body>
</html>