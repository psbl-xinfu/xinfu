<!DOCTYPE html>
<html>
<head>
${inc:/action/project/fitness/home/pub}
<title>客户资源列表</title>
<!-- <style type="text/css">
 .inputs{
background: #2A3038 !important;
color: red !important;
}
</style> -->
</head>
<body>
	<div class="modal fade" id="modalAddnew"  tabindex="-1" style="display:none;">
		<div class="basic-information modal-dialog dialogbg" >
				<header class="header-default">
					<span id="formTitle">新增</span>
					<span class="header-close"></span>
				</header>
				<div class="b-i-main  yyc_b-i-main">
					<form id="addForm" name="addForm" method="post">
					<input type="hidden" id="cc_code" name="cc_code" value=""/>
					<input type="hidden" id="cus_code" name="cus_code" value=""/>
					<input type="hidden" id="in_recommend_name" name="in_recommend_name" value=""/>
			    	<aside style="float: left">
						<p>
							<img id="headpic" src="${def:context}/js/project/fitness/image/SVG/170X220.svg">
							<span id="upload_btn"></span>
						</p>
					 </aside>
					<nav >
						<li>
							<label>姓名<span style="color: red;">*</span></label>
							<input type="text" id="cc_name" name="cc_name" value="" maxlength="80"  placeholder="姓名"/>
						</li>
						
						<li> 			
							<label>性别<span style="color: red;">*</span></label>
							<div class="my-selected">
								<select  id="cc_sex" name="cc_sex"> 
									<option value="">请选择</option>
									<option value="1">男</option>
									<option value="0">女</option>
								</select>
							</div> 	
			 			</li>
			 			
			 			
			 			
		<!-- 	 			<li>
			 			<label></label> 	
			 			<input  class="inputs" type="text" value="值不能为空"  readonly="readonly"  />
			 			</li>
			 			
			 			<li >
			 			<label></label> 	
			 			<input class="inputs" type="text"  value="值不能为空" readonly="readonly"/>
			 			</li> -->
			 			
			 			
			 			
						<li> 		
							<label>手机<span style="color: red;">*</span></label> 	
							<input type="text" id="cc_mobile" name="cc_mobile" value="" maxlength="80"  placeholder="手机"/>
			 			</li>	
						<li></li>
						<li >
							<label>生日<span style="color: red;">*</span></label>
							<select  id="cc_birth" name="cc_birth" class=""> 
								<option value="">请选择月</option>
								<month>
									<option value="${fld:domain_value}">${fld:domain_text_cn}</option>
								</month>
							</select>
						</li>
						<li>
							<label><span style="color: red;">*</span></label>
							<select  id="cc_day" name="cc_day" class=""> 
								<option value="">请选择日</option>
								<day>
									<option value="${fld:domain_value}">${fld:domain_text_cn}</option>
								</day>
							</select>
						</li>
						<li>
							<label>微信</label>
							<input type="text" id="cc_wx" name="cc_wx" value="" maxlength="80" placeholder="微信"/>
						</li>
						<li> 			
							<label>qq</label> 	
							<input type="text" id="cc_qq" name="cc_qq" value="" maxlength="80" placeholder="qq" />
			 			</li>	
			 			<li> 			
							<label>E-mail</label> 	
							<input type="text" id="cc_email" name="cc_email" value="" maxlength="80" placeholder="email"/>
			 			</li>	
						<li> 			
							<label>年龄范围<span style="color: red;">*</span></label> 	
							<div class="my-selected">
								<select  id="cc_age" name="cc_age"> 
									<option value="">请选择</option>
									<age>
										<option value="${fld:domain_value}">${fld:domain_text_cn}</option>
									</age>
								</select>
							</div> 
			 			</li>					
						<li> 			
							<label>会籍<span style="color: red;">*</span></label> 	
							<div class="my-selected">
								<select id="cc_mc" name="cc_mc"   >
									<option value="">请选择</option>
									<staff-rows3>
										<option value="${fld:userlogin}">${fld:name}</option>
									</staff-rows3>
								</select>
							</div> 
			 			</li>
						<li> 			
							<label>获客渠道<span style="color: red;">*</span></label> 	
							<div class="my-selected">
								<select  id="cc_type" name="cc_type"> 
								<option value="">请选择</option>
									<guesttype-rows2>
										<option value="${fld:vc_topic}">${fld:vc_content}</option>
									</guesttype-rows2>
								</select>
							</div> 
			 			</li>	
				 		<li> 			
							<label>客户分类</label> 	
							<div class="my-selected">
								<select  id="cc_customtype" name="cc_customtype"> 
									<option value="">请选择</option>
									<customerClassification>
											<option value="${fld:vc_topic}">${fld:vc_content}</option>
									</customerClassification>
								</select>
							</div>
					 	</li>		
						<li> 			
							<label>关注度</label> 	
							<div class="my-selected">
								<select  id="cc_level" name="cc_level"> 
										<option value="0">请选择</option>
										<option value="1">高关注</option>
										<option value="2">普通</option>
										<option value="3">不关注</option>
								</select>
							</div> 
			 			 </li>	
						<li> 			
							<label>推荐人</label> 	
							<input type="text" id="recommend" name="recommend" value="" maxlength="80"  placeholder="推荐人"/>
			 			 </li>
						<li> 			
							<label>证件类型</label> 	
							<div class="my-selected">
								<select  id="cc_cardtype" name="cc_cardtype"> 
									<option value="">请选择</option>
									<option value="0">身份证</option>
									<option value="1">驾驶证</option>
									<option value="2">其他</option>
								</select>
							</div> 
			 			 </li>		 	
			 			 <li> 			
							<label>证件号码</label> 	
							<input type="text" id="cc_card" name="cc_card" value="" maxlength="80" placeholder="证件号码" />
			 			 </li>			 			 
			 			 <li> 			
							<label>国籍</label> 	
							<div class="my-selected">
								<select  id="cc_nationality" name="cc_nationality"  >
									<option value="">国籍</option>
									<guoji-row>
										<option value="${fld:param_value}">${fld:param_text}</option>
									</guoji-row> 
								</select>
							</div>
			 			 </li>	
			 			 <li> 			
							<label>民族</label> 	
							<div class="my-selected">
								<select  id="cc_nation" name="cc_nation"> 
									<option value="">请选择</option>
									<nation>
										<option value="${fld:vc_topic}">${fld:vc_content}</option>
									</nation>
								</select>
							</div>
			 			 </li>				 			
			 			<li> 			
							<label>职业</label> 	
							<input type="text" id="cc_occupation" name="cc_occupation" value="" maxlength="80"  placeholder="职业"/>
			 			 </li>			 			 
				 		<li> 			
							<label>家庭住址</label> 	
							<div class="my-selected">
								<select  id="province" name="province"> 
									<option value="">请选择省</option>
								</select>
							</div>
					 </li>		
			 		<li> 			
						<label>市</label> 	
						<div class="my-selected">
							<select  id="city" name="city"> 
								<option value="">请选择市</option>
							</select>
						</div>
					 </li>						 
		 			 <li> 			
						<label>家庭详细地址</label> 	
						<input type="text" id="cc_addr" name="cc_addr" value="" maxlength="80" placeholder="详细地址" />
		 			 </li>		
			 		 <li>
					 </li>
		 			 <li> 			
						<label>公司名称</label> 	
						<input type="text" id="cc_officename" name="cc_officename" value="" maxlength="80" placeholder="公司名称" />
		 			 </li>
		 			  <li> 			
						<label>公司电话</label> 	
						<input type="text" id="cc_officetel" name="cc_officetel" value="" maxlength="80" placeholder="公司电话"/>
		 			 </li>			 			 
			 		<li> 			
						<label>公司地址</label> 	
						<div class="my-selected">
							<select  id="province2" name="province2"> 
								<option value="">请选择省</option>
							</select>
						</div>
					 </li>		
			 		<li> 			
						<label>市</label> 	
						<div class="my-selected">
							<select  id="city2" name="city2"> 
								<option value="">请选择市</option>
							</select>
						</div>
					 </li>			
			 			 <li> 			
							<label>公司详细地址</label> 	
							<input type="text" id="cc_officeaddr" name="cc_officeaddr" value="" maxlength="80"  placeholder="公司地址"/>
			 			 </li>				 			 		 	
			 			 <li>
			 			 </li>
			 			 <li> 			
							<label>紧急联系人</label> 	
							<input type="text" id="cc_urgent" name="cc_urgent" value="" maxlength="80"  placeholder="紧急联系人"/>
			 			 </li>	
			 			  <li> 			
							<label>联系人电话</label> 	
							<input type="text" id="cc_othertel" name="cc_othertel" value="" maxlength="80" placeholder="联系人电话"/>
			 			 </li>
				 		<li> 			
							<label>健身目的</label> 	
							<div class="my-selected">
								<select  id="cc_purpose" name="cc_purpose"> 
									<option value="">请选择</option>
										<fitnessPurpose>
												<option value="${fld:vc_topic}">${fld:vc_content}</option>
										</fitnessPurpose>
								</select>
							</div>
					 </li>		
				 		<li> 			
							<label>是否参加过俱乐部</label> 	
							<div class="my-selected">
								<select id="cc_participate" name="cc_participate"> 
									<option value="">请选择</option>
									<option value="1">是</option>
									<option value="0">否</option>
								</select>
							</div>
					 </li>		
		 			 <li> 			
							<label>品牌</label> 	
							<input type="text" id="cc_brand" name="cc_brand" value="" maxlength="80"  placeholder="品牌"/>
		 			 </li>		
				 		<li> 			
							<label>是否曾是本俱乐部会员</label> 	
							<div class="my-selected">
								<select  id="cc_ismember" name="cc_ismember"> 
									<option value="">请选择</option>
									<option value="1">是</option>
									<option value="0">否</option>
								</select>
							</div>
					 </li>		
				 		<li> 			
							<label>离开原因</label> 	
							<div class="my-selected">
								<select  id="cc_leave" name="cc_leave"> 
									<option value="">请选择</option>
									<leave>
										<option value="${fld:domain_value}">${fld:domain_text_cn}</option>
									</leave>
								</select>
							</div>
					 </li>					 			 
				 		<li> 			
							<label>获取咨询习惯</label> 	
							<div class="my-selected">
								<select  id="cc_gethobbit" name="cc_gethobbit"> 
									<option value="">请选择</option>
									<consultingHabit>
											<option value="${fld:vc_topic}">${fld:vc_content}</option>
									</consultingHabit>
								</select>
							</div>
					 </li>					 			 
				 		<li> 			
							<label>个人爱好</label> 	
							<div class="my-selected">
								<select  id="cc_personalhobbit" name="cc_personalhobbit"> 
									<option value="">请选择</option>
									<personalHobbies>
											<option value="${fld:vc_topic}">${fld:vc_content}</option>
									</personalHobbies>
								</select>
							</div>
					 </li>		
				 		<li> 			
							<label>子女情况</label> 	
							<div class="my-selected">
								<select  id="cc_children" name="cc_children"> 
									<option value="">请选择</option>
									<children>
										<option value="${fld:domain_value}">${fld:domain_text_cn}</option>
									</children>
								</select>
							</div>
					 </li>						 
				 		<li> 			
							<label>婚姻情况</label> 	
							<div class="my-selected">
								<select id="cc_marriage" name="cc_marriage"> 
									<option value="">请选择</option>
									<mariy>
										<option value="${fld:domain_value}">${fld:domain_text_cn}</option>
									</mariy>
								</select>
							</div>
					 </li>						 
			 			<li class="to100w" style="margin-left: 6%">
							<label>备注</label>
							<textarea id="cc_remark" name="cc_remark" placeholder="暂无数据" class="my-textarea" rows="" cols="4"></textarea>
						</li>	
					</nav>
					</form>
				</div>
				<footer class="footer-default">
					<button id="save_btn" class="my-btn-default active">保存</button>
				</footer>
			</div>
		</div>		
		<form  role="form" method="post" id="searchForm">
			<input name="sort" type="hidden" value="g.created" preserve="true" />
			<input name="order" type="hidden" value="desc" preserve="true" />
			<input name="pageNo" type="hidden" value="" preserve="true" />
			<input name="totalPages" type="hidden" value="" preserve="true" />
			<input name="period_day" id="period_day" type="hidden" value="${fld:period_day}" preserve="true" />
				
			<!-- 条件筛选开始 -->
			<input id="filterconditionscolumn" type="hidden" 
			value="f_demand,f_sex,f_age,f_entrystartdate,f_entryenddate,f_startmonth,f_startday,f_endmonth,f_endday,f_genjintype,f_type,f_mc,f_level,f_purpose,f_stage,f_personalhobbit,f_marriage,f_children,f_leave,f_participate,f_ismember,f_protection,f_calltimes,f_distributioncount"/>
			<div id="filterconditionshtml">
			</div>
			<!-- 条件筛选结束 -->
	
			<div class="am-tabs-bd r-tab-cont">
				<div class="c-n-nav-2 am-tab-panel am-in am-active am-fade three-none" >
					<div class="tab-cout-nav">
						<div class="tab-cout-nav-t yyc_tab-cout-nav-t">
							<nav class="tab-nav-my">
								<li class="dateTime">
										<input id="_start_date" name="_start_date" type="text" class="input-default"/>
								</li>
								<li class="dateTime">
									<input id="_end_date" name="_end_date" type="text"class="input-default"/>
								</li>
								<li class="inputName" style="width: 160px">
									<input style="width: 130px" type="text" id="vc_name" name="vc_name" placeholder="资源编号/姓名/电话" class="input-default"/>							
				 			 	</li>		
								<li>
								  <select id="i_public" name="i_public" style="display: none;">
									  <option value="">公共资源</option>
									  <option value="1">是</option>
									  <option value="0">否</option>
								  </select>
								</li>
								<li style="width: 160px">
								  <select id="newmc" name="newmc" style="display: none;">
									  <option value="">全部会籍</option>
									  <skillname-row>
											<option  value='${fld:userlogin}'>${fld:name@js}</option>
									  </skillname-row>
								  </select>
								</li>
								<div class="r-c-btnList b-10">
									<button type="button" class="r-c-3-btn-1" code=1 id="search_btn" title="查询"></button>
									<img src="${def:context}/js/project/fitness/image/SVG/nav/xinzengkecheng.svg" title="添加" alt="" data-toggle="modal" id="addnew_btn">
									<img class="r-c-3-btn-3" src="${def:context}/js/project/fitness/image/SVG/nav/btn_shaixuan.svg" title="条件筛选" data-toggle="modal" id="filter_btn"/>
									<button type="button"  class="r-c-3-btn-3" id="daochu_list" title="导出"></button>
								</div>
							</nav>
						</div>
						<div class="tab-cout-nav-b">
							<nav class="r-c-3-t-b-l">
								<li>
						    	 	<button  type="button"id="banka">办卡</button>
								</li>
							</nav>
							<nav class="r-c-3-t-b-r">
								<li>
									<img src="${def:context}/js/project/fitness/image/SVG/table/icon_yulan.svg" title="查看" alt=""id="look">
								</li>
								 <li>
										<img src="${def:context}/js/project/fitness/image/SVG/nav/xiugai.svg" title="修改" alt=""id="edit_btn">
								</li>
								<li>
									<img src="${def:context}/js/project/fitness/image/SVG/btn/tice.svg" title="体测" alt=""id="test_btn">
								</li>
								<li>
									<img src="${def:context}/js/project/fitness/image/SVG/nav/shanchu.svg" title="删除" alt=""id="del_btn">
								</li>
							</nav>
						</div>
					</div>
					<div class="r-tab-cout-3-b">
						<div class="to-change-background h-43"></div>
						<table> 
							<thead>
								<tr>
									<th class="table-checkbox">
										<label class="am-checkbox">
											<input id="selectAll"  name="datalist"  type="checkbox" value="" style="display: none;">
										</label>
									</th>
									<th>录入日期</th>
									<th>有效期</th>
									<th>公共资源</th>
									<th>姓名</th>
									<th>性别</th>
									<th>电话</th>
									<th>年龄</th>										
									<th>当前会籍</th>	
									<th>沟通阶段</th>
									<th>获客渠道</th>										
									<th>客户状态</th>	
								</tr>
							</thead>
							<tbody id="datagridTemplate" style="display: none">
								<tr>
									<td class="table-checkbox">#application_id#</td> 
									<td>#vc_itime#</td>
									<td>#fenpei#</td>
									<td>#i_public#</td>
									<td>#vc_name#</td>
									<td>#i_sex#</td>
									<td>#vc_mobile#</td>		
									<td>#age#</td>		
									<td>#vc_newmc#</td>
									<td>#domain_text_cn#</td>
									<td>#type#</td>		
									<td>#commresult#</td>				
								</tr>
							</tbody>
							<tbody id="datagrid">
							</tbody>
						</table>
						<div class="pageDiv">
							<ul class="pagination">
							</ul>
						</div>
					</div>
				</div>
			</div>
		</form>	
		<form action="${def:context}${def:actionroot}/excel" role="form" method="post" id="daochuForm" target="_blank" style="display: none">
			<input id="daochu_start_date" name="daochu_start_date" type="text" />
            <input id="daochu_end_date" name="daochu_end_date" type="text" />
			<input id="daochuvc_name" name="daochuvc_name" type="text" />
			<input id="daochui_public" name="daochui_public"  type="text"/>
			<input id="daochu_period_day" name="daochu_period_day"  type="text"/>
			<input id="daochu_newmc" name="daochu_newmc"  type="text"/>
			<div id="daochufilterconditionshtml">
			</div>
		</form>	
	<input type="hidden" name="actionroot" id="actionroot" value="${def:actionroot}" />
<script language="JavaScript">
var init_event_city;
var init_event_city2;
var search = null;
$(document).ready(function() {

	$Dialog().date($('#_start_date,#_end_date'));
	//筛选条件
	var filterconditionscolumn = $("#filterconditionscolumn").val().split(",");
	var filterconditionshtml = "";
	$.each(filterconditionscolumn,function(i, val){
		filterconditionshtml+="<input name='"+val+"' id='"+val+"' type='hidden' class='filterconditions' />";
	});
	$("#filterconditionshtml").html(filterconditionshtml);
	//结束
	
	searchSelectInit($("#cc_sex,#cc_birth,#cc_day,#cc_age,#cc_type,#cc_customtype"));
	searchSelectInit($("#cc_level,#cc_cardtype,#cc_nationality,#cc_nation,#province,#city,#province2"));
	searchSelectInit($("#city2,#cc_purpose,#cc_participate,#cc_ismember,#cc_leave,#cc_gethobbit,#cc_personalhobbit"));
	searchSelectInit($("#cc_children,#cc_marriage,#i_sex,#i_public,#i_status,#comm,#level,#newmc"));
	
	// 上传头像
	$("#upload_btn").unbind().on("click",function(){
		var pkvalue = document.addForm.cc_code.value;
		if( "" == pkvalue ){
			ccms.dialog.notice("请保存资源信息后再上传头像", 2000);
		}else{
			ccms.dialog.open({url: contextPath+"/action/project/fitness/util/attachment/photo/crud?table_code=cc_guest&pk_value="+pkvalue, height: "600", width: "630"});
		}
	});
	
	$('#cc_nationality').attr('readonly',true);
	$(".header-close").unbind().on("click",function(){
		$("#modalAddnew").modal('hide');
		ccms.util.clearForm('addForm');
	});
	//体测
	$("#test_btn").unbind().on("click",function(){
		var guestid =$('input[name="datalist"]:checked').val();
		var leng=$('input[name="datalist"]:checked').length
		if(guestid!=""&&leng==1){
			ccms.dialog.open({url:"${def:context}/action/project/fitness/class/private/testresults/form?guestcode="+guestid,id:"dialogPic", width:900,height:600});
		}else{
			ccms.dialog.notice("请选择一条数据!");
		}
	});
	
	//办卡
	$("#banka").unbind().on("click",function(){
		var guestid =$('input[name="datalist"]:checked').val();
		var leng=$('input[name="datalist"]:checked').length
		if(guestid!=""&&leng==1){
			ccms.dialog.open({url:"${def:context}/action/project/fitness/contract/newcard/create/form?guestcode="+guestid,id:"dialogPic"});
		}else{
			ccms.dialog.notice("请选择一条数据!");
		}
	});
	
	$('#look').on('click',function(){
		var leng=$('input[name="datalist"]:checked').length
		var code=$('input[name="datalist"]:checked').val();
		var status=$('input[name="datalist"]:checked').attr('code');
		if(leng!=1||code==''||code==null){
			ccms.dialog.notice("请选择中一条进行查看!");
		}else{
			ccms.dialog.open({url : '${def:context}/action/project/fitness/guest/follow/custcomm?cust_type=1&type=1&commtype='+1+'&guestcode='+code+"&status="+status});
		}
	})
	
	$('#save_btn').on('click',function(){
		if($('#cc_code').val()!=""){
			$('#cc_mc').attr('disabled',true);
			update();
		}else{
			$('#cc_mc').attr('disabled',false);
			insert();
		}
	})
	
	$("#del_btn").unbind().on('click',function(){
		var obthis=getCheckboxValue("datalist");
		/* var flag=true;
		$('input[name=datalist]:checked').each(function(){
			if($(this).attr('code1')==99){
				flag=false;
			}
		}) */
		if(obthis!= ""){
			/* if(flag){ */
				$Dialog().confirm("确定要删除这些数据吗?", function(){
					var url = "${def:context}${def:actionroot}/deletes?id="+obthis;
					ajaxCall(url,{
						method: "get",
						progress: true,
						dataType: "script",
						success: function() {
							ccms.dialog.alert("操作成功！");
							search.searchData(1);
						}
					});
				});
				/*} else{
				ccms.dialog.alert("不能删除已成为会员的资源！")
			} */
		}else{
			ccms.dialog.alert("请勾选资源数据！")
		}
	})
	//修改信息
	$('#edit_btn').on('click',function(){
		$('#formTitle').text('修改');
		$('#cc_mc,#cc_level').attr('disabled',true);
		//清空form下所有select
		$("#addForm select").each(function(){
			setSelectValue($("#"+$(this).attr("name")), "");
		});
		edit();
	})
	
	$('#recommend').on('blur',function(){
		getCustome();
	})
	
	$('#cc_mobile').on('blur',function(){
		checkTel($('#cc_mobile').val(),"cc_mobile");
	})
	$('#cc_officetel').on('blur',function(){
		checkTel($('#cc_officetel').val(),"cc_officetel");
	})
	$('#cc_othertel').on('blur',function(){
		checkTel($('#cc_othertel').val(),"cc_othertel");
	})
	$('#cc_card').on('blur',function(){
			IdentityCodeValid($('#cc_card').val(),'cc_card');
	})
	//验证邮箱
	$('#cc_email').on('blur',function(){
		checkEmail($('#cc_email').val(),'cc_email');
	})	
	//新增
	$("#addnew_btn").on("click", function(e){
		ccms.util.clearForm('addForm');
		//清空form下所有select
		$("#addForm select").each(function(){
			setSelectValue($("#"+$(this).attr("name")), "");
		});
		setSelectValue($("#cc_mc"), "${def:user}");
		$('#formTitle').text('新增');
		$('#modalAddnew').modal('show')
	});
	
	if( "undefined" != "${fld:startdate}" && "" != "${fld:startdate}" ){
		$("#_start_date").val("${fld:startdate}");
	}else if( "all" != "${fld:datetype}" ){
		$("#_start_date").val(new Date().format("yyyy-MM-01"));
	}
	if( "undefined" != "${fld:enddate}" && "" != "${fld:enddate}" ){
		$("#_end_date").val("${fld:enddate}");
	}else if( "all" != "${fld:datetype}" ){
		$("#_end_date").val("${def:date}");
	}
	if( "undefined" != "${fld:vc_mc}" && "" != "${fld:vc_mc}" ){
		$("#skill_name").val("${fld:vc_mc}");
	}else{
		$("#skill_name").val("${def:user}");
	}
	if( "undefined" != "${fld:i_public}" && "" != "${fld:i_public}" ){
		$("#i_public").val("${fld:i_public}");
	}
	if( "undefined" != "${fld:i_type}" && "" != "${fld:i_type}" ){
		$("#i_type").val("${fld:i_type}");
		$("#i_type").removeAttr("disabled");
		$("#resourceallocation").iCheck("check");
		showmore();
	}
	if( "undefined" != "${fld:kh_zyfpcx}" && "" != "${fld:kh_zyfpcx}" ){
		showmore();
		$("#kh_zyfpcx").val("${fld:kh_zyfpcx}");
		$("#kh_zyfpcx").removeAttr("disabled");
		$("#resource").iCheck("check");
	}
	$("#resource").on('ifClicked',function(){
		if($("#resource").is(':checked')){
			$("#kh_zyfpcx").attr('disabled','disabled');
		}else{
			$("#kh_zyfpcx").removeAttr('disabled');
		}
	});
	$("#resourceallocation").on('ifClicked',function(){
	  if($("#resourceallocation").is(':checked')){
		  $("#count_call,#i_type,#i_visited,#count_mcchange").attr('disabled','disabled');
	  }else{
		  $("#count_call,#i_type,#i_visited,#count_mcchange").removeAttr('disabled');
	   }
   });
		this.search=search;
		search=$Search({datagrid:"datagrid",formId:"searchForm",success:function(){
			$("table").css("table-layout","auto");
		ccms.util.renderCheckbox("datalist");
		$("#searchForm #vc_name").val("");
		
			
		//全选   取消全选
	    $("#selectAll").unbind().on("ifClicked",function(){    //点击事件未选中
		 if( $(this).prop("checked") ){// 
			$('input[name=datalist]').iCheck('uncheck');
		 }else{
			$('input[name=datalist]').iCheck('check');  //
		 }
	    });
			//更改会籍
			$("#change_btn").unbind().on("click",function(){
				var obthis="";
				var chkObjs = document.getElementsByName("datalist");
				for(var i=0;i<chkObjs.length;i++)
				{
			    	if(chkObjs[i].checked)
			    	{
			    		obthis += chkObjs[i].value+";";
			   		 }
				}
				if(obthis!= ""){
					$("#select_mc").modal('show');
					$("#to_mc").val('${def:user}');
				}else{
					ccms.dialog.notice("请选择会员!");
				}
				
			});
			//导出
			$("#daochu_list").unbind().on("click", function(){
		         $("#daochu_start_date").val($("#_start_date").val());
		         $("#daochu_end_date").val($("#_end_date").val());
		         $("#daochuvc_name").val($("#vc_name").val());
		         $("#daochui_public").val($("#i_public").val());
		         $("#daochu_period_day").val($("#period_day").val());
		         $("#daochu_newmc").val($("#newmc").val());
		         
		     	var filterconditionscolumn = $("#filterconditionscolumn").val().split(",");
		     	var daochufilterconditionshtml = "";
		     	$.each(filterconditionscolumn,function(i, val){
		     		daochufilterconditionshtml+="<input name='daochu_"+val+"' id='daochu_"+val+"' value='"+$("#"+val).val()+"' type='text' class='filterconditions' />";
		     	});
		     	$("#daochufilterconditionshtml").html(daochufilterconditionshtml);
		         $("#daochuForm").submit();
	   	     });
			}}).initSearchBtn().searchData(1);
	//家庭住址
 	getSelectDomain("province", "Province");
	$("#province").change(function(){
	    getSelectDomain("city", "City", "Province", $(this).val(),function(){
       		setSelectValue($("#city"), init_event_city);
        });
	});
	//公司地址
	getSelectDomain("province2", "Province");
	$("#province2").change(function(){
		getSelectDomain("city2", "City", "Province", $(this).val(),function(){
         	setSelectValue($("#city2"), init_event_city2);
        });
	});

	// 下拉搜索初始化
	searchSelectInit($("#cc_mc,#skill_name"));
	//条件筛选
	$("#filter_btn").unbind().on('click',function(){
		ccms.dialog.open({url : "${def:context}${def:actionroot}/filter", width:1000, height:670});
	})
})
function showmore() {
	if ($(".hida").is(":hidden")) {
		$(".hida").show();
		$("#sear").html("收起");
	} else {
		$(".hida").hide();
		$("#sear").html("更多查询");
	}
}

function update(){
	var uri="${def:context}/action/project/fitness/guest/detail/gustmanage/update";
	   ajaxCall(uri,{
		   	method: "post",
		   	form:"addForm",
		   	progress: false,
		   	dataType: "script",
		   	success: function() {
		   		ccms.dialog.notice("修改成功!", 2000, function(){
			   		$('#modalAddnew').modal('hide');
			   		ccms.util.clearForm('addForm');
			   		search.searchData(1);
			   		$('#modalAddnew').prop('scrollTop','0');
		   		});
	   		}
	   	}); 
}

function insert(){
	$('#cc_level').attr('disabled',false)
	var uri="${def:context}/action/project/fitness/guest/detail/gustmanage/insert";
	   ajaxCall(uri,{
		   	method: "post",
		   	form:"addForm",
		   	progress: false,
		   	dataType: "script",
		   	success: function() {
				ccms.dialog.notice("新增成功!", 2000, function(){
			   		$('#modalAddnew').modal('hide');
			   		ccms.util.clearForm('addForm');
			   		search.searchData(1);
			   		$('#modalAddnew').prop('scrollTop','0');
				});
	   		}
	   	}); 
}

function edit(){
	var leng=$('input[name="datalist"]:checked').length
	var code=$('input[name="datalist"]:checked').val();
	if(leng!=1||code==''||code==null){
		ccms.dialog.notice("请选择一个会员进行修改!");
	}else{
		ccms.util.clearForm('addForm');
		$('#modalAddnew').prop('scrollTop','0');
		var uri="${def:context}/action/project/fitness/guest/detail/gustmanage/edit?code="+code;
		   ajaxCall(uri,{
		   	method: "get",
		   	progress: false,
		   	dataType: "script",
		 	async:false,
		   	success: function() {
		   		$('#modalAddnew').modal('show');
		 	  	}
			});
		}
}


function getCustome(){
	$("#cus_code").val("");
	if($('#recommend').val()!=''){
		ccms.dialog.open({url : "${def:context}/action/project/fitness/util/querycustlist/crud?pickcustname="+$('#recommend').val()+"&objid=cus_code&objidtwo=recommend&random_number="+Math.random()});
	}
}
	
function checkTel(value,str){
    var isPhone = /^([0-9]{3,4}-)?[0-9]{7,8}$/;
    var isMob=/(^((0\d{2,3})-)(\d{7,8})(-(\d{3,}))?$)|(^1[3578]\d{9}$)|(^1\d{10}$)/;
    var value= value
    if(!isMob.test(value)&&!isPhone.test(value)){
    	ccms.dialog.notice("请输入正确手机号或电话号!");
	    	 $('#'+str).val('');
	    }
   }
	
	
function IdentityCodeValid(code,str) { 
    var city={11:"北京",12:"天津",13:"河北",14:"山西",15:"内蒙古",21:"辽宁",22:"吉林",23:"黑龙江 ",31:"上海",32:"江苏",33:"浙江",34:"安徽",35:"福建",36:"江西",37:"山东",41:"河南",42:"湖北 ",43:"湖南",44:"广东",45:"广西",46:"海南",50:"重庆",51:"四川",52:"贵州",53:"云南",54:"西藏 ",61:"陕西",62:"甘肃",63:"青海",64:"宁夏",65:"新疆",71:"台湾",81:"香港",82:"澳门",91:"国外 "};
    var tip = "";
    var pass= true;
    
    if(!code || !/^\d{6}(18|19|20)?\d{2}(0[1-9]|1[12])(0[1-9]|[12]\d|3[01])\d{3}(\d|X)$/i.test(code)){
        tip = "身份证号格式错误";
        pass = false;
    }
    
   else if(!city[code.substr(0,2)]){
        tip = "地址编码错误";
        pass = false;
    }
    if(!pass) {
    	ccms.dialog.notice(tip);
    	 $('#'+str).val('');
    }
}

function checkEmail(value,str){
	var value=value
	var myreg = /^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;
	if(!myreg.test(value)){
		ccms.dialog.notice('请输入有效的E_mail！');
	 $('#'+str).val('');
	}
}
//回调查询方法,不要删除
function pickcustCallback(){}
</script>
</body>
</html>