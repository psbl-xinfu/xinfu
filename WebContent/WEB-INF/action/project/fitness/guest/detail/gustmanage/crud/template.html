<!DOCTYPE html>
<html>
<meta charset="UTF-8"> 
<head>
${inc:/action/project/fitness/home/pub}
<title>客户资源列表</title>
<style type="text/css">
		/* .table{
            width:100%;
            max-width: 100%;
        } */
       /*  .table>thead>tr{
            background: #edf7ff;
        } */
       /*  .table>thead>tr>th {
            white-space: nowrap;
            padding: 8px;
            line-height: 1.42857143;
        } */
 
        /* .table>tbody>tr:nth-child(odd){
             background: #fff;
         }
        .table>tbody>tr:nth-child(even){
            background: #f7f7f7;
        } */
       .table>tbody>tr:hover{
            background:olive;
        } 
        .table-cont{
            /**make table can scroll**/
            max-height: 500px;
            overflow: auto;
            /** add some style**/
            /*padding: 2px;*/
           /*  background: #ddd; */
            margin: 20px 10px;
            /* border: 1px solid #ddd; */
        }
</style> 
</head>
<body>
	
	

	<div class="modal fade" id="modalAddnew"  tabindex="-1" style="display:none;">
		<div class="basic-information modal-dialog dialogbg" >
				<header class="header-default">
					<span id="formTitle">新增</span>
					<span class="header-close"></span>
				</header>
				<div class="b-i-main  yyc_b-i-main">
					<form id="addForm" name="addForm" method="post">
					<input type="hidden" id="cc_code" name="cc_code" value=""/>
					<input type="hidden" id="yttcode" name="yttcode" value=""/>
					<input type="hidden" id="custcation" name="custcation" value=""/>
					
					<nav >
						
						<li>
							<label>公司名称<span style="color: red;">*</span></label>
							<input type="text" id="company" name="company" value="" maxlength="80"  placeholder="公司名称"/>
						</li>
						<li class='lis'>
							<label>联系人姓名<span style="color: red;">*</span></label>
							<input type="text" id="cc_name" name="cc_name" value="" maxlength="80"  placeholder="姓名"/>
						</li>
						<li>
							<label>公司类型<span style="color: red;">*</span></label>
							<select  id="cc_birth" name="cc_birth" class=""> 
								<option value="">选择客户类型</option>
								<option value="1">健身俱乐部</option>
								<option value="2">健身工作室</option>
								<option value="3">瑜伽会所</option>
								<option value="4">器械器</option>
								<option value="5">培训机构</option>
								<option value="6">其他</option>
							</select>
						</li>
						<li class="ttbin">
							<label>联系人</label>
							<select id="ttname" name="ttname" class=""> 
							</select>
						</li>
						
						<li class='lis'>			
							<label>性别<span style="color: red;"></span></label>
							<div class="my-selected">
								<select  id="cc_sex" name="cc_sex"> 
									<option value="">请选择</option>
									<option value="1">男</option>
									<option value="0">女</option>
								</select>
							</div> 	
			 			</li>
			 			
						<li class='lis'>		
							<label>手机<span style="color: red;">*</span></label> 	
							<input type="text" id="cc_mobile" name="cc_mobile" value="" maxlength="80"  placeholder="手机"/>
			 			</li>	
			 			<li>
			 			</li>
			 			<li>
			 				<label>客户分类<span style="color: red;">*</span></label> 	
							<div class="my-selected">
								<select  id="communication" name="communication"> 
									<option value="">请选择</option>
									<option value="1">客户</option>
									<option value="2">重点意向客户</option>
									<option value="3">咨询客户</option>
									<option value="4">陌生客户</option>
								</select>
							</div>
			 			</li>
			 			
						<li class="hasCheck" id="businesstype1">
							<label>客户详细分类</label> 
							
						<select id="custcations" title="请选择" name="custcations" class="selectpicker show-tick form-control" multiple data-live-search="false">
							<option value="1">枢途设计</option>
							<option value="2">枢途平牌</option>
							<option value="3">单次学习</option>
							<option value="4">全年学习</option>
							<option value="5">6+1学习</option>
							<option value="6">学习点客户</option>
							<option value="7">内训客户</option>
                         </select>
							
							<!-- <select  id="custcation" name="custcation" data-live-search="true" style="display: none;"> 
								<option value="">请选择</option>
								<option value="1">殊途设计</option>
								<option value="2">殊途平牌</option>
								<option value="3">单次学习</option>
								<option value="5">全年学习</option>
								<option value="6">6+1学习</option>
								<option value="7">学习点客户</option>
								<option value="8">内训客户</option>
							</select> -->
						</li>
			 			<li class='lis'>
			 				<label>职位<span style="color: red;">*</span></label> 	
							<div class="my-selected">
								<select  id="position" name="position"> 
									<option value="">请选择职位</option>
									<position-rows>
										<option value="${fld:poscode}">${fld:posname}</option>
									</position-rows>
									
								</select>
							</div>
			 			</li>
			 			
			 			
						<li> 			
							<label>电话</label> 	
							<input type="text" id="cc_officetel" name="cc_officetel" value="" maxlength="80" placeholder="公司电话"/>
			 			 </li>
						
						
						
						<li class='lis'>
							<label>微信号</label>
							<input type="text" id="cc_wx" name="cc_wx" value="" maxlength="80" placeholder="微信"/>
						</li>
						<li class='lis'> 			
							<label>qq号</label> 	
							<input type="text" id="cc_qq" name="cc_qq" value="" maxlength="80" placeholder="qq" />
			 			</li>	
			 			
			 			<li> 			
							<label>E-mail</label> 	
							<input type="text" id="cc_email" name="cc_email" value="" maxlength="80" placeholder="email"/>
			 			</li>	
			 			<li > 			
							<label>关键负责人</label> 	
							<div class="my-selected">
								<select  id="ttstatus" name="ttstatus"> 
									<option value="">请选择</option>
									<option value="1">是</option>
									<option value="0">不是</option>
								</select>
							</div>
			 			</li>
			 			
						<li> 			
							<label>地区<span style="color: red;">*</span></label> 	
							<div class="my-selected">
								<select  id="province2" name="province2"> 
									<option value="">请选择省</option>
								</select>
							</div>
			 			</li>	
			 			<li> 			
							<label>市<span style="color: red;">*</span></label> 	
							<div class="my-selected">
								<select  id="city2" name="city2"> 
									<option value="">请选择市</option>
								</select>
							</div>
			 			</li>
			 			<li class="to100w" style="margin-left: 6%"> 			
							<label >地址</label> 	
							<textarea id="address" name="address" placeholder="地址详细信息" class="my-textarea" rows="2" cols="1"></textarea>
			 			</li>
			 			
			 			
			 			<!-- <nav style="margin-left: 6%">	
							<label-rows>
								<li >
									<input type="checkbox" id="lbid${fld:code}" name="labels" value="${fld:labelcode}" style="display: none;" />${fld:labelname@js}
								</li>
							</label-rows>
						</nav> -->
			 			<li> 			
							<label>邮编</label> 	
							<input type="text" id="postalcode" name="postalcode" value="" maxlength="80" placeholder="邮编"/>
			 			</li>			
						<li> 			
							<label>咨询师</label> 	
							<div class="my-selected">
								<select id="cc_mc" name="cc_mc"   >
									<staff-rows3>
										<option value="${fld:userlogin}">${fld:name}</option>
									</staff-rows3>
								</select>
							</div> 
			 			</li>
			 			<li class="to100w" style="margin-left: 6%">
							<label>公司备注</label>
							<textarea id="cc_remark" name="cc_remark" placeholder="暂无数据" class="my-textarea" rows="" cols="4"></textarea>
						</li>	
						
					</nav>
					</form>
				</div>
				<footer class="footer-default">
					<button id="save_btn" class="my-btn-default active">保存</button>
				</footer>
			</div>
		</div>		
		<form  role="form" method="post" id="searchForm">
			<input name="sort" type="hidden" value="g.created" preserve="true" />
			<input name="order" type="hidden" value="desc" preserve="true" />
			<input id="pageNo" name="pageNo" type="hidden" value="" preserve="true" />
			<input name="totalPages" type="hidden" value="" preserve="true" />
				
			<!-- 条件筛选开始 -->
			<input id="labelcodes" name="labelcodes"  type="hidden" value=""/>
			<!-- 条件筛选结束 -->
	
			<div class="am-tabs-bd r-tab-cont">
				<div class="c-n-nav-2 am-tab-panel am-in am-active am-fade three-none" >
					<div class="tab-cout-nav">
						<div class="tab-cout-nav-t yyc_tab-cout-nav-t">
							<nav class="tab-nav-my">
								<input type="hidden" id="custcation2" name="custcation2" value=""/>
								<li class="province1">
									<select  id="province" name="province"> 
										<option value="">请选择省</option>
									</select>
								</li>
								<li class="city1">
									<select  id="city" name="city"> 
										<option value="">请选择市</option>
									</select>
								</li> 
										
								<li class="inputName" style="width: 160px">
									<input style="width: 130px" type="text" id="vc_name" name="vc_name" placeholder="公司名称/姓名/电话" class="input-default"/>							
				 			 	</li>		
								<li style="width: 160px">
								  <select id="newmc" name="newmc" style="display: none;">
									  <option value="">全部咨询师</option>
									  <skillname-row>
											<option  value='${fld:userlogin}'>${fld:name@js}</option>
									  </skillname-row>
								  </select>
								</li>
								<li class="hasCheck">
									<input type="checkbox" name="public" value="1" style="display: none;"/>公海
								</li>
								<li class='lis'>
							<div class="my-selected">
								<select  id="position" name="position"> 
									<option value="">请选择职位</option>
									<position-rows>
										<option value="${fld:poscode}">${fld:posname}</option>
									</position-rows>
									
								</select>
							</div>
			 			</li>
								<div class="r-c-btnList b-10">
									<button type="button" class="r-c-3-btn-1" code=1 id="search_btn" title="查询"></button>
									<img src="${def:context}/js/project/fitness/image/SVG/nav/xinzengkecheng.svg" title="添加" alt="" data-toggle="modal" id="addnew_btn">
									<!-- <img class="r-c-3-btn-3" src="${def:context}/js/project/fitness/image/SVG/nav/btn_shaixuan.svg" title="条件筛选" data-toggle="modal" id="filter_btn"/>  -->
									<button type="button"  class="r-c-3-btn-3" id="daochu_list" title="导出"></button>
								</div>
							</nav>
						</div>
						<div class="tab-cout-nav-b">
							<nav class="r-c-3-t-b-l">
								<li>
									<button type="button" id="change_btn">分配顾问</button>
								</li>
								<li class="label-p" id="periodnum">
									<label for="rc-n-1-2">保护期(天)：</label>
									<input class="input-default" type="text"  id="period_day" name="period_day"  value="${fld:period_day}" placeholder="请输入天数">
								</li>
								
								
								<li style="width: 140px;">
									<select id="overdue_day" name="overdue_day" style="display: none;">
										<option value="">进入公海天数</option>
										<option  value='7'>大于7天</option>
										<option  value='15'>大于15天</option>
										<option  value='30'>大于30天</option>
										<option  value='60'>大于60天</option>
										<option  value='90'>大于90天</option>
										<option  value='180'>大于180天</option>
									</select>
								</li>
								<li style="width: 10px;"></li>
								<li class="hasCheck">
									<select  id="communication2" name="communication2"> 
										<option value="">客户分类</option>
										<option value="1">客户</option>
										<option value="2">重点意向客户</option>
										<option value="3">咨询客户</option>
										<option value="4">陌生客户</option>
									</select>
								</li>
								</li>
			 			
								<li class="hasCheck" id="businesstype">
									<select id="custcations2" title="请选择" name="custcations2" class="selectpicker show-tick form-control" multiple data-live-search="false">
										<option value="1">枢途设计</option>
										<option value="2">枢途平牌</option>
										<option value="3">单次学习</option>
										<option value="4">全年学习</option>
										<option value="5">6+1学习</option>
										<option value="6">学习点客户</option>
										<option value="7">内训客户</option>
			                         </select>
								
								
									<!-- <select  id="" name="custcation2" data-live-search="true" style="display: none;"> 
										<option value="">请选择</option>
										<option value="1">殊途设计</option>
										<option value="2">殊途平牌</option>
										<option value="3">单次学习</option>
										<option value="5">全年学习</option>
										<option value="6">6+1学习</option>
										<option value="7">学习点客户</option>
										<option value="8">内训客户</option>
									</select> -->
									
									
								</li>
							</nav>
							<nav class="r-c-3-t-b-r">
								<!-- <li>
									<img src="${def:context}/js/project/fitness/image/SVG/table/icon_yulan.svg" title="查看" alt=""id="look">
								</li> --> 
								 <li>
									<img src="${def:context}/js/project/fitness/image/SVG/nav/xiugai.svg" title="修改" alt=""id="edit_btn">
								</li>
								
							</nav>
						</div>
					</div>
					<div class="r-tab-cout-3-b table-cont">
						<div class="to-change-background h-43"></div>
						<table class="table"> 
							<thead>
								<tr>
									<th class="table-checkbox">
										<label class="am-checkbox">
											<input id="selectAll"  name="datalist"  type="checkbox" value="" style="display: none;">
										</label>
									</th>
									<th>保护期(天数)</th>
									<th>公司名称</th>
									<th>关键对接人</th>
									<th>性别</th>
									<th>手机</th>
									<th>职位</th>
									<th>咨询师归属</th>
									<th>跟进状态</th>
									<th>跟进备注</th>
								</tr>
							</thead>
							<tbody id="datagridTemplate" style="display: none">
								<tr>
									<td>#application_id#</td>
									<td>#num_days#</td>
									<td>
						            	<a href="javascript:;" onclick="detailptrest('#vc_code#')">#officename#</a>
						            </td>
									<td>#vc_name#</td>		
									<td>#i_sex#</td>		
									<td>#vc_mobile#</td>
									<td>#c_position#</td>
									<td>#vc_newmc#</td>
									<td>#vc_commresult#</td>
									<td>#gj_remark#</td>
								</tr>
							</tbody>
							
							<tbody id="datagrid">
							</tbody>
						</table>
						<div class="pageDiv">
							<ul class="pagination">
							</ul>
						</div>
					</div>
				</div>
			</div>
		</form>	
		<form action="${def:context}${def:actionroot}/excel" role="form" method="post" id="daochuForm" target="_blank" style="display: none">
			<input id="daochu_start_date" name="daochu_start_date" type="text" />
            <input id="daochu_end_date" name="daochu_end_date" type="text" />
			<input id="daochuvc_name" name="daochuvc_name" type="text" />
			<input id="daochui_public" name="daochui_public"  type="text"/>
			<input id="daochu_period_day" name="daochu_period_day"  type="text"/>
			<input id="daochu_newmc" name="daochu_newmc"  type="text"/>
			<div id="daochufilterconditionshtml">
			</div>
		</form>	
	<input type="hidden" name="actionroot" id="actionroot" value="${def:actionroot}" />
<script language="JavaScript">
var init_event_city;
var init_event_city2;
var search = null;
$(document).ready(function() {
	
	
	
	searchSelectInit($("#custcations,#custcations2,#ttname,#ttstatus,#communication2,#communication,#position,#overdue_day,#cc_sex,#cc_birth,#city2,#newmc,#province,#city,#province2"));
	 $('#custcations').selectpicker({
	        'selectedText': 'cat'
	 });
	 $('#custcations2').selectpicker({
	        'selectedText': 'cat'
	 });
	 
	// 上传头像
	$("#upload_btn").unbind().on("click",function(){
		var pkvalue = document.addForm.cc_code.value;
		if( "" == pkvalue ){
			ccms.dialog.notice("请保存资源信息后再上传头像", 2000);
		}else{
			ccms.dialog.open({url: contextPath+"/action/project/fitness/util/attachment/photo/crud?table_code=cc_guest&pk_value="+pkvalue, height: "600", width: "630"});
		}
	});
	
	$(".header-close").unbind().on("click",function(){
		$("#modalAddnew").modal('hide');
		ccms.util.clearForm('addForm');
	});
	
	//分配顾问
	$("#change_btn").unbind().on("click",function(){
		var obthis = getCheckboxValue("datalist");
		var count = obthis.split(",").length;
		if(obthis!= ""){
			$Dialog().confirm("选定的"+count+"个将更换会籍顾问，是否继续！",function(){
				ccms.dialog.open({url : '${def:context}${def:actionroot}/distribution/crud?guestcode='+obthis, width:'1000',height:'600'});
			});
		}else{
			ccms.dialog.notice("请选择!");
		}
	});
	
	$("#businesstype").hide();
	setSelectValue($("#custcations2"), "");
	$("#custcation2").val("");
	$("#communication2").change(function(){
		setSelectValue($("#custcations2"), "");
		$("#custcation2").val("");
		var cust2=$("#communication2").val();
			if(cust2==''){
				$('#businesstype').hide();
				setSelectValue($("#custcations2"), "");
				$("#custcation2").val("");
			}else{
				if(cust2==1){
					$('#businesstype').show();
				}else{
					$('#businesstype').hide();
					setSelectValue($("#custcations2"), "");
					$("#custcation2").val("");
				}
			}
	});
	
	//办卡
	$("#banka").unbind().on("click",function(){
		var guestid =$('input[name="datalist"]:checked').val();
		var leng=$('input[name="datalist"]:checked').length
		if(guestid!=""&&leng==1){
			ccms.dialog.open({url:"${def:context}/action/project/fitness/contract/newcard/create/form?guestcode="+guestid,id:"dialogPic"});
		}else{
			ccms.dialog.notice("请选择一条数据!");
		}
	});
	
	$('#look').on('click',function(){
		var leng=$('input[name="datalist"]:checked').length
		var code=$('input[name="datalist"]:checked').val();
		var status=$('input[name="datalist"]:checked').attr('code');
		alert(status);
		alert(code);
		if(leng!=1||code==''||code==null){
			ccms.dialog.notice("请选择中一条进行查看!");
		}else{
			ccms.dialog.open({url : '${def:context}/action/project/fitness/guest/follow/custcomm?cust_type=1&type=1&commtype='+1+'&guestcode='+code+"&status="+status});
		}
	})
	$("#custcations2").change(function(){
		$("#custcation2").val($("#custcations2").val()); 
		
	})
	
	
	
	
	$('#save_btn').on('click',function(){
		$("#custcation").val($("#custcations").val());
		if($('#cc_code').val()!=""){
			$('#cc_mc').attr('disabled',true);
			update();
		}else{
			$('#cc_mc').attr('disabled',false);
			insert();
		}
	})
	//修改信息
	$('#edit_btn').on('click',function(){
		$('#formTitle').text('修改');
		$('#cc_mc').attr('disabled',true);
		$(".lis").hide();
		$("#toss").hide();
		$(".ttbin").show();

		$("#businesstype1").hide();
		setSelectValue($("#custcations"), "");
		$("#custcation").val("");
		$("#communication").change(function(){
			var cust=$("#communication").val();
				if(cust==''){
					$('#businesstype1').hide();
					setSelectValue($("#custcations"), "");
				}else{
					if(cust==1){
						$('#businesstype1').show();
					}else{
						$('#businesstype1').hide();
						setSelectValue($("#custcations"), "");
					}
				}
		});
		
		//清空form下所有select
		$("#addForm select").each(function(){
			setSelectValue($("#"+$(this).attr("name")), "");
		});
		edit();
	})
	
	$('#recommend').on('blur',function(){
		getCustome();
	})
	
	//新增
	$("#addnew_btn").on("click", function(e){
		ccms.util.clearForm('addForm');
		//清空form下所有select
		$("#addForm select").each(function(){
			setSelectValue($("#"+$(this).attr("name")), "");
		});
		$('#formTitle').text('新增');
		$('#modalAddnew').modal('show');
		$(".lis").show();
		$("#toss").show();
		$(".ttbin").hide();
		$("#businesstype1").hide();
		setSelectValue($("#custcations2"), "");
		$("#custcation2").val("");
		$("#communication").change(function(){
			var cust=$("#communication").val();
				if(cust==''){
					$('#businesstype1').hide();
					setSelectValue($("#custcations"), "");
				}else{
					if(cust==1){
						$('#businesstype1').show();
					}else{
						$('#businesstype1').hide();
						setSelectValue($("#custcations"), "");
					}
				}
		});
		
		
	});
	
	
	
	$('#cc_mobile').on('blur',function(){
		checkTel($('#cc_mobile').val(),"cc_mobile");
	})
	$('#cc_officetel').on('blur',function(){
		checkTel($('#cc_officetel').val(),"cc_officetel");
	})
	$('#cc_othertel').on('blur',function(){
		checkTel($('#cc_othertel').val(),"cc_othertel");
	})
	$('#cc_card').on('blur',function(){
			IdentityCodeValid($('#cc_card').val(),'cc_card');
	})
	//验证邮箱
	$('#cc_email').on('blur',function(){
		checkEmail($('#cc_email').val(),'cc_email');
	})	
	
	
	if( "undefined" != "${fld:startdate}" && "" != "${fld:startdate}" ){
		$("#_start_date").val("${fld:startdate}");
	}else if( "all" != "${fld:datetype}" ){
		$("#_start_date").val(new Date().format("yyyy-MM-01"));
	}
	if( "undefined" != "${fld:enddate}" && "" != "${fld:enddate}" ){
		$("#_end_date").val("${fld:enddate}");
	}else if( "all" != "${fld:datetype}" ){
		$("#_end_date").val("${def:date}");
	}
	if( "undefined" != "${fld:vc_mc}" && "" != "${fld:vc_mc}" ){
		$("#skill_name").val("${fld:vc_mc}");
	}else{
		$("#skill_name").val("${def:user}");
	}
	if( "undefined" != "${fld:i_public}" && "" != "${fld:i_public}" ){
		$("#i_public").val("${fld:i_public}");
	}
	$("#resource").on('ifClicked',function(){
		if($("#resource").is(':checked')){
			$("#kh_zyfpcx").attr('disabled','disabled');
		}else{
			$("#kh_zyfpcx").removeAttr('disabled');
		}
	});
		this.search=search;
		search=$Search({datagrid:"datagrid",formId:"searchForm",success:function(){
			$("table").css("table-layout","auto");
		ccms.util.renderCheckbox("datalist");
		$("#searchForm #vc_name").val("");
		
			
		//全选   取消全选
	    $("#selectAll").unbind().on("ifClicked",function(){    //点击事件未选中
		 if( $(this).prop("checked") ){// 
			$('input[name=datalist]').iCheck('uncheck');
		 }else{
			$('input[name=datalist]').iCheck('check');  //
		 }
	    });
			//导出
			$("#daochu_list").unbind().on("click", function(){
		         $("#daochu_start_date").val($("#_start_date").val());
		         $("#daochu_end_date").val($("#_end_date").val());
		         $("#daochuvc_name").val($("#vc_name").val());
		         $("#daochui_public").val($("#i_public").val());
		         $("#daochu_period_day").val($("#period_day").val());
		         $("#daochu_newmc").val($("#newmc").val());
		         
		     	var filterconditionscolumn = $("#filterconditionscolumn").val().split(",");
		     	var daochufilterconditionshtml = "";
		     	$.each(filterconditionscolumn,function(i, val){
		     		daochufilterconditionshtml+="<input name='daochu_"+val+"' id='daochu_"+val+"' value='"+$("#"+val).val()+"' type='text' class='filterconditions' />";
		     	});
		     	$("#daochufilterconditionshtml").html(daochufilterconditionshtml);
		         $("#daochuForm").submit();
	   	     });
			}}).initSearchBtn().searchData(1);
	//地址搜索
 	getSelectDomain("province", "Province");
	$("#province").change(function(){
	    getSelectDomain("city", "City", "Province", $(this).val(),function(){
       		setSelectValue($("#city"), init_event_city);
        });
	});
	//公司地址
	getSelectDomain("province2", "Province");
	$("#province2").change(function(){
		getSelectDomain("city2", "City", "Province", $(this).val(),function(){
         	setSelectValue($("#city2"), init_event_city2);
        });
	});

	// 下拉搜索初始化
	searchSelectInit($("#cc_mc"));
	//条件筛选
	$("#filter_btn").unbind().on('click',function(){
		ccms.dialog.open({url : "${def:context}${def:actionroot}/filter", width:1000, height:670});
	})
})

function detailptrest(code) {
	ccms.dialog.open({url : '${def:context}/action/project/fitness/guest/follow/custcomm?cust_type=1&type=1&commtype='+1+'&guestcode='+code+"&status="});
	}

function update(){
	var uri="${def:context}/action/project/fitness/guest/detail/gustmanage/update";
	   ajaxCall(uri,{
		   	method: "post",
		   	form:"addForm",
		   	progress: false,
		   	dataType: "script",
		   	success: function() {
		   		ccms.dialog.notice("修改成功!", 2000, function(){
		   			var yeshu = $("#pageNo").val();
			   		$('#modalAddnew').modal('hide');
			   		/* ccms.util.clearForm('addForm'); */
			   		search.initSearchBtn().searchData(yeshu);
			   		$('#modalAddnew').prop('scrollTop','0');
		   		});
	   		}
	   	}); 
}



function insert(){

	var uri="${def:context}/action/project/fitness/guest/detail/gustmanage/insert";
	   ajaxCall(uri,{
		   	method: "post",
		   	form:"addForm",
		   	progress: false,
		   	dataType: "script",
		   	success: function() {
				ccms.dialog.notice("新增成功!", 2000, function(){
			   		$('#modalAddnew').modal('hide');
			   		ccms.util.clearForm('addForm');
			   		search.searchData(1);
			   		$('#modalAddnew').prop('scrollTop','0');
				});
	   		}
	   	}); 
}

function edit(){
	var leng=$('input[name="datalist"]:checked').length
	var code=$('input[name="datalist"]:checked').val();
	if(leng!=1||code==''||code==null){
		ccms.dialog.notice("请选择一条进行修改!");
	}else{
		ccms.util.clearForm('addForm');
		$('#modalAddnew').prop('scrollTop','0');
		var uri="${def:context}/action/project/fitness/guest/detail/gustmanage/edit?code="+code;
		   ajaxCall(uri,{
		   	method: "get",
		   	progress: false,
		   	dataType: "script",
		 	async:false,
		   	success: function() {
		   		$('#modalAddnew').modal('show');
		 	  	}
			});
		}
}


function getCustome(){
	$("#cus_code").val("");
	if($('#recommend').val()!=''){
		ccms.dialog.open({url : "${def:context}/action/project/fitness/util/querycustlist/crud?pickcustname="+$('#recommend').val()+"&objid=cus_code&objidtwo=recommend&random_number="+Math.random()});
	}
}
	
function checkTel(value,str){
    var isPhone = /^[1][3,4,5,7,8][0-9]{9}$/;
    var isMob=/^(\(\d{3,4}\)|\d{3,4}-|\s)?\d{7,14}$/;
    var value= value
    if(!isMob.test(value)&&!isPhone.test(value)){
    	ccms.dialog.notice("请输入正确手机号或电话号!");
	    	 $('#'+str).val('');
	    }
   }
	
	
function IdentityCodeValid(code,str) { 
    var city={11:"北京",12:"天津",13:"河北",14:"山西",15:"内蒙古",21:"辽宁",22:"吉林",23:"黑龙江 ",31:"上海",32:"江苏",33:"浙江",34:"安徽",35:"福建",36:"江西",37:"山东",41:"河南",42:"湖北 ",43:"湖南",44:"广东",45:"广西",46:"海南",50:"重庆",51:"四川",52:"贵州",53:"云南",54:"西藏 ",61:"陕西",62:"甘肃",63:"青海",64:"宁夏",65:"新疆",71:"台湾",81:"香港",82:"澳门",91:"国外 "};
    var tip = "";
    var pass= true;
    
    if(!code || !/^\d{6}(18|19|20)?\d{2}(0[1-9]|1[12])(0[1-9]|[12]\d|3[01])\d{3}(\d|X)$/i.test(code)){
        tip = "身份证号格式错误";
        pass = false;
    }
    
   else if(!city[code.substr(0,2)]){
        tip = "地址编码错误";
        pass = false;
    }
    if(!pass) {
    	ccms.dialog.notice(tip);
    	 $('#'+str).val('');
    }
}

function checkEmail(value,str){
	var value=value
	var myreg = /^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;
	if(!myreg.test(value)){
		ccms.dialog.notice('请输入有效的E_mail！');
	 $('#'+str).val('');
	}
}
//回调查询方法,不要删除
function pickcustCallback(){}
</script>
</body>
</html>