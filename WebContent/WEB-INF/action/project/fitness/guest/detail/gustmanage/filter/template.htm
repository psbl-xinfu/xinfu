<!DOCTYPE html>
<html>
${inc:/action/project/fitness/home/pub}
<meta charset="UTF-8">
<head>
<title>客户回访条件筛选</title>
</head>
<body> 
		<div class="col_mainInner dialogbg" style="width: 1000px;height: 630px;">
			<header class="header-default">
				<span id="formTitle">标签筛选</span>
			</header>
          <form id="formEditor" name="formEditor" class="form-horizontal" role="form" method="post">
			<input type="hidden" id="tuid" name="tuid" value="" />
			<input type="hidden" id="unionid" name="unionid" value="${fld:unionid}" />
			<div class="modal-body b-i-main">
				<nav>
					<li>
						<label>标签</label>
					</li>
					<li></li>
				</nav>
				<nav>
					<label-rows>
					<li style="width: 200px;">
						<input type="checkbox" id="lbid${fld:code}" name="label" value="${fld:code}" style="display: none;" />${fld:name@js}
					</li>
					</label-rows>
				</nav>
			</div>
			<footer class="footer-default">
				<button type="button" id="filter">确定</button>&nbsp;
				<button type="button" id="clearfilter">重置</button>
			</footer>
			</form>
		</div>

	<input type="hidden" name="actionroot" id="actionroot" value="${def:actionroot}" />
<script language="JavaScript">
$(document).ready(function() {
	/* <labelguest-rows>
	ccms.util.setCheckboxValue("label", "${fld:guestcode}", "formEditor");
	</labelguest-rows> */
	
	/* var obj = $Crud({
		formId : "formEditor",
		button : "save_btn",
		bpkField : "tuid",
		insertBack : function() {
			ccms.dialog.notice("保存成功", 2000, function(){
				ccms.dialog.close();
			});
		},
		deleteBack : function() {
			
		},
		addNewBack : function() {
			$("#formTitle").html("设置通店俱乐部");
		},
		editBack : function() {
			$("#formTitle").html("修改");
		},
		validate : function() {
			var flag = $("#formEditor").validate({
				rules : {},
				messages : {}
			});
			return flag;
		},
		check : function() {
			return true;
		}

	}).init(); */
	$("#cancel_btn").unbind().on("click",function(){
		ccms.dialog.close();
	});
	//筛选
	$("#filter").click(function(){
		//清空父级页面
	/* 	clearparentfilter();
		//往父页面赋值
		 $("li input[name='label']").each(function(){
			alert($("#"+$(this).attr("id")).val($("#"+$(this).attr("id")).val()));
			parent.$("#"+$(this).attr("id")).val($("#"+$(this).attr("id")).val()); 
		}) */
		var obj = document.getElementsByName("label");
		var check_val = [];
		for (var i = 0; i < obj.length; i++) {
			if (obj[i].checked) {
				check_val.push(obj[i].value);
			}
		}
		var bin=check_val.join(';');
		alert(bin);
		//需求
		parent.$("#labelcodes").val(bin);
		parent.search.searchData(1);
		ccms.dialog.close(); 
	});
	
	$("#clearfilter").click(function(){
		///清空本页面
		clearfilter();
		//清空父级页面
		clearparentfilter();
	});
	
});
//清空本页面
function clearfilter(){
	$('input[name=demandcb]').iCheck('uncheck');
	$("li .filterconditions").each(function(){
		$("#"+$(this).attr("id")).val('');
		$("#"+$(this).attr("id")).selectpicker("refresh");
		$("#"+$(this).attr("id")).selectpicker("render");
	})
}
//清空父级页面
function clearparentfilter(){
	$("li .filterconditions").each(function(){
		parent.$("#"+$(this).attr("id")).val('');
	})
}
</script>
</body>
</html>