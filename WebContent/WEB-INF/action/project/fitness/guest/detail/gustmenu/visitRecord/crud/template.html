<!DOCTYPE html>
<html>
<head>
${inc:/action/project/fitness/home/pub}
<title>联系人</title>

</head>

<body>
	
	
	<div class="modal fade" id="modalshuaixuan"  tabindex="-1" style="display:none;">
		<div class="basic-information modal-dialog dialogbg" >
				<header class="header-default">
					<span id="formTitle">条件</span>
					<span class="ben-close"></span>
				</header>
				<div class="b-i-main  yyc_b-i-main">
						
						<nav >
				 				
				 			<li class='lis'>	
				 				<label>店面</label> 
								<select id="cc_branchcode2" title="请选择" name="cc_branchcode2" >
									<option value="">请选择</option>
									<branch-rows2>
										<option value="${fld:branchcode}">${fld:branchname}</option>
									</branch-rows2>
		                         </select>
				 			</li>
				 			<li class='lis'>	
				 				<label>可能性课程</label> 
								<select id="cc_possibility2" title="请选择" name="cc_possibility2" class="selectpicker show-tick form-control" multiple data-live-search="false">
									<isgood-rows2>
										<option value="${fld:procodeis}">${fld:pronameis}</option>
									</isgood-rows2>
		                         </select>
				 			</li>
				 			<li class='lis'>	
				 				<label>已学课程</label> 
								<select id="cc_theproduct2" title="请选择" name="cc_theproduct2" class="selectpicker show-tick form-control" multiple data-live-search="false">
									<product-rows2>
										<option value="${fld:procode}">${fld:courname}</option>
									</product-rows2>
		                         </select>
				 			</li>
						</nav>
				</div>
				<footer class="footer-default">
					<button id="que_btn" class="my-btn-default active">确认</button>
				</footer>
			</div>
		</div>
	
	
	<div class="modal fade" id="modalAddnew"  tabindex="-1" style="display:none;">
		<div class="basic-information modal-dialog dialogbg" >
				<header class="header-default">
					<span id="formTitle">新增</span>
					<span class="header-close"></span>
				</header>
				<div class="b-i-main  yyc_b-i-main">
					<form id="addForm" name="addForm" method="post">
						<input type="hidden" id="cc_code" name="cc_code" value=""/>
						<input id="cc_possibilitys" name="cc_possibilitys"  type="hidden" value=""/>
						<input id="cc_theproducts" name="cc_theproducts"  type="hidden" value=""/>
						<input id="guestttcode" name="guestttcode" type="hidden" value="" />
						<div id="filterconditionshtml">
						</div>
						<nav >
							
							<li>
								<label>联系人姓名<span style="color: red;">*</span></label>
								<input type="text" id="cc_name" name="cc_name" value="" maxlength="80"  placeholder="姓名"/>
							</li>
							
							<li>			
								<label>性别<span style="color: red;"></span></label>
								<div class="my-selected">
									<select  id="cc_sex" name="cc_sex"> 
										<option value="">请选择</option>
										<option value="1">男</option>
										<option value="0">女</option>
									</select>
								</div> 	
				 			</li>
				 			
							<li class='lis'>		
								<label>手机<span style="color: red;">*</span></label> 	
								<input type="text" id="cc_mobile" name="cc_mobile" value="" maxlength="80"  placeholder="手机"/>
				 			</li>	
				 			<li class='lis'>		
								<label>手机2</label> 	
								<input type="text" id="cc_mobile2" name="cc_mobile2" value="" maxlength="80"  placeholder="手机"/>
				 			</li>
				 			<li class='lis'>
				 				<label>职位<span style="color: red;">*</span></label> 	
								<div class="my-selected">
									<select  id="cc_position" name="cc_position"> 
										<option value="">请选择职位</option>
										<position-rows>
											<option value="${fld:poscode}">${fld:posname}</option>
										</position-rows>
									</select>
								</div>
				 			</li>
				 			<li class='lis'>		
								<label>生日</label> 	
								<input id="cc_birth" name="cc_birth" placeholder="生日" type="text"class="input-default"/>
								
				 			</li>	
				 			<li class='lis'>		
								<label>邮箱</label> 	
								<input id="cc_email" name="cc_email" placeholder="邮箱" type="text"class="input-default"/>
								
				 			</li>
				 			<li class='lis'>		
								<label>抖音</label> 	
								<input id="cc_trill" name="cc_trill" placeholder="抖音" type="text"class="input-default"/>
								
				 			</li>
				 			<li class='lis'>		
								<label>微信</label> 	
								<input id="cc_wechat" name="cc_wechat" placeholder="微信" type="text"class="input-default"/>
								
				 			</li>
				 			<li class='lis'>	
				 				<label>店面</label> 
								<select id="cc_branchcode" title="请选择" name="cc_branchcode" >
									<option value="">请选择</option>
									<branch-rows>
										<option value="${fld:branchcode}">${fld:branchname}</option>
									</branch-rows>
		                         </select>
				 			</li>
				 			<li class='lis'>	
				 				<label>可能性课程</label> 
								<select id="cc_possibility" title="请选择" name="cc_possibility" class="selectpicker show-tick form-control" multiple data-live-search="false">
									<isgood-rows>
										<option value="${fld:procodeis}">${fld:pronameis}</option>
									</isgood-rows>
		                         </select>
				 			</li>
				 			<li class='lis'>	
				 				<label>已学课程</label> 
								<select id="cc_theproduct" title="请选择" name="cc_theproduct" class="selectpicker show-tick form-control" multiple data-live-search="false">
									<product-rows>
										<option value="${fld:procode}">${fld:courname}</option>
									</product-rows>
		                         </select>
				 			</li>
				 			
							<li class='lis'>		
								<label>备注：</label> 	
								<textarea id="remark" name="remark" placeholder="备注" class="my-textarea" rows="2" cols="1"></textarea>
				 			</li>	
				 			
						</nav>
					</form>
				</div>
				<footer class="footer-default">
					<button id="save_btn" class="my-btn-default active">保存</button>
				</footer>
			</div>
		</div>	
			
			<div style="height: 700px;">
				
				<form  role="form" method="post" id="searchForm">
					<div class="am-tabs-bd r-tab-cont">
						<div class="c-n-nav-2 am-tab-panel am-in am-active am-fade three-none" >
						
							<input id="cc_possibilitys2" name="cc_possibilitys2"  type="hidden" value=""/>
							<input id="cc_theproducts2" name="cc_theproducts2"  type="hidden" value=""/>
							<input id="cc_branchcodes2" name="cc_branchcodes2"  type="hidden" value=""/>
							
							<div class="tab-cout-nav-b">
								<nav class="r-c-3-t-b-l">
									<li>
										<button type="button" id="communicaRecord">跟进</button>
									</li>
									
									<li class="inputName" style="width:100px">
										<input style="width: 100px" type="text" id="vc_name" name="vc_name" placeholder="姓名/电话" class="input-default"/>							
					 			 	</li>
					 			 	<li>
											<select  id="cc_position2" name="cc_position2"> 
												<option value="">请选择职位</option>
												<position-rows2>
													<option value="${fld:poscode}">${fld:posname}</option>
												</position-rows2>
											</select>
					 			 	</li>	
					 			 	
					 			 	
					 			 	
									<div class="r-c-btnList b-10 ">
										<button type="button" class="r-c-3-btn-1" code=1 id="search_btn" title="查询">查询</button>
										<button type="button" id="edit_btn">修改联系人</button>
										<img src="${def:context}/js/project/fitness/image/SVG/nav/xinzengkecheng.svg" title="添加" alt="" data-toggle="modal" id="addttname">
										<img class="r-c-3-btn-3" src="${def:context}/js/project/fitness/image/SVG/nav/btn_shaixuan.svg" title="条件筛选" data-toggle="modal" id="filter_btn"/> 
									</div>
								</nav>
							</div>
						</div>
					</div>
					
					<input id="ttid" name="ttid" type="hidden" value="" />
					<input name="sort" type="hidden" value="indate" preserve="true" />
					<input name="order" type="hidden" value="desc" preserve="true" />
					<input name="pageNo" type="hidden" value="" preserve="true" />
					<input name="totalPages" type="hidden" value="" preserve="true" />
						
						
						<div class="r-tab-cout-3-b">
							<div class="to-change-background h-43"></div>
							<table> 
								<thead>
									<tr>
										<th class="table-checkbox">
											<label class="am-checkbox">
												<input id="selectAll"  name="datalist"  type="checkbox" value="" style="display: none;">
											</label>
										</th>
										<th>姓名</th>
										<th>性别</th>
										<th>手机号</th> 
										<th>手机2号</th> 
										<th>店名</th>
										<th>职位</th>
										<th>跟进状态</th>
										<th>跟进内容</th>
									</tr>
								</thead>
								<tbody id="datagridTemplate" style="display: none">
									<tr>
										<td>#application_id#</td>
										<td><a href="javascript:;" onclick="detailptrest('#vc_code#')">#vc_name#</a></td>
										<td>#i_sex#</td>
										<td>#vc_mobile#</td>
										<td>#mobile2#</td>		
										<td>#branchname#</td>	
										<td>#position#</td>		
										<td>#gj_commresult#</td>
										<td>#remark#</td>
									</tr>
								</tbody>
								
								<tbody id="datagrid">
								</tbody>
							</table>
							<div class="pageDiv">
								<ul class="pagination">
								</ul>
							</div>
					</div>
						
						
					</form>
				</div>
	<input type="hidden" name="actionroot" id="actionroot" value="${def:actionroot}" />
<script language="JavaScript">
var bin="${fld:guestcode}";
$(document).ready(function() {
	searchSelectInit($("#cc_position2,#cc_branchcode2,#cc_possibility2,#cc_theproduct2,#cc_position,#cc_sex,#cc_possibility,#cc_theproduct,#cc_branchcode"));
	
	 $(".header-close").unbind().on("click",function(){
		$("#modalAddnew").modal('hide');
		ccms.util.clearForm('addForm');
	});
	 $(".ben-close").unbind().on("click",function(){
			$("#modalshuaixuan").modal('hide');
		});
	 $Dialog().date($('#cc_birth'));
	 $('#cc_possibility').selectpicker({
	        'selectedText': 'cat'
	 });
	 $('#cc_theproduct').selectpicker({
	        'selectedText': 'cat'
	 });
	 $('#cc_possibility2').selectpicker({
	        'selectedText': 'cat'
	 });
	 $('#cc_theproduct2').selectpicker({
	        'selectedText': 'cat'
	 });
	$('#save_btn').on('click',function(){
		
		if($('#cc_code').val()!=""){
			update();
		}else{
			insert();
		}
	});
	
	$("#btn-label").unbind().on('click',function(){
		ccms.dialog.open({url : "${def:context}${def:actionroot}/addfilter?guestcode="+bin+"&thecode="+$('#cc_code').val(), width:1000, height:670});
	})
	
	
	/* $("#filter_btn").unbind().on('click',function(){
		ccms.dialog.open({url : "${def:context}${def:actionroot}/filter", width:1000, height:670});
	}) */
	
	$("#filter_btn").on('click',function(){
		$("#modalshuaixuan").modal('show');
	});
	
	//修改信息
	$('#edit_btn').on('click',function(){
		$('#formTitle').text('修改');
		//清空form下所有select
		$("#addForm select").each(function(){
			setSelectValue($("#"+$(this).attr("name")), "");
		});
		edit();
	});
	$("#addttname").on("click", function(e){
		$('#formTitle').text('添加');
		ccms.util.clearForm('addForm'); 
		//清空form下所有select
		$("#addForm select").each(function(){
			setSelectValue($("#"+$(this).attr("name")), "");
		});
		$('#modalAddnew').modal('show');
	});
	$("#que_btn").on('click',function(){
		$("#cc_branchcodes2").val($("#cc_branchcode2").val()); 
		$("#cc_possibilitys2").val($("#cc_possibility2").val()); 
		$("#cc_theproducts2").val($("#cc_theproduct2").val());
		$("#modalshuaixuan").modal('hide');
	});
	
	 $("#selectAll").unbind().on("ifClicked",function(){    //点击事件未选中
		 if( $(this).prop("checked") ){// 
			$('input[name=datalist]').iCheck('uncheck');
		 }else{
			$('input[name=datalist]').iCheck('check');  //
		 }
	    });
	$("#ttid").val(bin);
	
	$('#cc_mobile').on('blur',function(){
		checkTel($('#cc_mobile').val(),"cc_mobile");
	});
	$('#cc_mobile2').on('blur',function(){
		checkTel($('#cc_mobile2').val(),"cc_mobile2");
	});
	
	$("#communicaRecord").unbind().on("click",function(){
		var thecode =$('input[name="datalist"]:checked').val();
		var leng=$('input[name="datalist"]:checked').length
		if(thecode!=""&&leng==1){
			ccms.dialog.open({url:"${def:context}/action/project/fitness/guest/detail/gustmanage/followfrom/crud?thecode="+thecode});
		}else{
			ccms.dialog.notice("请选择一条数据!");
		}
	});
	
	 this.search=search; 
	search=$Search({datagrid:"datagrid",formId:"searchForm",success:function(){
		$("table").css("table-layout","auto");
		ccms.util.renderCheckbox("datalist");
	}}).initSearchBtn().searchData(1);
});

function update(){
	var uri="${def:context}/action/project/fitness/guest/detail/gustmenu/visitRecord/update";
	   ajaxCall(uri,{
		   	method: "post",
		   	form:"addForm",
		   	progress: false,
		   	dataType: "script",
		   	success: function() {
		   		ccms.dialog.notice("修改成功!", 2000, function(){
			   		$('#modalAddnew').modal('hide');
			   		ccms.util.clearForm('addForm');
			   		search.searchData(1);
			   		$('#modalAddnew').prop('scrollTop','0');
		   		});
	   		}
	   	}); 
}

function detailptrest(code) {
	ccms.dialog.open({url : '${def:context}/action/project/fitness/guest/detail/gustmenu/thecontactinfo/crud?guestcode='+bin+"&thecode="+code});
}

function insert(){
	$("#guestttcode").val(bin);
	$("#cc_possibilitys").val($("#cc_possibility").val());
	$("#cc_theproducts").val($("#cc_theproduct").val());
	var uri="${def:context}/action/project/fitness/guest/detail/gustmenu/visitRecord/insert";
	   ajaxCall(uri,{
		   	method: "post",
		   	form:"addForm",
		   	progress: false,
		   	dataType: "script",
		   	success: function() {
				ccms.dialog.notice("新增成功!", 2000, function(){
			   		$('#modalAddnew').modal('hide');
			   		ccms.util.clearForm('addForm');
			   		search.searchData(1);
			   		$('#modalAddnew').prop('scrollTop','0');
				});
	   		}
	   	}); 
}

function edit(){
	var leng=$('input[name="datalist"]:checked').length
	var code=$('input[name="datalist"]:checked').val();
	if(leng!=1||code==''||code==null){
		ccms.dialog.notice("请选择一条进行修改!");
	}else{
		ccms.util.clearForm('addForm');
		$('#modalAddnew').prop('scrollTop','0');
		var uri="${def:context}/action/project/fitness/guest/detail/gustmenu/visitRecord/edit?code="+code;
		   ajaxCall(uri,{
		   	method: "get",
		   	progress: false,
		   	dataType: "script",
		 	async:false,
		   	success: function() {
		   		$('#modalAddnew').modal('show');
		 	  	}
			});
		}
}
function checkTel(value,str){
    var isPhone = /^([0-9]{3,4}-)?[0-9]{7,8}$/;
    var isMob=/(^((0\d{2,3})-)(\d{7,8})(-(\d{3,}))?$)|(^1[3578]\d{9}$)|(^1\d{10}$)/;
    var value= value
    if(!isMob.test(value)&&!isPhone.test(value)){
    	ccms.dialog.notice("请输入正确手机号或电话号!");
	    	 $('#'+str).val('');
	    }
   }


</script>
</body>
</html>