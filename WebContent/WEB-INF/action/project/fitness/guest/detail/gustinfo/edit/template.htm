<!DOCTYPE html>
<html>
<head>
${inc:/action/project/fitness/home/pub}
<title>客户信息</title>

</head>
<body>
	<div class="modal fade" id="modalAddnew"  tabindex="-1" style="display:none;">
		<div class="basic-information modal-dialog dialogbg" >
				<header class="header-default">
					<span id="formTitle">修改</span>
				</header>
				<div class="b-i-main  yyc_b-i-main">
					<form id="addForm" name="addForm" method="post">
					<input type="hidden" id="cc_code" name="cc_code" value="${fld:code}"/>
					<input type="hidden" id="yttcode" name="yttcode" value=""/>
					<input type="hidden" id="custcation" name="custcation" value=""/>
					<input type="hidden" id="possibility4" name="possibility4" value=""/>
					
					<nav >
						
						<li>
							<label>公司名称<span style="color: red;">*</span></label>
							<input type="text" id="company" name="company" value="${fld:officename}" maxlength="80"  placeholder="公司名称"/>
						</li>
						<li> 			
							<label>公司数量</label> 	
							<input type="text" id="guestnumall" name="guestnumall" value="${fld:guestnum}" maxlength="80" placeholder="公司数量"/>
			 			 </li>
						<!-- <li class='lis'>
							<label>联系人姓名<span style="color: red;">*</span></label>
							<input type="text" id="cc_name" name="cc_name" value="" maxlength="80"  placeholder="姓名"/>
						</li> -->
						
						<li>
							<label>公司类型<span style="color: red;">*</span></label>
							<select  id="cc_birthall" name="cc_birthall" > 
								<option value="">选择客户类型</option>
								<option value="1">健身俱乐部</option>
								<option value="2">健身工作室</option>
								<option value="3">瑜伽会所</option>
								<option value="4">器械器</option>
								<option value="5">培训机构</option>
								<option value="6">其他</option>
							</select>
						</li>
					
			 			<li>
			 				<label>可能性</label> 	
							<select id="possibility" title="请选择" name="possibility" class="selectpicker show-tick form-control" multiple data-live-search="false">
								<isgood-rows>
									<option value="${fld:procodeis}">${fld:pronameis}</option>
	                         	</isgood-rows>
	                         </select>
			 			</li>
			 			<li>
			 				<label>客户分类<span style="color: red;">*</span></label> 	
							<div class="my-selected">
								<select  id="communicationall" name="communication"> 
									<option value="">请选择</option>
									<option value="1">粉丝客户</option>
									<option value="2">客户</option>
									<option value="3">重点意向客户</option>
									<option value="4">咨询客户</option>
									<option value="5">陌生客户</option>
								</select>
							</div>
			 			</li>
			 			
						<li class="hasCheck" id="businesstype1">
							<label>客户已购产品</label> 
							
							<select id="custcationsall" title="请选择" name="custcationsall" class="selectpicker show-tick form-control" multiple data-live-search="false">
								<product-rows>
									<option value="${fld:procode}">${fld:proname}</option>
								</product-rows>
	                         </select>
								
							
						</li>
			 			
			 			
			 			<li>
							<label>获客渠道<span style="color: red;">*</span></label>
							<select  id="cc_channelall" name="cc_channelall" class=""> 
								<option value="">渠道类型</option>
								<option value="1">抖音</option>
								<option value="2">公众号</option>
								<option value="3">转介绍</option>
								<option value="4">展会</option>
								<option value="5">论坛</option>
								<option value="6">粉丝客户</option>
								<option value="7">其他</option>
							</select>
						</li>
						<li> 			
							<label>电话</label> 	
							<input type="text" id="cc_officetel" name="cc_officetel" value="" maxlength="80" placeholder="公司电话"/>
			 			 </li>
						
						
						
						
						<li> 			
							<label>公众号</label> 	
							<input type="text" id="thepublicall" name="thepublicall" value="" maxlength="80" placeholder="公众号" />
			 			</li>	 
			 			<li> 			
							<label>E-mail</label> 	
							<input type="text" id="cc_email" name="cc_email" value="" maxlength="80" placeholder="email"/>
			 			</li>	
			 		
			 			
						<li> 			
							<label>地区<span style="color: red;">*</span></label> 	
							<div class="my-selected">
								<select  id="province2" name="province2"> 
									<option value="">请选择省</option>
								</select>
							</div>
			 			</li>	
			 			<li> 			
							<label>市<span style="color: red;">*</span></label> 	
							<div class="my-selected">
								<select  id="city2" name="city2"> 
									<option value="">请选择市</option>
								</select>
							</div>
			 			</li>
			 			
			 			<div id="salelist" >
						</div>
			 			
			 			
			 						
						<li> 			
							<label>咨询师</label> 	
							<div class="my-selected">
								<select id="cc_mc" name="cc_mc"   >
									<!-- <staff-rows3>
										<option value="${fld:userlogin}">${fld:name}</option>
									</staff-rows3> -->
								</select>
							</div> 
			 			</li>
			 			<li class="to100w" style="margin-left: 6%">
							<label>公司备注</label>
							<textarea id="cc_remark" name="cc_remark" placeholder="暂无数据" class="my-textarea" rows="" cols="4"></textarea>
						</li>	
						
					</nav>
					</form>
				</div>
				<footer class="footer-default">
					<button id="save_btn" class="my-btn-default active">保存</button>
				</footer>
			</div>
		</div>	
	
	<input type="hidden" name="actionroot" id="actionroot"
		value="${def:actionroot}" />
	<script language="JavaScript">
		var branchstr="";
		var gust_code="";
		var search = null;
$(document).ready(function() {
	$('#modalAddnew').modal('show');
	gust_code = "${fld:guestcode}";
	var menuorgid = "${fld:menuorgid}";
		//帕斯贝利资源宝
		searchSelectInit($("#cc_birthall,#possibility,#communicationall,#custcationsall,#cc_channelall,#province2,#city2,#cc_mc"));
		 $('#custcations').selectpicker({
		        'selectedText': 'cat'
		 });
		 $('#custcations2').selectpicker({
		        'selectedText': 'cat'
		 });
		 $("#businesstype1").hide();
		 setSelectValue($("#cc_birthall"), "${fld:customtype}");
		 setSelectValue($("#communicationall"), "${fld:communication}");//客户分类
		 setSelectValue($("#custcationsall"), "${fld:custclass}");//客户详细分类（已购产品）
		 setSelectValue($("#cc_channelall"), "${fld:channel}");//获客渠道
		 $("#cc_officetel").val("${fld:othertel}");//电话
		 $("#thepublicall").val("${fld:thepublic}");//公众号
		 $("#cc_email").val("${fld:email}");//email
		 var possibility_id='${fld:possibility}';
		 var arrlists=possibility_id.split(",");

		 $('#possibility').selectpicker('val', arrlists);
		 $("#possibility4").val("${fld:possibility}");

		 setSelectValue($("#province2"), "${fld:province2}");
		 /*setSelectValue($("#city2"), "${fld:city2}");*/
		 getSelectDomain("city2", "City", "Province", "${fld:province2}",function(){
		  	setSelectValue($("#city2"), "${fld:city2}");
		 });
		 getSelectDomain("province2", "Province");
		 $("#province2").change(function(){
		 	getSelectDomain("city2", "City", "Province", $(this).val(),function(){
		      	setSelectValue($("#city2"), init_event_city2);
		     });
		 });


		 setSelectValue($("#cc_mc"), "${fld:mc}");


		 	var communication=$("#communicationall").val();
		 	if(communication==''){
		 		$('#businesstype1').hide();
		 		setSelectValue($("#custcation"), "");
		 	}else{
		 		if(communication=='2'){
		 			$('#businesstype1').show();
		 			/*selectpicker($("#custcations"), );*/
		 			var select_id='${fld:custclass}';
		 			 var arr=select_id.split(",");
		 			/* $('#custcations').val(arr).trigger('change');*/
		 			/*$("#custcations").val('${fld:custclass}');*/
		 			$('#custcationsall').selectpicker('val', arr);
		 			$("#custcation").val("${fld:custclass}");
		 		}else{
		 			$('#businesstype1').hide();
		 			setSelectValue($("#custcationsall"), "");
		 		}
		 	}
		 var fend="";
		 var fendnum=0;
		 $("#salelist").empty();
		 <branch-rows>
			 if("${fld:states}"==0){
				 fend +='<li >'; 			
				 fend +='<label>主店名称</label> ';
				 fend +='<input type="text" id="storename" name="storename" value="" maxlength="80" placeholder="主店名称" />	';
				 fend +='<label>主店地址</label> ';
				 fend +='<input  type="text" id="address" name="address" value="" maxlength="500" placeholder="地址详细信息" />	';
				 fend += '&nbsp;&nbsp;&nbsp;&nbsp;';
				 fend +='<i class="am-icon-plus" id="addpay_btnbin" title="添加"></i>';
				 fend +='<input type="hidden"  name="states" value="0" />	';
				 fend +='</li>';
			 }else{
				 fend +='<li>';
				 fend +='<label>分店'+fendnum+'名称</label>' ;
				 fend +='<input type="text" id="storename" name="storename" value="${fld:storename}" maxlength="80" />';
				 fend +='<label>分店地址</label>';
				 fend +='<input type="text" id="address" name="address" value="${fld:address}"  maxlength="500"/>';
				 fend +='&nbsp;&nbsp;&nbsp;&nbsp;';
				 fend +='<label  style="color:red" onclick="removeObj(${fld:branchcode})">删除</label>';
				 fend +='</li>';
				
			 }
		 fendnum++;
		 </branch-rows>
		 $("#salelist").append(fend);

		 $("#communicationall").change(function(){
				setSelectValue($("#custcationsall"), "");
				$("#custcationsall").val("");
				var cust2=$("#communicationall").val();
					if(cust2==''){
						$('#businesstype1').hide();
						setSelectValue($("#custcationsall"), "");
						$("#custcation").val("");
					}else{
						if(cust2==2){
							$('#businesstype1').show();
						}else{
							$('#businesstype1').hide();
							setSelectValue($("#custcationsall"), "");
							$("#custcation").val("");
						}
					}
			});
			
		 
		 
		 
		 $("#addpay_btnbin").on("click",function(e){
				appendSale();
		});
		 
		 
});

		
function removeObj(obj){
	$Dialog().confirm("确定要删除吗?", function() {
		var url="${def:context}/action/project/fitness/guest/detail/gustinfo/delete?branchcode="+obj+"&guestcode="+gust_code;
		alert(url);
		ajaxCall(url,{
			method: "get",
			progress: false,
			dataType: "script",
			success: function() {
				ccms.dialog.notice("删除成功！",1000, function(){
					window.parent.location.reload();
					alert("====="+gust_code);
					window.location.href='${def:context}/action/project/fitness/guest/detail/gustinfo/edit?code='+gust_code;
					
				});
			}
		}); 
	});
	
	
}
function appendSale(){
 	var str="";
 	str +='<li>';
 	str +='<label>分店'+fendnum+'名称</label> ';
 	str +='<input type="text" id="storename" name="storename" value="" maxlength="80" placeholder="分店'+fendnum+'名称" />';	
 	str +='<label>分店地址</label> ';
 	str +='<input  type="text" id="address" name="address" value="" maxlength="500" placeholder="地址详细信息" />';	
 	str +='&nbsp;&nbsp;&nbsp;&nbsp;';
 	str +='<label  style="color:red" onclick="removeObj1(this)">删除</label>';
 	str +='<input type="hidden"  name="states" value="1" />	';
 	str +='</li>';
 	$('#salelist').append(str);
 	
 }
function removeObj1(obj){
	$(obj).parent().remove();
	
	cumulative--;
	var str="";
	var i=0;
	var namelen=$("[name=storename]");
	
	for (var i = 1; i < namelen.length; i++) {
		str +="<li>";
		str +='<label>分店'+i+'名称</label> ';
		str +='<input type="text" id="storename" name="storename" value="'+$("[name=storename]").eq(i).val()+'" maxlength="80" placeholder="分店'+i+'名称" />';	
		str +='<label>分店地址</label> ';
		str +='<input  type="text" id="address" name="address" value="'+$("[name=address]").eq(i).val()+'" maxlength="500" placeholder="地址详细信息" />';	
		str +='&nbsp;&nbsp;&nbsp;&nbsp;';
		str +='<label  style="color:red" onclick="removeObj(this)">删除</label>';
		str +='<input type="hidden"  name="states" value="1" />	';
		str +="</li>";
	}
	$('#salelist').html("");
	$('#salelist').append(str); 
}
		
	</script>
</body>
</html>