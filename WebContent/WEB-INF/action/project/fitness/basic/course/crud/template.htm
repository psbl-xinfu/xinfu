<!DOCTYPE html>
<head>
${inc:/action/project/fitness/home/pub}
<script type="text/javascript" src="${def:context}/js/project/fitness/js/jscolor/jscolor.js"></script>
<title>卡种类型管理</title>
</head>
<body>
	<!--addnew/edit form-->
	<div class="modal fade" id="modalAddnew"  tabindex="-1" style="display:none;">
		<div class="basic-information modal-dialog dialogbg">
				<header class="header-default">
					<span id="formTitle">新增</span>
					<button type="button" class="header-close" data-dismiss="modal" aria-hidden="true"></button>
				</header>
			<form id="formEditor" name="formEditor" class="form-horizontal" role="form" method="post">
				<input type="hidden" id="vc_code" name="vc_code" value=""/>
			
				<!-- 时间 -->
				<div id="checkedNodesDiv"></div>
	          	<div class="modal-body b-i-main">
					<input type="hidden" id="tuid" name="tuid" value="" />
					<nav>
						<li>
							<label style="width: 100px;">课程名称：</label>
							<input type="text" id="vc_name" name="vc_name" value="" maxlength="80" placeholder="课程名称"/>
						</li>
						<li>
							<label>课程(是课程否已学过)<span style="color: red;">*</span></label>
							<input type="radio" name="isgood" value="1" />是	
							<input type="radio" name="isgood" value="0" />否
						</li>
					</nav>
				</div>		
			<footer class="footer-default">
			  <button type="button" id="save_btn">确&nbsp;定</button>
			</footer>
		</form>
		</div>
	</div>
	<form  role="form" method="post" id="searchForm">
		<input name="sort" type="hidden" value="c.code::integer" preserve="true" />
		<input name="order" type="hidden" value="desc" preserve="true" />
		<input name="pageNo" type="hidden" value="" preserve="true" />
		<input name="totalPages" type="hidden" value="" preserve="true" />
		<div class="am-tabs-bd r-tab-cont">
			<div class="c-n-nav-2 am-tab-panel am-in am-active am-fade three-none" >
			<div class="tab-cout-nav">
				<div class="tab-cout-nav-t">
					<nav class="tab-nav-my">
						<div class="r-c-btnList">
							
							<img src="${def:context}/js/project/fitness/image/SVG/nav/xinzengkecheng.svg" title="新增" alt="" data-toggle="modal" id="addnew_btn">
						</div>		
					</nav>
					</div>
					<div class="tab-cout-nav-b">
						<nav class="r-c-3-t-b-l">
						</nav>
						<nav class="r-c-3-t-b-r">
							 <li>
									<img src="${def:context}/js/project/fitness/image/SVG/nav/xiugai.svg" title="修改" alt=""id="edit_btn">
							</li>
							<li>
								<img src="${def:context}/js/project/fitness/image/SVG/btn/kaiqi.svg" title="启用" alt=""id="enablement">
							</li>
							<li>
								<img src="${def:context}/js/project/fitness/image/SVG/btn/jinyong.svg" title="禁用" alt=""id="disable">
							</li>
						</nav>
					</div>
				</div>
				<!-- 通用表格 -->
				<div class="r-tab-cout-3-b">
					<div class="to-change-background h-43"></div>
					<table> 
						<thead>
							<tr>
								<th class="table-checkbox">
									<label class="am-checkbox">
										<input id="selectAll"  name="datalist"  type="checkbox" value="" style="display: none;">
									</label>
								</th>
								<th>课程名称</th>
								<th>课程状态</th>
								
							</tr>
						</thead>
						
						<tbody id="datagridTemplate" style="display: none">
							<tr>
							 <td class="table-checkbox">#application_id#</td> 
								<td >#vc_name#</td>
									<td >#status#</td>
								
							</tr>
						</tbody>
						<tbody id="datagrid">
						</tbody>
					</table>
					<div class="pageDiv">
						<ul class="pagination">
						</ul>
					</div>
				</div>
			</div>
		</div>
	</form>
	<form action="${def:context}${def:actionroot}/excel" role="form" method="post" id="daochuForm" target="_blank" style="display: none">
		<input id="daochu_s_name" name="daochu_s_name" type="text" />
		<input id="daochu_s_type" name="daochu_s_type" type="text" />
		<input id="daochu_s_status" name="daochu_s_status" type="text" />
		<input id="daochu_s_tong" name="daochu_s_tong" type="text" />
		<input id="daochu_s_share" name="daochu_s_share" type="text" />
		<input id="daochu_s_time" name="daochu_s_time" type="text" />
	</form>
	<input type="hidden" name="actionroot" id="actionroot" value="${def:actionroot}" />
<script language="JavaScript">
var search=null;
$(document).ready(function() {
	ccms.util.renderRadio("isgood");
	$(".header-close").unbind().on("click",function(){
		$("#modalAddnew").modal('hide');
		ccms.util.clearForm('formEditor');
	});
	
	
	

	
	var obj = $Crud({
		formId:"formEditor",
		button:"save_btn",
		bpkField:"vc_code",
		insertBack:function(){
			search.searchData();
		},
		updateBack:function(){
			search.searchData();
		},
		deleteBack:function(){
			search.searchData();
		},
		addNewBack:function(){
			$("#formTitle").html("新增");
			/* $('#vc_maxusernum').val(1); */
			
			$(".color").removeAttr("style"); 
			$('input[name=isgood][value=1]').iCheck('check');
			
		},
		editBack:function(){
			$("#formTitle").html("修改");
		},
		validate:function(){
			// modified by leo 如果保存验证未通过，不提交
			if(!save()){
				return false;
			}
			var flag=$("#formEditor").validate({
		});
			return flag;
		}
	
	}).init();
		this.search=search;
		search=$Search({datagrid:"datagrid",formId:"searchForm",success:function(){
			ccms.util.renderCheckbox("datalist");
			//全选  
		    $("#selectAll").unbind().on("ifChecked",function(){ 
		    	//点击事件未选中
				$('input[name=datalist]').iCheck('check');  //
		    }).on("ifUnchecked",function(){    //点击事件未选中
				$('input[name=datalist]').iCheck('uncheck');  //
		    }); 
			
			
			$("#edit_btn").unbind().on("click", function(){
				var obthis = getCheckboxValue("datalist");
				var len=$('input[name=datalist]:checked').length
				if(obthis!=""&&len==1){
					obj.edit({id:obthis});
				}else{
					ccms.dialog.alert("请选择一个卡类型！")
				}
			});	
				
			
			
	}}).initSearchBtn().searchData(1);

	
	
	//导出
	$("#daochu_list").unbind().on("click", function(){
         $("#daochu_s_name").val($("#searchForm #s_name").val());
         $("#daochu_s_type").val($("#searchForm #s_type").val());
         $("#daochu_s_status").val($("#searchForm #s_status").val());
         $("#daochu_s_tong").val($("#searchForm #s_tong").val());
         $("#daochu_s_share").val($("#searchForm #s_share").val());
         $("#daochu_s_time").val($("#searchForm #s_time").val());
         $("#daochuForm").submit();
    });	
	$("#disable").unbind().on("click", function(){
		deftatus("禁用", 0);
	});
	$("#enablement").unbind().on("click", function(){
		deftatus("启用", 1);
	});
});



function getShop(id){
	var url = "${def:context}${def:actionroot}/getshop?id="+id
		ajaxCall(url,{
			method: "get",
			progress: false,
			dataType: "script",
			success: function() {
			}
		});
}





function save(){
	var saveResult=true;
	$('.salesChoice').each(function(){
		var id=$(this).val();
		if(id!=""){
			// modified by leo 190521 修正无法取折扣值问题
			//var val=$(this).parent().next().next().children().val();
			var val=$(this).next().next().val();
			$('#'+id).val(val);
			if(val==""){
				ccms.dialog.alert("有折扣项目未添折扣");
				saveResult = false;
			}
		}
		// add by leo 190522 项目项目未选择时提示
		else{
			ccms.dialog.alert("有折扣项目未选择,请选择或删除");
			saveResult = false;
		}
	})
	insertMsg();
	return saveResult;
}


function insertMsg(){
	var divobj = $("#checkedNodesDiv");
	var codes=$('.timeChoice');
	divobj.empty();
	for(var i = 0; i < codes.length; i++){
		var obj = codes[i];
		var val = codes[i].value;
		if(val!=""){
			var s_time=$(obj).parent().next().next().children().val();
			var e_time=$(obj).parent().next().next().next().next().children().val();
	    	divobj.append('<input type="hidden" name="week" value="' + val + '" />');
	    	divobj.append('<input type="hidden" name="s_time" value="' + s_time + '" />');
	    	divobj.append('<input type="hidden" name="e_time" value="' + e_time + '" />');
		}
	}
}


function listValadate(obj,index,str){
	var objs=	$('.'+str).not(":eq("+index+")");
	for(var i=0;i<objs.length;i++){
			if(obj.value==$(objs[i]).val()){
				ccms.dialog.alert("不能选择重复项目");
				obj.value="";
			}
	}
}

function salesViladate(obj){
	var pattern=/^([0-9]{1,2}|100)$/;
	if(!pattern.test(obj.value)){
		ccms.dialog.alert("请输入1-100的整数");
		obj.value='';
		return false;
	}
}

/* function scaleViladate(value){
	var pattern=/^([0-9]{1,2}|100)$/;
	if(!pattern.test(value)){
		ccms.dialog.alert("请输入1-100的整数");
		$("#cc_scale").val(1)
		return false;
	}
} */
//共享值
/* function maxnumViladate(num,value){
	if(num==0){
		if(value!=1){
			ccms.dialog.alert("独享人数只能是1");
		    $("#vc_maxusernum").val(1)
		}
	}else{
			if(!isNumber(value)||parseInt(value) < 2 ){
				ccms.dialog.alert("请输入大于等于2的整数");
			 $("#vc_maxusernum").val(2)
		}
	}
} */
//启用禁用
function deftatus(name, status){
	var obthis = getCheckboxValue("datalist");
	var count = obthis.split(",").length;
	if(obthis!= ""){
		ccms.dialog.confirm("确定"+name+"吗？！", function() {
			var url="${def:context}${def:actionroot}/updatestatus?id="+obthis+"&status="+status;
			ajaxCall(url,{
				method:"GET",
				progress:true,
				dataType:"script",
				success:function(){
					ccms.dialog.notice("成功！", 2000, function(){
						search.searchData(1);
					})
				}
			});
		});
	}else{
		ccms.dialog.notice("请选择!");
	}
}
</script>
</body>
</html>