<!DOCTYPE html>
<html lang="zh-CN">
<head>
${inc:/action/project/fitness/home/pub}
<title>私教转课</title>
<link href="${def:context}/js/project/fitness/css/contract1.css" rel="stylesheet">
<style type="text/css">
.bg{
background: rgba(42, 48, 56, -1.2) !important
}
</style>
</head>
    <body style="font-size: 14px">
	<form id="ptrestForm" name="ptrestForm" class="form-horizontal" role="form" method="post">
		<input type="hidden" id="type" value="1" />
		<input type="hidden" id="ccguestcode" name="ccguestcode" />
		<input type="hidden" id="yuanmc" name="yuanmc" />
		<input type="hidden" id="contents" name="contents" />
      	<div id="checkedNodesDiv"></div>
      	<!-- 私教转课 -->
				<div class="am-tabs r-tab-container goodsSale">
					<div class="sec-1">
						<label for="id" class="hebing">公司名称：</label>
						<input type="text" name="custall" id="custall" title="公司名称" placeholder="公司名称" style="width: 160px;" />
						<input type="hidden" name="custcode" id="custcode" />
						<label for="id" class="hebing">合并给其他公司 ：</label>
						<input type="text" name="newcustname" id="newcustname" title="公司名称" placeholder="公司名称" style="width: 160px;" />
						<input type="hidden" name="newcustcode" id="newcustcode" />
						<label for="id" class="zhuangyi">联系人：</label>
						<input type="text" name="theall" id="theall" title="手机号" placeholder="手机号" style="width: 160px;" />
						<input type="hidden" name="thecode" id="thecode" />
						<label for="id" class="zhuangyi">转移给其他公司 ：</label>
						<input type="text" name="newthename" id="newthename" title="公司名称" placeholder="公司名称" style="width: 160px;" />
						<input type="hidden" name="newthecode" id="newthecode" />
						<label for="id">
		                    <input type="checkbox" id="isgroup" name="isgroup" >转移(不勾选是合并)
		                </label>
		                <!-- <label for="id">
		                    <input type="radio" name="isgroup"  value="1">转移
		                </label> -->
		                <button type="button" id="savebtn">确认</button>
					</div>
					<div class="sec-2">
						
						<div class="sec-bottom r-tab-cout-3-b">
							<table>
								<thead>
									<tr>
										<!-- <th id="caozuo" class="table-checkbox">操作</th> -->
										<th>序号</th>
										<th>姓名</th>
										<th>性别</th>
										<th>手机号</th>
										<th>职位</th>
										<th>公司名称</th>
										<th>咨询师归属</th>
									</tr>
								</thead>
								<tbody id="ptrestlist">
								</tbody>
							</table>
						</div>
					</div>
					<div class="sec-4">
						<label>操作员：</label>
						<input type="text" value="${fld:staff_name}" readonly="readonly">
						<label>操作日期：</label>
						<input type="text" value="${def:date}" readonly="readonly">
					</div>
				</div>
     </form>
    </body>
<script type="text/javascript">
$(function(){
	//页面点击事件
	$(document).click(function(){ 
		$(".error").html("");
	}); 
	ccms.util.renderCheckbox("isgroup");
	
	/* $("#caozuo").hide(); */
	$(".zhuangyi").hide();
	$("#theall").hide();
	$("#newthename").hide();
	
	$(".hebing").show();	
	$("#custall").show();
	$("#newcustname").show();
	$("#isgroup").unbind().on('ifClicked',function(){
		$("#ptrestForm").find('input[type=text],input[type=hidden]').each(function(){
			$(this).val('');
		})
		$("#ptrestlist").html("");
		if($("#isgroup").is(':checked')){
			/* $("#caozuo").hide(); */
			$(".zhuangyi").hide();
			$("#theall").hide();
			$("#newthename").hide();
			
			$(".hebing").show();	
			$("#custall").show();
			$("#newcustname").show();
		}else{
			/* $("#caozuo").show(); */
			$(".hebing").hide();	
			$("#custall").hide();
			$("#newcustname").hide();
			
			$(".zhuangyi").show();
			$("#theall").show();
			$("#newthename").show();
		}
	});	
	
	
	//查询转课人
	$("#custall").blur(function(){
		$("#type").val("1");
		if($(this).val()!=""){
			ccms.dialog.open({url : "${def:context}/action/project/fitness/util/queryguestlist2/crud?pickcustname="
					+$(this).val()+"&objid=custcode&objidtwo=custall&random_number="+Math.random()});
		}else{
			$("#ptrestlist").html("");
			$("#custcode").val("");
		}
	});
	//查询要转课人
	$("#newcustname").blur(function(){
		$("#type").val("2");
		if($(this).val()!=""){
			ccms.dialog.open({url : "${def:context}/action/project/fitness/util/queryguestlist2/crud?pickcustname="
					+$(this).val()+"&objid=newcustcode&objidtwo=newcustname&random_number="+Math.random()});
		}else{
			$("#newcustcode").val("");
		}
	});
	
	//要被转移的人
	$("#theall").blur(function(){
		$("#type").val("1");
		if($(this).val()!=""){
			ccms.dialog.open({url : "${def:context}/action/project/fitness/util/queryguestlist/crud?pickcustname="
					+$(this).val()+"&objid=thecode&objidtwo=theall&random_number="+Math.random()});
		}else{
			$("#ptrestlist").html("");
			$("#theall").val("");
		}
	});
	//查询转给哪个公司
	$("#newthename").blur(function(){
		$("#type").val("2");
		if($(this).val()!=""){
			ccms.dialog.open({url : "${def:context}/action/project/fitness/util/queryguestlist2/crud?pickcustname="
					+$(this).val()+"&objid=newthecode&objidtwo=newthename&random_number="+Math.random()});
		}else{
			$("#newthename").val("");
		}
	});
	
	
	//合并或转移
	$("#savebtn").click(function(){
		var divobj = $("#checkedNodesDiv");
		divobj.empty();
		if($("#isgroup").is(':checked')){
			if($("#thecode").val()==""){
				ccms.dialog.notice("请输入联系人名称！", 2000);
				return false;
			}
			if($("#newthecode").val()==""){
				ccms.dialog.notice("请输入转移其他公司 ！", 2000);
				return false;
			}
			var url = "${def:actionroot}/updatethe";
			ajaxCall(url,{
				method:"post",
				form:"ptrestForm",
				progress:true,
				dataType:"script",
				success:function(){	
					ccms.dialog.notice("成功！", 2000, function(){
						location.href=location.href;
					});
				}
			});
		}else{
			if($("#custcode").val()==""){
				ccms.dialog.notice("请输入公司名称！", 2000);
				return false;
			}
			if($("#newcustcode").val()==""){
				ccms.dialog.notice("请输入合并其他公司 ！", 2000);
				return false;
			}
			var arrthecode=thecodes.split(',');
			for(var i=0;i<arrthecode.length;i++){
				var thecode = arrthecode[i];
		    	divobj.append('<input type="hidden" name="thecodelog" value="' + thecode + '" />');
			}
			var url = "${def:actionroot}/update";
			ajaxCall(url,{
				method:"post",
				form:"ptrestForm",
				progress:true,
				dataType:"script",
				success:function(){	
					ccms.dialog.notice("成功！", 2000, function(){
						location.href=location.href;
					});
				}
			});
		}
	});
	
	
});
function pickguestCallback(){
	if($("#type").val()=="1"){
		var url = "${def:actionroot}/queryguest?custcode="+$("#custcode").val();
		ajaxCall(url,{
			method:"get",
			progress:true,
			dataType:"script",
			success:function(){	
			}
		});
	}
}

function picktheCallback(){
	if($("#type").val()=="1"){
		var url = "${def:actionroot}/querythelist?thecode="+$("#thecode").val();
		ajaxCall(url,{
			method:"get",
			progress:true,
			dataType:"script",
			success:function(){	
			}
		});
	}
}
</script>
</html>
