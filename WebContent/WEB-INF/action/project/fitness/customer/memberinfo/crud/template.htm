<!DOCTYPE html>
<html>
<head>
${inc:/action/project/fitness/home/pub}
<title>会员信息查询</title>
</head>
<body >
	<div id='filter_panel' style='display:none;' class="dialogbg"></div>
		<!--addnew/edit form-->
		<div class="modal fade " id="modalAddnew1"  tabindex="-1" style="display:none;" >
		<div class="basic-information modal-dialog dialogbg" >
				<header class="header-default">
					<span id="formTitlecust">新增</span>
				<span class="header-close" onclick="$('.close').click()"></span> <!--关闭按钮无效，调用函数触发旧按钮点击事件-->
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true" style='display:none;'>&times;</button>
				</header>
				<div class="b-i-main yyc_b-i-main">
					<form id="addForm" name="addForm" method="post">
					<input type="hidden" id="cc_code" name="cc_code" value=""/>
					<input type="hidden" id="cus_code" name="cus_code" value=""/>
					<input type="hidden" id="userlogin" name="userlogin" value=""/>
					<input type="hidden" id="user_id" name="user_id" value=""/>
			    	<aside style="float: left">
						<p>
							<img id="headpic" src="${def:context}/js/project/fitness/image/SVG/170X220.svg">
							<span id="upload_btn"></span>
						</p>
					 </aside>
					<nav>
						<li>
							<label>姓名<span style="color: red;">*</span>：</label>
							<input type="text" id="cc_name" name="cc_name" value="" maxlength="80"/>
						</li>
						<li> 			
							<label>性别<span style="color: red;">*</span>：</label>
							<div class="my-selected">
								<select  id="cc_sex" name="cc_sex"> 
									<option value="">请选择</option>
									<option value="1">男</option>
									<option value="0">女</option>
								</select>
							</div> 	
			 			</li>
						<li> 			
							<label>手机<span style="color: red;">*</span>：</label> 	
							<input type="text" id="cc_mobile" name="cc_mobile" value="" maxlength="80" />
			 			</li>	
						<li></li>
						<li>
							<label>生日<span style="color: red;">*</span>：</label>
							<select id="cc_birth" name="cc_birth"> 
								<option value="">请选择月</option>
								<month>
									<option value="${fld:domain_value}">${fld:domain_text_cn}</option>
								</month>
							</select>
						</li>
						<li>
							<label><span style="color: red;">*</span></label>
							<select id="cc_day" name="cc_day"> 
								<option value="">请选择日</option>
								<day>
									<option value="${fld:domain_value}">${fld:domain_text_cn}</option>
								</day>
							</select>
						</li>
						<li>
						<label>微信：</label>
							<input type="text" id="cc_wx" name="cc_wx" value="" maxlength="80"/>
						</li>
						<li> 			
							<label>qq：</label> 	
							<input type="text" id="cc_qq" name="cc_qq" value="" maxlength="80" />
			 			</li>	
			 			<li> 			
							<label>E-mail：</label> 	
							<input type="text" id="cc_email" name="cc_email" value="" maxlength="80" />
			 			</li>	
						<li> 			
							<label>年龄范围<span style="color: red;">*</span>：</label> 	
							<div class="my-selected">
								<select  id="cc_age" name="cc_age"> 
									<option value="">请选择</option>
									<age>
										<option value="${fld:domain_value}">${fld:domain_text_cn}</option>
									</age>
								</select>
							</div> 
			 			</li>						
						<li> 			
							<label>会籍<span style="color: red;">*</span>：</label> 	
							<div class="my-selected">
								<select id="cc_mc" name="cc_mc">
									<staff-rows3>
										<option value="${fld:userlogin}">${fld:name}</option>
									</staff-rows3>
								</select>
							</div> 
			 			</li>
						<li> 			
							<label>获客渠道<span style="color: red;">*</span>：</label> 	
							<div class="my-selected">
								<select  id="cc_type" name="cc_type"> 
									<guesttype-rows>
										<option value="${fld:vc_topic}">${fld:vc_content}</option>
									</guesttype-rows>
								</select>
							</div> 
			 			</li>	
			 			<li> 			
							<label>默认刷卡类型：</label> 	
							<div class="my-selected">
								<select  id="cardcode" name="cardcode"  style="display: none;" > 
									
								</select>
							</div> 
			 			</li>
						<li> 			
							<label>推荐人：</label> 	
							<input readonly="readonly" type="text" id="recommend" name="recommend" value="" maxlength="80" />
			 			</li>
						<li> 			
							<label>证件类型：</label> 	
							<div class="my-selected">
								<select  id="cc_cardtype" name="cc_cardtype"> 
									<option value="">请选择</option>
									<option value="0">身份证</option>
									<option value="1">驾驶证</option>
									<option value="2">其他</option>
								</select>
							</div> 
			 			</li>		 	
			 			<li> 			
							<label>证件号码：</label> 	
							<input type="text" id="cc_card" name="cc_card" value="" maxlength="80" />
			 			</li>			 			 
			 			<li> 			
							<label>国籍：</label> 	
							<div class="my-selected">
								<select  id="cc_nationality" name="cc_nationality"> 
									<option value="">国籍</option>
									<guoji-row>
										<option value="${fld:param_value}">${fld:param_text}</option>
									</guoji-row> 
								</select>
							</div>
			 			 </li>	
			 			 <li> 			
							<label>民族：</label> 	
							<div class="my-selected">
								<select  id="cc_nation" name="cc_nation"> 
									<option value="">请选择</option>
									<nation>
											<option value="${fld:vc_topic}">${fld:vc_content}</option>
									</nation>
								</select>
							</div>
			 			 </li>				 			
		 				<li> 			
							<label>职业：</label> 	
							<input type="text" id="cc_occupation" name="cc_occupation" value="" maxlength="80" />
			 			 </li>			 			 
				 		<li> 			
							<label>家庭住址：</label> 	
							<div class="my-selected">
								<select  id="province" name="province"> 
									<option value="">请选择省</option>
								</select>
							</div>
					 	</li>		
				 		<li> 			
							<label>市：</label> 	
							<div class="my-selected">
								<select  id="city" name="city"> 
									<option value="">请选择市</option>
								</select>
							</div>
					 	</li>						 
			 			<li> 			
							<label>家庭详细地址：</label> 	
							<input type="text" id="cc_addr" name="cc_addr" value="" maxlength="80" />
			 			</li>		
				 		 <li>
						 </li>
			 			 <li> 			
							<label>公司名称：</label> 	
							<input type="text" id="cc_officename" name="cc_officename" value="" maxlength="80" />
			 			 </li>
			 			  <li> 			
							<label>公司电话：</label> 	
							<input type="text" id="cc_officetel" name="cc_officetel" value="" maxlength="80" />
			 			 </li>			 			 
				 		<li> 			
							<label>公司地址：</label> 	
							<div class="my-selected">
								<select  id="province2" name="province2"> 
									<option value="">请选择省</option>
								</select>
							</div>
					 	</li>		
				 		<li> 			
							<label>市：</label> 	
							<div class="my-selected">
								<select  id="city2" name="city2"> 
									<option value="">请选择市</option>
								</select>
							</div>
					 	</li>			
			 			 <li> 			
							<label>公司详细地址：</label> 	
							<input type="text" id="cc_officeaddr" name="cc_officeaddr" value="" maxlength="80" />
			 			 </li>				 			 		 	
			 			 <li>
			 			 </li>
			 			 <li> 			
							<label>紧急联系人：</label> 	
							<input type="text" id="cc_urgent" name="cc_urgent" value="" maxlength="80" />
			 			 </li>	
			 			  <li> 			
							<label>联系人电话：</label> 	
							<input type="text" id="cc_othertel" name="cc_othertel" value="" maxlength="80" />
			 			 </li>
				 		<li> 			
							<label>健身目的：</label> 	
							<div class="my-selected">
								<select  id="cc_purpose" name="cc_purpose"> 
									<option value="">请选择</option>
									<fitnessPurpose>
											<option value="${fld:vc_topic}">${fld:vc_content}</option>
									</fitnessPurpose>
								</select>
							</div>
						</li>		
				 		<li> 			
							<label>离开原因：</label> 	
							<div class="my-selected">
								<select  id="cc_leave" name="cc_leave"> 
									<option value="">请选择</option>
									<leave>
										<option value="${fld:domain_value}">${fld:domain_text_cn}</option>
									</leave>
								</select>
							</div>
					 	</li>					 			 
				 		<li> 			
							<label>获取咨询习惯：</label> 	
							<div class="my-selected">
								<select  id="cc_gethobbit" name="cc_gethobbit"> 
									<option value="">请选择</option>
									<consultingHabit>
											<option value="${fld:vc_topic}">${fld:vc_content}</option>
									</consultingHabit>
								</select>
							</div>
					 	</li>					 			 
				 		<li> 			
							<label>个人爱好：</label> 	
							<div class="my-selected">
								<select  id="cc_personalhobbit" name="cc_personalhobbit"> 
									<option value="">请选择</option>
									<personalHobbies>
											<option value="${fld:vc_topic}">${fld:vc_content}</option>
									</personalHobbies>
								</select>
							</div>
					 	</li>		
				 		<li> 			
							<label>子女情况：</label> 	
							<div class="my-selected">
								<select  id="cc_children" name="cc_children"> 
									<option value="">请选择</option>
									<children>
										<option value="${fld:domain_value}">${fld:domain_text_cn}</option>
									</children>
								</select>
							</div>
					 	</li>						 
				 		<li> 			
							<label>婚姻情况：</label> 	
							<select id="cc_marriage" name="cc_marriage"> 
									<option value="">请选择</option>
									<mariy>
										<option value="${fld:domain_value}">${fld:domain_text_cn}</option>
									</mariy>
							</select>
						</li>						 
			 			<li class="to100w" >
							<label>备注</label>
							<textarea id="cc_remark" name="cc_remark" placeholder="暂无数据" class="my-textarea" rows="" cols="4"></textarea>
						</li>	
					</nav>
					</form>
				</div>
				<footer class="footer-default">
					<button id="update" class="my-btn-default active">保存</button>
				</footer>
			</div>
		</div>		
      <div class="modal fade" id="myModalLabel"  tabindex="-1"  style="display:none;">
		<div class="basic-information modal-dialog dialogbg">
				<header class="header-default">
					<span id="formTitle">会员留言</span>
				<span class="header-close" onclick="$('.close').click()"></span> <!--关闭按钮无效，调用函数触发旧按钮点击事件-->
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true" style='display:none;'>&times;</button>
				</header>
					<form id="messageForm" name="messageForm" method="post">
				<div class="b-i-main">
						<input type="hidden" id="vc_code" name="vc_code" value=""/>
					<nav>
				<li class="to100w" >
							<label>会员留言：</label>
							<textarea  style="width: 600px;background: rgb(42, 48, 56)" id="mc_message" name="" placeholder="暂无数据" class="my-textarea" rows="" cols="4"></textarea>
						</li> 
					</nav>
				</div>
				<footer class="footer-default">
					<button id="save_message" type="button">保存</button>
				</footer>
				</form>
			</div>
		</div>
			<form  role="form" method="post" id="searchForm">
				<input name="sort" type="hidden" value="indate" preserve="true" />
				<input name="order" type="hidden" value="desc" preserve="true" />
				<input name="pageNo" type="hidden" value="" preserve="true" />
				<input name="totalPages" type="hidden" value="" preserve="true" />
				<input id="period_day" name="period_day" type="hidden" value="${fld:period_day}" preserve="true" />
	
				<!-- 条件筛选开始 -->
				<input id="filterconditionscolumn" type="hidden" 
				value="f_overduecard,f_sex,f_age,f_nofollowstartdate,f_nofollowenddate,f_startmonth,f_startday,f_endmonth,f_endday,f_type,f_mc,f_level,f_purpose,f_stage,f_personalhobbit,f_marriage,f_children,f_leave,f_protection,f_calltimes,f_distributioncount,f_inleftnum"/>
				<div id="filterconditionshtml">
				</div>
				<!-- 条件筛选结束 -->
				<div class="am-tabs-bd r-tab-cont">
					<div class="c-n-nav-2 am-tab-panel am-in am-active am-fade three-none" >
						<div class="tab-cout-nav">
							<div class="tab-cout-nav-t toColumn yyc_tab-cout-nav-t">
								<nav class="tab-nav-my">
									<li class="dateTime">
										<input id="_start_date" name="_start_date" type="text" class="input-default"/>
									</li>
									<li class="dateTime">
										<input id="_end_date" name="_end_date" type="text"class="input-default"/>
									</li>
									<li class="inputName">
										<input type="text" id="vc_all" name="vc_all" placeholder="姓名/电话/卡号" class="input-default"/>							
					 			 	</li>		
					 			 	<li style="width: 130px;">
										 <select id="skill_name" name="skill_name" style="display: none;">
											<option value="">全部</option>
											<staff-rows2>
											<option value="${fld:userlogin}">${fld:name}</option>
											</staff-rows2>
										</select>		
									  </li>
									  <li>
										<select id="vc_cardtype" name="vc_cardtype" style="display: none;">
											<option value="">卡类型</option>
											<c_cardtype>
											<option value="${fld:code}">${fld:name}</option>
											</c_cardtype>
										</select> 
					 			 	</li>
					 			 	<li style="width: 110px;">
										<select id="i_status" name="i_status" style="display: none;">
											<option value="">卡状态</option>
											<cardstatus>
												<option value="${fld:domain_value}">${fld:domain_text_cn@js}</option>
											</cardstatus>
										</select>			 	
									 </li>
								<div class="r-c-btnList">
										<button type="button" class="r-c-3-btn-1" id="search_btn" title="查询"></button>
										<button type="button" class="r-c-3-btn-2" id="filter_btn" title="条件筛选"></button>
										<button type="button"  class="r-c-3-btn-3" id="daochu_list" title="导出"></button>
									</div>
								</nav>
							</div>
							<div class="tab-cout-nav-b">
								<nav class="r-c-3-t-b-r">
									<!--  <li>
							    	 	<button  type="button"id="speak_btn">会员留言</button>
									</li> -->
									 <li>
										<select id="contract_btn" class="select-btn" style="position: static!important;display: none!important;">
											<option value="">卡务操作</option>
											<option value="1">办卡</option>
											<option value="2">私教</option>
											<option value="3">租柜</option>
											<option value="4">充值</option>
											<option value="5">升级</option>
											<option value="6">续卡</option>
										</select>
									</li>
								</nav>
								<nav class="r-c-3-t-b-r">
									<li>
										<img src="${def:context}/js/project/fitness/image/SVG/btn/chushimima.svg" title="初始密码" alt=""id="resetpwd_btn">
									</li>
									<li>
										<img src="${def:context}/js/project/fitness/image/SVG/table/icon_yulan.svg" title="查看" alt=""id="look">
									</li>
									 <li>
										<img src="${def:context}/js/project/fitness/image/SVG/nav/xiugai.svg" title="修改" alt=""id="edit">
									</li>
<!-- zzn 单次消费去掉					<li>
										<img src="${def:context}/js/project/fitness/image/SVG/nav/dcxf.svg" title="单次消费" alt=""id="singleitem">
									</li> -->
								</nav>
							</div>
						</div>
							<div class="r-tab-cout-3-b">
							<div class="to-change-background h-43"></div>
							<table> 
								<thead>
									<tr>
										<th class="table-checkbox">
											<label class="am-checkbox">
												<input id="selectAll"  name="datalist"  type="checkbox" value="" style="display: none;">
											</label>
										</th>
										<th>照片</th>
										<th>保护期</th>
										<th>姓名</th>
										<th>性别</th>
										<th>手机</th>
										<th>会籍</th>
										<th>通话次数</th>
										<th>最新通话日期</th>
										<th>最后到访日期</th>
										<th>会籍截止日期</th>	
									</tr>
								</thead>
								
								<tbody id="datagridTemplate" style="display: none">
									<tr>
										<td class="table-checkbox">#application_id#</td> 
										<td>
											<div class="hoverToshow" style="position: relative;display: flex; align-items: center;justify-content: center;">
												<img src="#imgpath#"  height="50" width="50">
												<div class="hoverhowTable"  style="position: absolute;top: 0;width: 50px; height: 50px;background: rgba(42，48，56,.5);display: none; align-items: center;justify-content: center;">
													<img onclick="pictures('#code#')" src="${def:context}/js/project/fitness/image/SVG/paizhao.svg">
												</div>
											</div>
										</td>
										<td >#datenum#</td>
										<td >#vc_name#</td>
										<td >#i_sex#</td>
										<td >#mobile#</td>
										<td >#vc_mc#</td>
										<td >#tonghuanum#</td>
										<td >#tonghuadate#</td>
										<td >#daodiandate#</td>
										<td >#enddate#</td>		
									</tr>
								</tbody>
								<tbody id="datagrid">
								</tbody>
							</table>
							<div class="pageDiv">
								<ul class="pagination">
								</ul>
							</div>
						</div>
					</div>
				</div>
			</form>	
			<form action="${def:context}${def:actionroot}/excel" role="form" method="post" id="daochuForm" target="_blank" style="display: none">
				<input id="daochu_start_date" name="daochu_start_date" type="text"/>
				<input id="daochu_end_date" name="daochu_end_date" type="text"/>
				<input id="daochuvc_all"  name="daochuvc_all" type="text"/>	
				<input id="daochuvc_cardtype" name="daochuvc_cardtype" type="text"/>
				<input id="daochui_status" name="daochui_status" type="text"/>
				<input id="daochuskill_name" name="daochuskill_name" type="text"/>
				<input id="daochu_period_day" name="daochu_period_day" type="text"/>
				
				<div id="daochufilterconditionshtml">
				</div>
			</form>
	<input type="hidden" name="actionroot" id="actionroot" value="${def:actionroot}" />
<script language="JavaScript">
var init_event_city;
var init_event_city2;
var flag=false;
var search = null;
$(document).ready(function() {
	if( "undefined" != "${fld:vc_mc}" && "" != "${fld:vc_mc}" ){
		$("#skill_name").val("${fld:vc_mc}");
	}else{
		$("#skill_name").val("${def:user}");
	}
	
	
	selectInit($("#contract_btn"));
	$('#cc_mc').val("${fld:period_day}");
	$('#cc_mc').attr('disabled',true);
	searchSelectInit($("#cc_mc,#skill_name,#vc_cardtype"));
	$(".header-close").unbind().on("click",function(){
		$("#modalAddnew1").modal('hide');
		ccms.util.clearForm('addForm');
		$("#myModalLabel").modal('hide');
		ccms.util.clearForm('messageForm');
	});
	searchSelectInit($("#cc_sex,#cc_birth,#cc_day,#cc_age,#cc_type,#cc_cardtype,#cc_nationality,#cc_nation,#province,#city,#province2,#city2,#cc_purpose,#cc_leave,#cc_gethobbit,#cc_personalhobbit,#cc_children,#cc_marriage,#i_status,#cardcode"));
	
	$("#speak_btn").unbind().on("click",function(){
		var code=$('input[name="datalist"]:checked').val();
		if(code==''||code==null){
			ccms.dialog.alert("请选择会员进行留言！")
		}else{   
			$("#myModalLabel").modal('show')
		}
	});
	//zyb 20190426 add 初始密码
	$("#resetpwd_btn").unbind().on("click",function(){
		var userid =$('input[name="datalist"]:checked').attr("code2");
		var userlogin= $('input[name="datalist"]:checked').attr("code3");
		var leng=$('input[name="datalist"]:checked').length
		if( userid != undefined && userid != "" && userlogin != undefined && userlogin != "" &&leng==1){
			$Dialog().confirm("确定要初始化密码？", function(){
				var url = "${def:context}${def:actionroot}/resetpwd?user_id="+userid+"&userlogin="+userlogin+"&passwd=123456";
				ajaxCall(url,{
					method: "get",
					progress: true,
					dataType: "script",
					success: function() {
						ccms.dialog.notice("密码初始化成功！", 2000);
					}
				});
			});
		}else{
			ccms.dialog.notice("请选择一条数据！", 3000);
		}
	});
	
	
	
	//导出
	$("#daochu_list").unbind().on("click", function(){
		/* if( "all" != "${fld:datetype}" ){
			var time = new Date().format("yyyy-MM-dd");
			time=time.substring(0,8);
			time+='01'
			$("#daochu_start_date").val(time);
			$("#daochu_end_date").val("${def:date}");
		} */
        $("#daochu_start_date").val($("#_start_date").val());
        $("#daochu_end_date").val($("#_end_date").val());
		
        $("#daochuvc_all").val($("#vc_all").val());
        $("#daochui_status").val($("#i_status").val());
        $("#daochuvc_cardtype").val($("#vc_cardtype").val());
        $("#daochu_period_day").val($("#period_day").val());
        $("#daochuskill_name").val($("#skill_name").val());
        
     	var filterconditionscolumn = $("#filterconditionscolumn").val().split(",");
     	var daochufilterconditionshtml = "";
     	$.each(filterconditionscolumn,function(i, val){
     		daochufilterconditionshtml+="<input name='daochu_"+val+"' id='daochu_"+val+"' value='"+$("#"+val).val()+"' type='text' class='filterconditions' />";
     	});
     	$("#daochufilterconditionshtml").html(daochufilterconditionshtml);
        $("#daochuForm").submit();
    });
	
	$("#edit").click(function(){
		 flag=true;
		 $("#formTitlecust").text('修改');
		//清空form下所有select
		$("#addForm select").each(function(){
			setSelectValue($("#"+$(this).attr("name")), "");
		});
		edit();
	})
	$("#update").click(function(){
		 update();
	})	
	
	$("#save_message").click(function(){
		insertMsg();
	})	
	
	$('#cc_mobile').on('blur',function(){
		checkTel($('#cc_mobile').val(),"cc_mobile");
	})
	$('#cc_officetel').on('blur',function(){
		checkTel($('#cc_officetel').val(),"cc_officetel");
	})
	$('#cc_othertel').on('blur',function(){
		checkTel($('#cc_othertel').val(),"cc_othertel");
	})
	
	$('#cc_card').on('blur',function(){
			IdentityCodeValid($('#cc_card').val(),'cc_card');
	})
	
	$('#cc_email').on('blur',function(){
		checkEmail($('#cc_email').val(),'cc_email');
	})	
	
	$('#look').on('click',function(){
	var leng=$('input[name="datalist"]:checked').length
	var code=$('input[name="datalist"]:checked').val();
	var status=$('input[name="datalist"]:checked').attr('code');
	if(leng!=1||code==''||code==null){
		ccms.dialog.alert("请选择中一条进行查看！")
	}else{
		ccms.dialog.open({url : '${def:context}/action/project/fitness/guest/follow/custcomm?cust_type=1&type=1&commtype='+1+'&customercode='+code+"&status="+status,width:1200,height:700});
	}
	});
	//家庭地址
 	getSelectDomain("province", "Province");
	$("#province").change(function(){
	    getSelectDomain("city", "City", "Province", $(this).val(),function(){
          	setSelectValue($("#city"), init_event_city);
        });
	});
	//公司地址
	getSelectDomain("province2", "Province");
	$("#province2").change(function(){
		getSelectDomain("city2", "City", "Province", $(this).val(),function(){
          	setSelectValue($("#city2"), init_event_city2);
        });
	});
	//单次消费
	$("#singleitem").click(function(){
		var obthis = getCheckboxValue("datalist");
		var count = obthis.split(",").length;
		if(obthis!= ""){
			if(count>1){
				ccms.dialog.notice("只能选择一个会员!");
			}else{
				ccms.dialog.open({url : '${def:context}/action/project/fitness/finance/singleitem/crud?custcode='+obthis,height:'600'});
			}
		}else{
			ccms.dialog.notice("请选择!");
		}
	});
	
	if( "all" != "${fld:datetype}" ){
		var time = new Date().format("yyyy-MM-dd");
		time=time.substring(0,8);
		time+='01'
		$("#_start_date").val(time);
		$("#_end_date").val("${def:date}");
	}
	this.search=search;
	search=$Search({datagrid:"datagrid",formId:"searchForm",rowpackage:function(obj){
		if( "" != obj.imgid ){
			obj.imgpath = contextPath + "/action/project/fitness/util/attachment/download?tuid="+obj.imgid+"&type=1";
		}else{
			obj.imgpath = "${def:context}/js/project/fitness/image/SVG/50X50.svg";
		}
	},success:function(){
	
	
	$("#searchForm #vc_all").val("");
		ccms.util.renderCheckbox("datalist");
		$("#selectAll").unbind().on("ifClicked",function(){    //点击事件未选中
			 if( $(this).prop("checked") ){// 
				$('input[name=datalist]').iCheck('uncheck');
			 }else{
				$('input[name=datalist]').iCheck('check');  //
			 }
	   });
}}).initSearchBtn().searchData(1);
	$Dialog().date($('#_start_date,#_end_date'));
	
	// 上传头像
	$("#upload_btn").unbind().on("click",function(){
		var pkvalue = document.addForm.cc_code.value;
		if( "" == pkvalue ){
			ccms.dialog.notice("请保存会员信息后再上传头像", 2000);
		}else{
			ccms.dialog.open({url: contextPath+"/action/project/fitness/util/attachment/photo/crud?table_code=cc_customer&pk_value="+pkvalue, height: "600", width: "630"});
		}
	});
	
	//筛选条件
	var filterconditionscolumn = $("#filterconditionscolumn").val().split(",");
	var filterconditionshtml = "";
	$.each(filterconditionscolumn,function(i, val){
		filterconditionshtml+="<input name='"+val+"' id='"+val+"' type='hidden' class='filterconditions' value='' preserve='true'/>";
	});
	$("#filterconditionshtml").html(filterconditionshtml);
	//结束
	//卡务操作	
	$("#contract_btn").change(function(){
		if($(this).val()==""){
			return false;
		}
		if( $("input[name=datalist]:checked").length != 1 ){
			ccms.dialog.notice("请选择一条记录！", 2000);
			$("#contract_btn").val("").trigger("change");
			return false;
		}
		var customercode = getCheckboxValue("datalist");
		var codeid = $(this).val();
		$("#contract_btn").val("").trigger("change");
		var hei=0;
		var uri = contextPath;
		if( "" == codeid ){	/** 办卡合同 */
			return false;
		}else if( "1" == codeid ){	/** 办卡合同 */
			hei=700;
			uri += getContractUri(0, 0, false);
		}else if( "2" == codeid ){	/** 私教合同 */
			hei=500;
			uri += getContractUri(0, 2, false);
		}else if( "3" == codeid ){	/** 租柜合同 */
			hei=500;
			uri += getContractUri(0, 1, false); 
		}else if( "4" == codeid ){	/** 充值 */
			hei=500;
			uri += "/action/project/fitness/customer/recharge/form"
		}else if( "5" == codeid ){	/** 升级 */
			hei=500;
			uri += getContractUri(1, 0, false);
		}else if( "6" == codeid ){	/** 续卡 */
			hei=500;
			uri += getContractUri(0, 7, false);
		}
		uri += "?customercode=" + customercode;

		ccms.dialog.open({url : uri,height:hei});
	})
    
	var filter_url="${def:context}${def:actionroot}/filter?ispubload=true";//筛选
	$("#filter_panel").css('position','absolute').css('left','20%').css('z-index','5000').load(filter_url);
	$("#filter_btn").unbind().on('click',function(){
		ccms.dialog.open({url : "${def:context}${def:actionroot}/filter", width:1000, height:670});
	})
});

function edit(){
  	var leng=$('input[name="datalist"]:checked').length
	var code=$('input[name="datalist"]:checked').val();
	if(leng!=1||code==''||code==null){
		ccms.dialog.alert("请选择一个会员进行查看或修改！")
	}else{  
		ccms.util.clearForm('addForm');
		$('#modalAddnew').prop('scrollTop','0');
		var uri="${def:context}/action/project/fitness/customer/memberinfo/edit?code="+code;
		   ajaxCall(uri,{
		   	method: "get",
		   	progress: false,
		   	dataType: "script",
		 	async:false,
		   	success: function() {
		   		if(flag){
		   			$('#foot').show();
		   		}else{
		   			$('#foot').hide();
		   		}
		   		$('#modalAddnew1').modal('show');
		 	  	}
			});
		}
}

function update(){
	var xmobile=$("#cc_mobile").val();
	if(ymobile!=xmobile){
		var uri="${def:context}/action/project/fitness/customer/memberinfo/updatemobile";//修改手机号
	}else{
		var uri="${def:context}/action/project/fitness/customer/memberinfo/update";//不修改手机号
	}
	
	   ajaxCall(uri,{
		   	method: "post",
		   	form:"addForm",
		   	progress: false,
		   	dataType: "script",
		   	success: function() {
		   		
		   		}
		   	}); 
}

function checkTel(value,str){
    var isPhone = /^([0-9]{3,4}-)?[0-9]{7,8}$/;
    var isMob=/(^((0\d{2,3})-)(\d{7,8})(-(\d{3,}))?$)|(^1[3578]\d{9}$)|(^1\d{10}$)/;
    var value= value
    if(!isMob.test(value)&&!isPhone.test(value)){
    	ccms.dialog.alert("请输入正确手机号或电话号！")
	    	 $('#'+str).val('');
	    }
   }
	
function IdentityCodeValid(code,str) { 
    var city={11:"北京",12:"天津",13:"河北",14:"山西",15:"内蒙古",21:"辽宁",22:"吉林",23:"黑龙江 ",31:"上海",32:"江苏",33:"浙江",34:"安徽",35:"福建",36:"江西",37:"山东",41:"河南",42:"湖北 ",43:"湖南",44:"广东",45:"广西",46:"海南",50:"重庆",51:"四川",52:"贵州",53:"云南",54:"西藏 ",61:"陕西",62:"甘肃",63:"青海",64:"宁夏",65:"新疆",71:"台湾",81:"香港",82:"澳门",91:"国外 "};
    var tip = "";
    var pass= true;
    
    if(!code || !/^\d{6}(18|19|20)?\d{2}(0[1-9]|1[12])(0[1-9]|[12]\d|3[01])\d{3}(\d|X)$/i.test(code)){
        tip = "身份证号格式错误";
        pass = false;
    }
    
   else if(!city[code.substr(0,2)]){
        tip = "地址编码错误";
        pass = false;
    }
    if(!pass) {
    	ccms.dialog.alert(tip)
    	 $('#'+str).val('');
    }
}

function checkEmail(value,str){
	var value=value
	var myreg = /^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;
	if(!myreg.test(value)){
		ccms.dialog.alert('请输入有效的E_mail！');
	 $('#'+str).val('');
	}
}

function insertMsg(){
	var divobj = $("#checkedNodesDiv");
	var codes=$('input[name=datalist]');
	var mc_message=$('#mc_message').val();
	divobj.empty();
	for(var i = 0; i < codes.length; i++){
		var obj = codes[i].value;
    	divobj.append('<input type="hidden" name="mc_code" value="' + obj + '" />');
    	divobj.append('<input type="hidden" name="mc_message" value="' + mc_message + '" />');
	}
	var uri="${def:context}/action/project/fitness/customer/memberinfo/insertmsg";
	   ajaxCall(uri,{
		   	method: "post",
		   	form:"messageForm",
		   	progress: false,
		   	dataType: "script",
		   	success: function() {
		   		ccms.dialog.alert("留言成功！")
		   		$('#myModalLabel').modal('hide');
		   		$('#mc_message').val('');
		   		}
		   	}); 
	   
}
//拍照
function pictures(code){
	ccms.dialog.open({url: contextPath+"/action/project/fitness/util/attachment/photo/crud?table_code=cc_customer&pk_value="+code, height: "600", width: "630"});
}
</script>
</body>
</html>