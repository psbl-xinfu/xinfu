<!DOCTYPE html>
<meta charset="utf-8">
<html>
	<head>
${inc:/action/project/fitness/wx/pub}
        <title>我的资源</title>
        <link href="${def:context}/js/project/fitness/wx/css/bootstrap-slider.min.css" rel="stylesheet">
     	<link href="${def:context}/js/project/fitness/wx/css/normalize3.0.2.min.css" rel="stylesheet" />
        <link rel="stylesheet" href="${def:context}/js/project/fitness/wx/css/style.css?v=7" />
     	<link href="${def:context}/js/project/fitness/wx/css/mobiscroll.css" rel="stylesheet" />
    	<link href="${def:context}/js/project/fitness/wx/css/mobiscroll_date.css" rel="stylesheet" />
    	<link href="${def:context}/js/project/fitness/wx/css/huiji.css" rel="stylesheet" />
        <link href="${def:context}/js/project/fitness/wx/css/yyc_end.css" rel="stylesheet">
    <style>
	  
	    #filter {
		    border-bottom: 1px solid #ccc
		  }
		  
		  #filter div {
		    text-align: center;
		    line-height: 54px;
		    font-size: 16px;
		  }
		 .list-ul {
		    overflow: hidden
		  } 
		   /* li{overflow:hidden;list-style:none;}  */
		   .list-li {
			  /* line-height: 60px; */
			  /* border-bottom: 1px solid #fcfcfc; */
			  position: relative;
			  padding: 0 12px;
			  color: #666;
			  background: #f2f2f2;
			  -webkit-transform: translateX(0px);
			 }
			  
			 .guestbtn {
			 line-height:10px;
			 font-size:18px;
			 line-height: 40px;
			  position: absolute;
			  top: 0;
			  right: -90px;
			  text-align: center;
			  background: #ffcb20;
			  color: #fff;
			  width: 90px;
			 }
			  .moveleft{
				transform:translateX(-20%);
				-webkit-transform:translateX(-20%);
			}
		  </style>
    </head>
    <body>
    
         <form id="filter" name="filter">
            <input name="pageSize" type="hidden" value="100000" preserve="true"  id="pageSize"/>'
			<input type="hidden" id="s_period_day" name="s_period_day" >
			<input type="hidden" id="s_baohuqi"name="s_baohuqi" value="">
			<input type="hidden" id="s_province"name="s_province" >
			<input type="hidden" id="s_city"name="s_city" >
			<input type="hidden" id="s_communication"name="s_communication" >
			<input type="hidden" id="s_custcations"name="s_custcations" >
    
	        <div class="myziyuanlisttop">
	            <div class="shurukuang">
	                <input type="text" name="s_name" class="searchinput" id="s_name" placeholder="输入资源姓名/电话"oninput="updateurl(this)">
	                 <img  src=" ${def:context}/js/project/fitness/wx/image/search.png"  class="searchsubmit">
	            </div>
	            <div class="searchbtn text-center" data-toggle="modal" id="addnew_btn">筛选</div>
	        </div>
    	</form>
        
        
        <div class="myziyuanlistbody">
		</div>
        <!-- modal fade -->
        <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" >
            <div class="modal-dialog" role="document" style="background: white">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="color: #CCC"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel">筛选条件</h4>
                    </div>
                    <div class="modal-body">
                        <div class="mokuai">
                            <h5>剩余保护期</h5>
                            <div class="content">
                                <div class="well">
                                    <input id="ex1" data-slider-id='ex1Slider' type="text" data-slider-min="0" data-slider-max="${fld:period_day}" data-slider-step="1" data-slider-value="${fld:period_day}" value="${fld:period_day}" />
                                </div>
                                <div class="keduzhi">
                                    <p class="fl">0</p>
                                    <p class="fr">${fld:period_day}</p>
                                </div>
                            </div>
                        </div>

                        <div class="mokuai">
                            <h5>地址</h5>
                            <div>
								<div class="my-selected">
									<select  id="province2" name="province2" class="form-control"> 
										<option value="">请选择省</option>
										<domain>
											<option value="${fld:domain_value}">${fld:domain_text_cn}</option>
										</domain>
									</select>
								</div>
								<div id="cityhtml">
									<select  id="city2" name="city2" class="form-control"> 
										<option value="">请选择市</option>
									</select>
								</div>
							</div>
                        </div>
                        
                        <div class="mokuai">
                        	<h5>客户分类</h5>
                            <div class="content">
                            	<select  id="communication" name="communication" class="form-control"> 
									<option value="">请选择</option>
									<option value="1">客户</option>
									<option value="2">重点意向客户</option>
									<option value="3">咨询客户</option>
									<option value="4">陌生客户</option>
								</select>
                            </div>
                            <div id="businesstype">
	                            <select id="custcations" title="请选择" name="custcations" class="selectpicker show-tick form-control" multiple data-live-search="false">
									<option value="1">枢途设计</option>
									<option value="2">枢途平牌</option>
									<option value="3">单次学习</option>
									<option value="4">全年学习</option>
									<option value="5">6+1学习</option>
									<option value="6">学习点客户</option>
									<option value="7">内训客户</option>
		                         </select>
                         	</div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default fl resetbtn">重置</button>
                        <button type="button" class="btn btn-primary fr submitbtn">确定</button>
                    </div>
                </div>
            </div>
        </div>
        
		
    	 <script src="${def:context}/js/project/fitness/wx/js/timepacker/js/bootstrap-slider.min.js" ></script> 
         <script src="${def:context}/js/project/fitness/wx/js/timepacker/js/mobiscroll_date.js" charset="gb2312"></script> 
        <script src="${def:context}/js/project/fitness/wx/js/timepacker/js/mobiscroll.js"></script> 
    </body>
    
</html>

<script type="text/javascript">
var init_event_city2;
    $(function(){
    	btnreturn();
    	addthe();
    	homemc();
    	var s_period_day= "${fld:period_day}";
    	
    	/* searchSelectInit('#custcations'); */
    	$("#province2").change(function(){
    		var province= $('#province2').val();
    		postAjaxCall("/action/project/fitness/wx/mc/myziyuan/getdomain?province="+province);
    	});
    	$("#addnew_btn").on('click',function(){
    		$('#myModal').modal('show');
       	});
    	$("#businesstype").hide();
    	setSelectValue($("#custcations"), "");
    	$("#communication").change(function(){
    		var cust2=$("#communication").val();
    			if(cust2==''){
    				$('#businesstype').hide();
    				setSelectValue($("#custcations"), "");
    			}else{
    				if(cust2==1){
    					$('#businesstype').show();
    				}else{
    					$('#businesstype').hide();
    					setSelectValue($("#custcations"), "");
    				}
    			}
    	});
    	
       	$('#add_btn').on('click',function(){
	       	sessionStorage.removeItem('index_list');
	        sessionStorage.removeItem('index_scroll');
           	location.href="${def:context}/action/project/fitness/wx/mc/myziyuan/from";
       	})
    	
       	$('.searchsubmit').on('click',function(){
       	 	getlist();
       	});
		
        var sday=s_period_day-1;	
        // 滑块With JQuery
        $("#ex1").slider({
            tooltip: 'always',
         	formatter: function(value) {
         		 if(Number(value) > sday ){
         			return "无限";
         		 }
         		 return value;
         	}
        });

        //重置
        $('.resetbtn').click(function(){
        	$(".well").innerHTML="";
        	$(".well").html('<input id="ex1" data-slider-id="ex1Slider" type="text" data-slider-min="0" data-slider-max="${fld:period_day}" data-slider-step="1" data-slider-value="${fld:period_day}" value="${fld:period_day}" />');
        	$("#ex1").slider({
                 tooltip: 'always',
              	formatter: function(value) {
              		 if(Number(value) > sday ){
              			return "无限";
              		 }
              		 return value;
              	}
             });
        	 $('#province2').val("");
        	 $('#city2').val("");
        	 $('#communication').val("");
        	setSelectValue($("#custcations"), "");
        	 $('#businesstype').hide();
        	 
        });

        //提交
        $('.submitbtn').click(function(){
            var baohuqi=$('#ex1').val();
            if(baohuqi>s_period_day){
        	    $('#s_baohuqi').val('');
	         }else{
	        	$('#s_baohuqi').val(baohuqi);
	         }
            $('#s_province').val($("#province2").val());//开始
            $('#s_city').val($("#city2").val());//结束
            $('#s_communication').val($("#communication").val());//状态
            $('#s_custcations').val($("#custcations").val());//关注度
        	getlist();
            $('#myModal').modal('hide');
        });
        var l = sessionStorage.getItem('index_list');
        if(null !== l && '' !== l){
            //恢复数据
             $(".myziyuanlistbody").html(l);
            $(window).scrollTop(sessionStorage.getItem('index_scroll'));

        }else{
        	getlist();
        };
        
        gethuadong();
        $("#ten_btn").click(function(){
        	location.href = "${def:context}/action/project/fitness/wx/mc/home";
        });
    });
    
    function gethuadong(){
    	var open = null;//open初始化，判断是否是已展开元素
        var list = document.getElementsByClassName("list-li");//list获取所有的待展开框
        for(var i = 0;i < list.length; i++){
          var x,y,X,Y,moveX,moveY;
          list[i].addEventListener('touchstart',function(e){
            /*获取最初的触摸位置*/
            x = e.changedTouches[0].pageX;
            y = e.changedTouches[0].pageY;
            moveX = true;
            moveY = true;
          });
          
          
          list[i].addEventListener('touchmove',function(e){
            X = e.changedTouches[0].pageX;
            Y = e.changedTouches[0].pageY;
            
            //左右滑动
            if(moveX && Math.abs(X - x) - Math.abs(Y -y) > 0){
              e.stopPropagation();//阻止冒泡事件
              //右滑收起删除按钮
              if(X - x > 12){
                e.preventDefault();
                this.classList.remove("moveleft");
              }
              //左滑显示删除按钮
              if(x - X > 12){
                e.preventDefault();
                this.classList.add("moveleft");
                open = this;//存入展开的li元素
              }
              moveY = false;//左右滑动时不执行上下滑动时的事件
            }
            
            //上下滑动
            if(moveY && Math.abs(X - x) - Math.abs(Y - y) < 0){
              moveX = false;//上下滑动时不执行左右滑动时的事件
            }
          });
          
          list[i].addEventListener('click',function(e){
            //在已展开的元素中执行操作
            if(open){
              var obj = e.target;
              var objli = e.target.closest(".list-li");
              
              //点击li元素里不是删除按钮的部分，li元素收起
              if(obj.className != "guestbtn"){
                  open.classList.remove("moveleft");
              }/*else if(obj.className == "thebtn"){//点击删除按钮执行删除
           	   location.href="${def:context}/action/project/fitness/wx/mc/myziyuan/gustinfo/thecontact/from?guestcode="+$("#guestcode").val();
              }*/
            }
          });
          
        }
    }
    
    /* function getinfo(code){
    	location.href="${def:context}/action/project/fitness/wx/mc/myziyuan/gustinfo/crud?guestcode="+code;
    } */
    
    function getlist(){
    	postAjaxCall("/action/project/fitness/wx/mc/myziyuan/gustlist?",'filter',false);
    }
    
    function updateurl(obj){
		   if($(obj).val()!=""){
			   $('.searchsubmit').attr('src',"${def:context}/js/project/fitness/wx/image/sousuo_on.png")
		   }else{
			   $('.searchsubmit').attr('src',"${def:context}/js/project/fitness/wx/image/search.png")
		   }
 	}
    function guestbtn(guestcode){
    	sessionStorage.setItem('index_list',$(".myziyuanlistbody").html());//存储列表数据
        sessionStorage.setItem('index_scroll',$(window).scrollTop());//存储滚动条位置
        sessionStorage.removeItem("the_list");
    	sessionStorage.removeItem("the_scroll");
        
        location.href="${def:context}/action/project/fitness/wx/mc/myziyuan/gustinfo/thecontact/crud?guestcode="+guestcode+"&state=1";
    	return false;
    }
  /*   function save_in_cookie(hash_id){
        var d = new Date();
        d.setTime(d.getTime() + (50 * 365 * 24 * 60 * 60 * 1000)); // 有效期50年
        var expires = "expires=" + d.toUTCString();
        document.cookie = "hash_id=" + hash_id + "; " + expires;
    }

    function get_cookie(cname){
        var name = cname + "=";
        var ca = document.cookie.split(';');
        for (var i = 0; i < ca.length; i++) {
            var c = ca[i];
            while (c.charAt(0) == ' ') c = c.substring(1);
            if (c.indexOf(name) != -1) return c.substring(name.length, c.length);
        }
        return null;
    }

    function scroll(){
        var hash_id = get_cookie('hash_id');
        document.getElementById(hash_id).scrollIntoView(true);
    }

    window.onload = function (){
        setTimeout(scroll, 1000);
    } */

    function getinfo(dom,code) {
        /*存cookie*/
       /*  var hash_id= dom.getAttribute("id");
        save_in_cookie(hash_id); */
        
        sessionStorage.setItem('index_list',$(".myziyuanlistbody").html());//存储列表数据

        sessionStorage.setItem('index_scroll',$(window).scrollTop());//存储滚动条位置
		
        location.href = "${def:context}/action/project/fitness/wx/mc/myziyuan/gustinfo/crud?guestcode="+code;

        return false;
    }
    /* $(window).scroll(function(){
        if($(document).scrollTop()!=0){
            sessionStorage.setItem("offsetTop", $(window).scrollTop());//保存滚动位置
        }
    });
    window.onload = function(){
        var _offset = sessionStorage.getItem("offsetTop");
        $(document).scrollTop(_offset);
    }; */
    
</script>
