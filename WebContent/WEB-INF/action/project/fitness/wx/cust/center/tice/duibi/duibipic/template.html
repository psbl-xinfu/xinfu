<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<title>体测对比报告</title>
	  ${inc:/action/project/fitness/wx/newpub}
	          	<script type="text/javascript" src="${def:context}/js/ccms/jweixin-1.js"></script>
</head>

<body  >
	<div style="display:none;">
		<img src="${def:context}/js/project/fitness/image/logo300.png" />
	</div>

	<div class="containter dbbg"  style="height:770px;">
		<header>
			    <img id="headpic" src=""alt="">
		</header>

		<div class="title">
			<p id="custname"></p>
			<p>
				<span id="olddate"> </span>
				<span>VS</span>
				<span id="newdate"> </span>
			</p>
		</div>
		<ul class="main" style="width: 300px;margin-left: -13%;">
			<li>
				<span>体脂</span>
				<div>
					<p>
						<span  class="olddate">
							 
						</span>
						<i  id="body_fat1"></i>
					</p>
					<p>
						<span  class="newdate">
							 
						</span>
						<i  id="body_fat2"></i>
					</p>
				</div>
			</li>
			
		<li>
				<span>体重</span>
				<div>
					<p>
						<span  class="olddate">
							 
						</span>
						<i id="weight1"></i>
					</p>
					<p>
						<span  class="newdate">
							 
						</span>
						<i id="weight2"></i>
					</p>
				</div>
			</li>		
			
		<li>
				<span>肺活量</span>
				<div>
					<p>
					<span  class="olddate">
							 
						</span>
							<i id="lung_capacity1"></i>
					</p>
					<p>
						<span  class="newdate">
							 
						</span>
							<i id="lung_capacity2"></i>
					</p>
				</div>
			</li>
			
			<li>
				<span>静态心率</span>
				<div>
					<p>
						<span  class="olddate">
							 
						</span>
						<i id="static_heart1">50</i>
					</p>
					<p>
						<span  class="newdate">
							 
						</span>
						<i id="static_heart2">50</i>
					</p>
				</div>
			</li>
			
			<li>
				<span>肌肉含量</span>
				<div>
					<p>
						<span  class="olddate">
							 
						</span>
					<i id="muscle1">50</i>
					</p>
					<p>
						<span  class="newdate">
							 
						</span>
						<i id="muscle2">50</i>
					</p>
				</div>
			</li>
		</ul>
		
 	<button class="share" style="margin-bottom: 30px;display: none">点击右上角分享</button> 
	<div class="share"  style="position:fixed;width:100%;height:50px;bottom: 0px;display: none" id="tiyan" >
	    <img src="${def:context}/js/project/fitness/image/tiyanka/tiyanka.png"  style="height: 100;width: 100%;">
	    <div style="position:absolute;width:100%;height:50px;z-indent:2; top:10px;font-size: 20px;padding-left: 10%" id="tiyanname">
	    </div>
	</div>
	</div>
	
	<form id="cardform" name="cardform"> 
		<input type="hidden"  id="customercode"  name="customercode">
		<input type="hidden"  id="code" name="code">
		<input type="hidden"  id="ecode" name="ecode">
		<input type="hidden"  id="share_link" name="share_link" value="/action/project/fitness/wx/cust/center/tice/duibi/duibipic?codes=${fld:codes}">
	</form>
	
</body>

<script type="text/javascript" src="${def:context}/js/project/fitness/wx/js/menushare.js"></script>
<script type="text/javascript">
$(function(){
	var iscom=false;
	var totalnum="";//发卡数量  null不限  
	//是否有活动
	<tiyanka>
	iscom=true;
	$('#code').val("${fld:code}");
	$('#ecode').val("${fld:ecode}");
	$('#tiyanname').text("${fld:name}");
	totalnum="${fld:totalnum}";
	</tiyanka>
	
	var usenum=0;
	<card>
		usenum=${fld:usenum}
	</card>
	if( "" != "${fld:boot}" && "undefined" != "${fld:boot}" ){
		if(iscom){//有活动
			if(totalnum!=""&&totalnum!="&nbsp;"){//发卡有限制
				if(totalnum>usenum){//发卡数量大于领卡数量
					$('.share').eq(1).show();
				}else{
					//已领光
				}
			}else{//发卡没限制
				$('.share').eq(1).show();
			}
		}
	}else{
		$('.share').eq(0).show();
		// modified by leo 190213 修正会籍、私教访问体侧返回不正确
		if("${fld:type}"=="mc"){
			homemc();
		}else if("${fld:type}"=="pt"){
			homept();	
		}else{
			homecust();
		}
	}
	
	var num=0;
	
	var newbody_fat=0;
	var newweight=0;
	var newlung_capacity=0;
	var newweight_index=0;
	var newstatic_heart=0;
	var newmuscle=0;
	
	<list>
	num++
	if(num==1){
		$('#headpic').attr('src',contextPath+"${fld:headpic}");
		
		$('#custname').text('${fld:name}');
		$('#customercode').val('${fld:customercode}');
		$('#newdate').text("${fld:created}");
		$('.newdate').text("${fld:created}");
		
		$('#body_fat2').text("${fld:body_fat}");
		$('#weight2').text("${fld:weight}");
		$('#lung_capacity2').text("${fld:lung_capacity}");
		//$('#weight_index2').text("${fld:weight_index}");
		$('#static_heart2').text("${fld:static_heart}");
		$('#muscle2').text("${fld:muscle}");
		
		 newbody_fat="${fld:body_fat}";
		 newweight="${fld:weight}";
		 newlung_capacity="${fld:lung_capacity}";
		 newweight_index="${fld:weight_index}";
		 newstatic_heart="${fld:static_heart}";
		 newmuscle="${fld:muscle}";
	}else{
		$('#olddate').text("${fld:created}");
		$('.olddate').text("${fld:created}");
		
		$('#body_fat1').text("${fld:body_fat}");
		$('#weight1').text("${fld:weight}");
		$('#lung_capacity1').text("${fld:lung_capacity}");
		//$('#weight_index1').text("${fld:weight_index}");
		$('#static_heart1').text("${fld:static_heart}");
		$('#muscle1').text("${fld:muscle}");
		
		
		
		
		if(newbody_fat=="${fld:body_fat}"){
			$('.newdate').eq(0).css('width','250px');
			$('.olddate').eq(0).css('width','250px');
		}else if(newbody_fat>parseFloat("${fld:body_fat}")){
			rect(newbody_fat,"${fld:body_fat}",1,0)
		}else{
			rect(newbody_fat,"${fld:body_fat}",0,0)
		}
		
		if(newweight=="${fld:weight}"){
			$('.newdate').eq(1).css('width','250px');
			$('.olddate').eq(1).css('width','250px');
		}else if(newweight>parseFloat("${fld:weight}")){
			rect(newweight,"${fld:weight}",1,1)
		}else{
			rect(newweight,"${fld:weight}",0,1)
		}
		
		if(newlung_capacity=="${fld:lung_capacity}"){
			$('.newdate').eq(0).css('width','250px');
			$('.olddate').eq(0).css('width','250px');
		}else if(newlung_capacity>parseFloat("${fld:lung_capacity}")){
			rect(newlung_capacity,"${fld:lung_capacity}",1,2)
		}else{
			rect(newlung_capacity,"${fld:lung_capacity}",0,2)
		}
		
/* 		if(newweight_index=="${fld:weight_index}"){
			$('.newdate').eq(0).css('width','250px');
			$('.olddate').eq(0).css('width','250px');
		}else if(newweight_index>parseFloat("${fld:weight_index}")){
			rect(newweight_index,"${fld:weight_index}",1,3)
		}else{
			rect(newweight_index,"${fld:weight_index}",0,3)
		} */
		
		if(newstatic_heart=="${fld:static_heart}"){
			$('.newdate').eq(0).css('width','250px');
			$('.olddate').eq(0).css('width','250px');
		}else if(newstatic_heart>parseFloat("${fld:static_heart}")){
			rect(newstatic_heart,"${fld:static_heart}",1,3)
		}else{
			rect(newstatic_heart,"${fld:static_heart}",0,3)
		}
		
		if(newmuscle=="${fld:muscle}"){
			$('.newdate').eq(0).css('width','250px');
			$('.olddate').eq(0).css('width','250px');
		}else if(newmuscle>parseFloat("${fld:muscle}")){
			rect(newmuscle,"${fld:muscle}",1,4)
		}else{
			rect(newmuscle,"${fld:muscle}",0,4)
		} 
	}
	</list>
	
	$('#tiyan').on('click',function(){
  		location.href="${def:context}/action/project/fitness/wx/cust/tiyanka/crud?codes=${fld:codes}"
	})
	
	// modified by leo 20190226 合并两个方法，根据是否有活动选择是否记录微信分享 
	wx.config({
		debug: false,
		appId:  "${fld:appid}",
		// modified by leo 190213 修正js报错
		timestamp: "${fld:timestamp}",
		// timestamp: ${fld:timestamp},
		nonceStr: "${fld:noncestr}",
		signature: "${fld:signature}",
		jsApiList : [ 'checkJsApi','onMenuShareTimeline',"onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo","onMenuShareQZone",
		              'hideOptionMenu','showOptionMenu','hideMenuItems','showMenuItems','hideAllNonBaseMenuItem','showAllNonBaseMenuItem']
		// 必填，需要使用的JS接口列表
	});

    wx.ready(function(){
    	menuShareConfig({
    		titlename: $('#custname').text() + '体测对比',
    		desc: "",
    		linkuri: '${fld:access_address}${def:context}/action/project/fitness/wx/cust/center/tice/duibi/duibipic?codes=${fld:codes}&boot=false',
    		imguri: "${fld:access_address}${def:context}/js/project/fitness/image/favicon.ico",
    		callback: function () {
    	    	if(iscom){
    	    		postAjaxCall("/action/project/fitness/wx/cust/center/tice/duibi/duibipic/insert", "cardform", false);
    	    	}    	    		
            }
    	});
	}); 
})

function rect(newdata,olddata,type,index){
	//旧大于新
	if(type==0){
		var fen=250/olddata;//几格一px
		var px=newdata*fen
		if(px<75){
			px=75
		}
		$('.olddate').eq(index).css('width','250px');
		$('.newdate').eq(index).css('width',px+'px');
	}else{
		var fen=250/newdata;//几格一px
		var px=olddata*fen
		if(px<75){
			px=75
		}
		$('.newdate').eq(index).css('width','250px');
		$('.olddate').eq(index).css('width',px+'px');
	}
}
</script>
</html>